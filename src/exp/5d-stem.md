# 5D-STEMの基礎

5D-STEMは、走査透過電子顕微鏡（STEM）において「各走査点ごとに2次元回折像を記録する4D-STEM」を基礎に、さらに時間や分光、傾斜角などの追加次元を組み合わせ、格子・欠陥・電磁場・ダイナミクスを同一のデータ表現として扱う手法群である。ナノ材料の局所構造と物理量の空間分布を、強いモデル仮定を置かずに引き出せる点が特徴である。

## 参考ドキュメント
- C. Ophus, Four-Dimensional Scanning Transmission Electron Microscopy (4D-STEM): A Primer, Microscopy and Microanalysis 25, 563–582 (2019)
  https://academic.oup.com/mam/article/25/3/563/6887544
- J. Yuan et al., Probing the nanoscale phonon excitations in metallic glass by time-resolved electron microscopy, Chemical Science 13, 2369–2378 (2022)
  https://pubs.rsc.org/en/content/articlelanding/2022/sc/d1sc05604c
- 電子タイコグラフィ入門（4D-STEMデータから位相を復元する考え方）, 顕微鏡 60(2), 68–（J-STAGE）
  https://www.jstage.jst.go.jp/article/kenbikyo/60/2/60_68/_article/-char/en

## 1. 次元とは何か：4D-STEMから5D-STEMへ
### 1.1 4D-STEMの定義
STEMでは、試料面内の走査座標を $\mathbf{r}=(x,y)$ とする。各走査点で、収束電子線回折（CBED）やナノビーム回折パターンを、検出器面の座標 $\mathbf{q}=(q_x,q_y)$（散乱ベクトル、あるいは運動量空間）として記録する。すると観測データは
$$
I(\mathbf{r},\mathbf{q}) = I(x,y,q_x,q_y)
$$
で与えられ、これが4D-STEM（2次元走査＋2次元回折で合計4次元）である。

4D-STEMの本質は、従来のADF/BFのように「検出器上の一部領域を積分して画像を作る」のではなく、回折面の情報を丸ごと保持し、後段で任意の物理量へ写像できる点にある。たとえば「仮想検出器」を定めれば、任意角度範囲の積分強度から仮想ADF像や暗視野像を再合成できる。

### 1.2 5D-STEMの位置づけ
5D-STEMという呼称は研究分野によってやや揺らぎがある。共通する考え方は、4D-STEMデータに対して追加の独立変数 $\lambda$ を導入し、
$$
I(\mathbf{r},\mathbf{q},\lambda)
$$
として扱う点にある。代表例を挙げる。

- 時間 $t$ を追加：$I(\mathbf{r},\mathbf{q},t)$  
  ポンプ・プローブ（超高速電子顕微鏡UTEM）、あるいはその場加熱・電場印加などで時間発展を追う。
- 傾斜角 $\theta$ を追加：$I(\mathbf{r},\mathbf{q},\theta)$  
  4D-STEMの傾斜シリーズから三次元再構成へ接続する（4D-STEMトモグラフィの概念）。
- エネルギー損失 $\Delta E$ を追加：$I(\mathbf{r},\mathbf{q},\Delta E)$  
  回折と分光（EELS/EDS）の同時取得を多次元データとして統合する。

したがって5D-STEMは単一の装置名称というより、ピクセル化検出器により成立した「回折面の全情報」を基盤に、時間・分光・傾斜などを重ねていく拡張概念である。

## 2. 5D-STEMの物理
### 2.1 収束電子線回折（CBED）と情報の由来
収束した電子プローブ $P(\mathbf{r})$ を試料に入射し、試料を複素透過関数 $O(\mathbf{r})$（吸収と位相を含む）で表すと、走査位置 $\mathbf{R}$ における検出器面（フーリエ空間）での強度は、基本的に
$$
I(\mathbf{R},\mathbf{q}) = \left|\mathcal{F}\left[P(\mathbf{r}-\mathbf{R})\,O(\mathbf{r})\right]\right|^2
$$
の形に帰着する。ここで $\mathcal{F}$ はフーリエ変換である。

この式は重要である。なぜなら、回折像は単なる「結晶のスポット」ではなく、プローブと試料の相互作用（位相、局所電場、磁場、厚み、傾き、欠陥、短距離秩序）を、強度分布として符号化しているからである。4D/5D-STEMはこの符号化を失わずに記録するため、再構成（逆問題）により位相や場へ到達できる。

### 2.2 弱位相近似と位相の意味
薄い試料で弱散乱が成り立つ場合、透過関数を
$$
O(\mathbf{r}) \approx \exp\left[i\phi(\mathbf{r})\right]
$$
とみなしうる。電子の位相 $\phi(\mathbf{r})$ は、静電ポテンシャル $V$ の投影に比例する成分をもつ：
$$
\phi_{\mathrm{el}}(x,y)=\sigma \int V(x,y,z)\,dz
$$
ここで $\sigma$ は加速電圧（電子エネルギー）に依存する相互作用定数である。

磁場の寄与は、ベクトルポテンシャル $\mathbf{A}$ と関係し、アハラノフ＝ボーム効果の形で位相に現れる。概念的には
$$
\phi_{\mathrm{mag}} \propto \int \mathbf{A}\cdot d\mathbf{l}
$$
として投影磁束に対応する。したがって位相を復元できれば、電荷分布や内部電場、磁束密度の投影情報に接続しうる。

## 3. 4D/5D-STEMから物理量を取り出す
### 3.1 仮想検出器像（virtual imaging）
回折像内の領域 $\Omega$ を選び、強度を積分すると
$$
S_{\Omega}(\mathbf{r})=\int_{\Omega} I(\mathbf{r},\mathbf{q})\,d^2\mathbf{q}
$$
が得られる。$\Omega$ の選び方で、仮想BF、仮想ADF、任意方位の暗視野、特定散乱角のコントラストなどを構成できる。従来の検出器では実験時に固定されていた選択を、データ取得後に可変にできることが本質である。

### 3.2 DPC（Differential Phase Contrast）と電磁場の投影
回折面での一次モーメント（center-of-mass）を
$$
\langle \mathbf{q}\rangle(\mathbf{r})=
\frac{\int \mathbf{q}\, I(\mathbf{r},\mathbf{q})\,d^2\mathbf{q}}
{\int I(\mathbf{r},\mathbf{q})\,d^2\mathbf{q}}
$$
と定義する。弱位相条件や適切な検出条件の下で、この量は試料による横方向の運動量移行、すなわち位相勾配に対応する：
$$
\langle \mathbf{q}\rangle(\mathbf{r}) \propto \nabla_{\perp}\phi(\mathbf{r})
$$
よって、DPCは投影電場・投影磁場の情報を含み、界面電荷、分極、磁区・磁束、欠陥近傍の局所場などの可視化へ接続する。

### 3.3 ナノスケールひずみ（strain）と回折ディスクの変位
結晶の回折ディスク（Braggディスク）の中心位置から、局所的な逆格子ベクトル $\mathbf{g}_i(\mathbf{r})$ を推定できる。参照状態の $\mathbf{g}_{i,0}$ と比較し、小さなひずみ $\boldsymbol{\varepsilon}$ に対して
$$
\Delta \mathbf{g}_i(\mathbf{r}) = \mathbf{g}_i(\mathbf{r})-\mathbf{g}_{i,0}
\approx -\boldsymbol{\varepsilon}^{\mathsf{T}}\,\mathbf{g}_{i,0}
$$
が成り立つ。複数の $\mathbf{g}_i$ を用いれば、面内ひずみテンソル成分（例：$\varepsilon_{xx},\varepsilon_{yy},\varepsilon_{xy}$）を推定できる。

現実には厚みによる動力学回折、試料傾き、プローブ収束角、検出器幾何の誤差が混入するため、参照領域の設定、幾何補正、ディスク位置推定法（相関法、位相相関、モデルフィットなど）の選択が結果に強く影響する。

### 3.4 電子タイコグラフィ（ptychography）と位相再構成
タイコグラフィは、互いに重なり合う走査点から得た回折像群を用い、$O(\mathbf{r})$ と $P(\mathbf{r})$ を同時に推定して位相像を復元する方法である。基本式
$$
I(\mathbf{R},\mathbf{q}) = \left|\mathcal{F}[P(\mathbf{r}-\mathbf{R})\,O(\mathbf{r})]\right|^2
$$
を満たす $O$ を反復的に探索する。得られる位相は、軽元素やビーム損傷の強い材料に対しても高感度であり、低線量・高分解能像へ道を開いた。

## 4. 5D-STEMが有効となるダイナミクスの範囲
### 4.1 時間分解の二つの流儀
時間 $t$ を付加する場合、時間分解の獲得方法は大別して二つに分かれる。

- 超高速（フェムト秒〜ナノ秒）：UTEMのポンプ・プローブ  
  レーザー励起などに同期したパルス電子で、同一状態の繰り返しを前提にストロボ的に像を積算する。
- 準静的〜中速（ミリ秒〜分）：その場環境での連続取得  
  加熱・冷却・電場印加・機械応力などで進行する構造変化を連続的に追跡し、$I(\mathbf{r},\mathbf{q},t)$ を得る。

前者は「不可逆過程を直接一回で撮る」ことよりも「再現性のある過程を高い時間分解で測る」ことに強い。後者は再現性を必須としない代わりに、ドリフト補正や線量蓄積が支配的になりやすい。

### 4.2 5D-STEMで狙える物理量
5D-STEMが特に力を発揮する対象は、格子情報と場情報が同時に重要な系である。

- 相転移・相分離の萌芽：局所ひずみと短距離秩序の時間変化
- 強誘電・マルチフェロイク：分極に起因する内部場とドメイン壁の運動
- トポロジカル磁性・スキルミオン系：投影磁束密度と欠陥・歪み場の相関
- 薄膜・界面：ミスフィットひずみ、電荷移動、界面電場の共存
- ガラス・アモルファス：中距離秩序の空間揺らぎと緩和ダイナミクス

時間分解を付与すると、これらが「静的な地図」から「時系列の地図」へ拡張され、駆動場に対する応答の遅れ、ヒステリシス、非線形性などが観測対象になる。

## 5. 計測系：ピクセル化検出器と同期
### 5.1 ピクセル化検出器の要請
4D/5D-STEMが成立するには、回折像を高速に、かつ飽和せずに記録できる検出器が必要である。重要な指標は以下である。

- フレームレート：走査の滞留時間に見合う時間分解
- ダイナミックレンジ：直進ビーム近傍の強度と高角散乱を同時に扱う能力
- 量子効率とノイズ：低線量観測でのS/N
- 幾何安定性：中心位置・歪みの再現性（DPCやひずみ推定に直結）

装置側では、走査信号とカメラトリガの同期が本質的である。走査の折り返し期間の扱い、ライン間の待ち時間、部分読み出しなどの設計がデータ整合性を左右する。

### 5.2 データ量の見積もり
データ点数は
$$
N = N_xN_yN_{q_x}N_{q_y}N_{\lambda}
$$
でスケールする。例として、$N_x=N_y=256$、$N_{q_x}=N_{q_y}=256$、$N_{\lambda}=1$ の場合、
$$
N=256^4 \approx 4.3\times 10^9
$$
である。16 bit（2 byte）で保存すると約 8.6 GB となる。ここに時間 $N_t=100$ を加えると約 860 GB 規模となり、保存・転送・解析の全てに現実的な設計が必要になる。

## 6. 物理量抽出の方法
| 目的 | 入力として使う量 | 代表的な計算量 | 出力の例 |
|---|---|---|---|
| 仮想BF/ADF/DF | $I(\mathbf{r},\mathbf{q})$ | $\int_{\Omega} I\,d^2\mathbf{q}$ | コントラスト像、方位選択像 |
| DPC（位相勾配） | $I(\mathbf{r},\mathbf{q})$ | $\langle \mathbf{q}\rangle$ | 投影電場・投影磁場の指標 |
| ひずみマップ | Braggディスク中心 | $\Delta\mathbf{g}\approx -\varepsilon^{\mathsf{T}}\mathbf{g}$ | $\varepsilon_{xx},\varepsilon_{yy},\varepsilon_{xy}$ |
| 方位マップ | 回折パターン全体 | パターンマッチング/相関 | 結晶方位、粒界分布 |
| 位相再構成 | 走査点の重なり＋回折 | 反復再構成 | 位相像、軽元素像、内部ポテンシャルの情報 |
| 中距離秩序 | 散乱強度分布 | 角度平均・相関関数 | アモルファスの秩序指標 |

## 7. 測定と解析での留意点
### 7.1 幾何学校正の重要性
DPCやひずみは、回折像の「位置情報」に直接依存する。したがって以下が支配的である。

- ビーム中心の推定（直進ディスク中心）
- カメラ長とピクセルスケールの校正
- 検出器歪み（非線形）とその補正
- 試料傾きと厚みの影響の分離

わずかな幾何誤差が、$\langle\mathbf{q}\rangle$ や Braggディスク位置の系統誤差として現れ、場やひずみに擬似的な構造を作ることがある。

### 7.2 動力学回折と多重散乱
薄い試料では運動学的な解釈が有効になりやすいが、電子は強く散乱しやすく、多重散乱が無視できない領域が広い。特に結晶性材料の強い回折条件では、Braggディスクの変形や強度再配分が起こり、単純な「中心位置＝逆格子ベクトル」という対応が乱れる。厚み依存を把握し、必要ならシミュレーション（マルチスライス等）と照合する姿勢が有効である。

### 7.3 線量・損傷と時間次元の相互作用
時間を付与すると、同一領域を繰り返し照射することが増え、損傷や汚染、試料改質が観測対象のダイナミクスと混ざりやすい。低線量化は単に像を荒くするのではなく、位相再構成や統計処理と組み合わせることで「必要情報の抽出」に置き換える考え方が重要である。

## 8. 基本的な解析環境
4D/5D-STEMは多次元配列データであるため、解析環境は「多次元データを読む・扱う・可視化する」能力が中心になる。代表的な公開実装として以下が知られている。

- 4D-STEMの多モード解析：py4DSTEM（校正、ひずみ、DPC、タイコグラフィなど）
- 大規模データの分散処理・ストリーム処理：LiberTEM
- 多次元データ解析の基盤：HyperSpy
- 回折・方位解析寄り：pyxem（HyperSpy系）

データ形式としてはHDF5系が広く使われ、メタデータと多次元配列を一体で保持できる利点がある。装置・ソフトが異なると保存形式やメタデータ量が変わるため、再現性のある記録（加速電圧、カメラ長、収束角、走査条件、検出器設定）を残すことが学術的に重要である。

## 9. 何が「新しい観測」なのか
5D-STEMを用いた研究を読む際には、次の観点で整理すると理解しやすい。

- 追加次元 $\lambda$ が何であり、どの物理量の分離に効いているか
  - 例：$t$ により、ひずみの緩和時間と場の応答時間の差を分ける
- 4Dのどの写像で量を定義しているか
  - 例：DPCの一次モーメント、Braggディスク位置、位相再構成など
- 校正と誤差源をどのように扱っているか
  - 例：基準領域、幾何補正、厚み・傾きの扱い
- その場条件が観測対象に与える影響が評価されているか
  - 例：温度勾配、電極配置、ビーム誘起効果

この整理により、単なる「高次元データの提示」ではなく、材料中の相互作用（格子・電荷・スピン・欠陥）がどのような時空間スケールで結びつくか、という物理へ到達しやすくなる。

## まとめ
5D-STEMは、4D-STEMで得られる $I(\mathbf{r},\mathbf{q})$ を核に、時間・分光・傾斜などの追加次元を導入して $I(\mathbf{r},\mathbf{q},\lambda)$ として扱うことで、格子、位相、電磁場、ダイナミクスを同一の枠組みで読み解く手法群である。ピクセル化検出器と多次元解析の整備により、ナノ材料の「構造と物理量の相関」を静的にも動的にも追跡可能となり、界面・欠陥・非平衡過程の理解を強く押し進める基盤になりつつある。

## 関連研究
1. J. M. Rodenburg and R. H. T. Bates, The theory of super-resolution electron microscopy via Wigner-distribution deconvolution, Phil. Trans. R. Soc. Lond. A 339, 521–553 (1992)
2. R. Yu et al., Introduction to electron ptychography for materials scientists, Microstructures (2024)
   https://www.oaepublish.com/articles/microstructures.2024.46
3. 4D-STEMで界面電場などを扱う例（center-of-mass法の議論を含む）
   https://juser.fz-juelich.de/record/904924/files/Grieb2021_4DSTEM_Interfaces_GaN_last_submitted_file.pdf
4. 4D-STEM傾斜シリーズによる再構成（4D-STEMトモグラフィの方向）
   https://link.aps.org/doi/10.1103/PhysRevApplied.19.054062
5. ビーム損傷の強い材料での4D-STEMタイコグラフィの例（MOFの低線量観測）
   https://www.nature.com/articles/s41467-025-56215-z
6. py4DSTEM（4D-STEM解析の公開実装）
   https://github.com/py4dstem/py4DSTEM
7. LiberTEM（大規模データ処理・ストリーム処理）
   https://libertem.github.io/
8. Hitachi High-Tech（4D-STEMやタイコグラフィに触れる国内記事）
   https://www.hitachi-hightech.com/jp/ja/sinews/special/009/
9. Gatan（国内向け4D-STEM解説ページ）
   https://www.gatan.com/jp/techniques/4d-stem
