# モンテカルロ計算におけるクラスター展開モデル

クラスター展開（Cluster Expansion, CE）は、第一原理計算で得られた合金の配置エネルギーを、原子占有を表す離散変数（スピン変数）で表現し、全エネルギーを有効クラスター相互作用（ECI）として近似する手法である。第一原理計算のみで相平衡を求めることは計算量的に困難だが、CEによりエネルギー評価を高速化することで、モンテカルロ法（MC）による相平衡・相図計算が実現できる。

## 参考ドキュメント
- 東北大学多元物質科学研究所「クラスター展開法による合金状態図の計算」  
  https://www.tagen.tohoku.ac.jp/labs/ota/lecture/cluster_expansion.pdf
- 名古屋大学・固体物理関連資料「第一原理計算とクラスター展開の基礎」  
  https://www2.yukawa.kyoto-u.ac.jp/~moriyama/files/cluster_expansion_intro.pdf
- 大阪大学・材料計算ゼミ資料「ATATを用いたクラスター展開とMCによる相図計算」  
  https://www.mat.eng.osaka-u.ac.jp/lecture/cluster_atat_handson.pdf


## クラスター展開の基本流れ

1. 第一原理計算（DFT）
   - 代表的な配置（スーパーセル構造）について全エネルギーを計算
   - 計算対象は構造多様性・組成範囲をカバーするよう選択する

2. クラスター展開モデルの構築
   - 占有変数 σ_i（例：A=+1, B=−1 など）を用いてエネルギーを展開
   - 典型的なCEの形式  
     $E(\sigma) = J_0 + \sum_{\alpha} J_{\alpha} \Pi_{\alpha}(\sigma)$  
     ここで  
     - $J_{\alpha}$：有効クラスター相互作用（ECI）  
     - $\Pi_{\alpha}$：クラスター関数（対・三体・四体など）
   - ECIs は回帰により推定（LASSO回帰や交差検証で過学習を防ぐ）
   - 対称性で等価なクラスターをまとめ、「独立なクラスター」の有限個だけを残す。
   - それぞれのクラスターに対応する係数を 有効クラスター相互作用 (Effective Cluster Interaction, ECI) と呼ぶ。


3. モンテカルロシミュレーション
   - CEで得られた高速エネルギー評価を用いて、有限温度でMC計算を実行
   - 得られる主な物理量  
     - 平衡組成・秩序度・自由エネルギー変化  
     - 相転移温度、相図、短距離規則度など
   - 必要に応じて、代表構造を再びDFTで確認して精度を検証する


## 有効クラスター相互作用 (ECI) の決定手順

- ステップ 1：構造サンプルの選定
  - 単位胞・スーパーセルの各種秩序配置をいくつか作成（数十〜数百構造）。
  - 各構造に対し、DFT 等でエネルギー $E^{\text{DFT}}$ を計算。

- ステップ 2：線形回帰によるフィッティング
  - 各構造について、クラスター基底の「平均値」 $\langle \prod_{i\in \alpha}\sigma_i \rangle$ を計算。
  - 連立方程式
    $$
      E^{\text{DFT}}_k \approx \sum_{\alpha} J_\alpha\,\Phi_\alpha^{(k)}
    $$
    を解いて $J_\alpha$（ECI）を求める。
  - 過剰適合を避けるため、LASSO・交差検証などを用いて「必要なクラスターだけ」を選ぶことも多い。

- ステップ 3：検証
  - フィットに使っていない追加構造で、CE による予測エネルギーと DFT のエネルギーを比較し、誤差・バイアスを確認。
  - 誤差が大きい場合は、クラスターの追加・削除・学習構造の見直しを行う。


## クラスター展開とモンテカルロの連携

- CE により得られた有効ハミルトニアン：
  $$
    \mathcal{H}_{\text{CE}}(\{\sigma\}) = E(\{\sigma\})
  $$
  を、統計力学のボルツマン重み
  $$
    p(\{\sigma\}) \propto \exp\big(-\beta\,\mathcal{H}_{\text{CE}}(\{\sigma\})\big)
  $$
  に代入すると、通常のスピン／占有格子模型の MC 計算と同じ形式になる。

- エネルギー評価が高速：
  - DFT：1 構造あたり「分〜時間〜日」オーダー。
  - CE：1 構造あたり「μs〜ms」オーダー。
  - → 各 MC ステップで何度もエネルギーを評価できるので、10⁵〜10⁷ ステップ規模の MC が可能。

- MC で評価できる量：
  - 秩序–無秩序転移温度 $T_c$
  - 相図（温度–組成・外場・応力など）
  - 自発秩序パラメータ、比熱・感受率
  - クラスターごとの占有・短距離秩序 (SRO)


## 磁性体・合金への応用

- 合金（例：Fe–Co, Fe–Cr など）
  - DFT で各種規則構造の全エネルギーを計算。
  - CE で「組成変化・配置変化に対する有効ハミルトニアン」を構築。
  - その CE を用いた MC で、温度–組成平面の相図（秩序相・固溶体・分離相）を決定。

- 磁性体
  - サイトごとにスピン変数 $\sigma_i=\pm 1$（またはベクトルスピン）を導入し、
  - CE の形で有効スピンハミルトニアン（Heisenberg 型、イジング型＋多体項）を構築。
  - これを MC でサンプリングし、キュリー温度 $T_c$、磁化曲線、スピン相関などを評価。
  - 「第一原理 → CE → スピン MC」という流れで、実材料の Tc 予測が行われる。


## 実装ツールの例
- CASM（Cluster Expansion and Statistical Mechanics）
- ATAT（Alloy Theoretic Automated Toolkit）
- ICET（Pythonベース、CE＋MCが容易）


## 解析的なクラスター展開
- 統計力学の教科書で出てくる「高温クラスター展開」「バイリアル展開」も「クラスター展開」と呼ばれる。
  - こちらは、分配関数・自由エネルギーを「結合グラフ」の寄与として解析的に展開する方法。
  - 主目的は「級数としての厳密解・近似解」にあり、数値 MC とは別ライン。
- 合金・スピン系における CE＋MC は：
  - 「エネルギー汎関数を有限個のクラスター基底で近似 → 有効模型として MC にかける」
  という数値的・データ駆動的なクラスター展開。
- 名前は同じ「クラスター展開」だが、  
  - 「解析的な系列展開」か  
  - 「数値 CE＋MC 用の有効ハミルトニアン構築」か  
  を意識して区別しておくと混乱しにくい。

## 注意点
- クラスターの選び方
  - 近距離のペア・三体・四体クラスターを中心にし、遠距離・高次数のクラスターは切り捨てる。
  - どこまで含めるかは、クロスバリデーション誤差・物理的な知識（相互作用の減衰）を参考に決める。
- 学習構造のバランス
  - 格子定数・応力・組成・秩序状態など、興味のある条件を網羅するように構造を選ぶ。
  - 「相図のどの領域をよく再現したいか」で、サンプル構造の設計が変わる。
- CE の妥当性のチェック
  - 追加の DFT 計算で予測のチェック、
  - 実験の相図や Tc と比較、
  - 物理的に不自然な秩序状態が現れていないか、などを確認する。
- MC 側の注意点
  - 通常のスピン MC と同様に、熱化・自己相関・有限サイズ効果に注意。
  - 相転移近傍ではクラスターアルゴリズム（Swendsen–Wang, Wolff）などの導入も検討。