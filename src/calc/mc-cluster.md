# モンテカルロ計算におけるクラスター展開
作成日：2025年11月23日

## 概要
- ここでは、**第一原理計算などから得られたエネルギーを「クラスター展開 (cluster expansion)」で近似し、その有効ハミルトニアンを用いてモンテカルロ (MC) 計算を行う枠組み**について整理する。
- 主な用途：
  - 合金・固溶体の相図計算（Fe–Co, Fe–Cr など）
  - サイト占有・スピン変数を持つ格子模型の有限温度物性（秩序–無秩序転移、Tc、自由エネルギー）
- ポイント：
  - DFT など「高価な」計算で得た少数の構造エネルギーをもとに、
  - **格子上の任意の配置のエネルギーを近似的に高速評価できる有効ハミルトニアン**を作り、
  - それを用いて大量の MC サンプリングを行う。

---

## クラスター展開の基本アイデア

- 格子上の配置（スピン・占有変数）を \(\{\sigma_i\}\) とする：
  - 例：合金 A–B なら、サイト \(i\) に A,B が入ることを \(\sigma_i = +1, -1\) で表す。
  - 磁性体なら \(\sigma_i = \pm 1\) を Ising スピンとして扱う。
- エネルギーを「クラスターの寄与の和」として展開：
  \[
    E(\{\sigma\}) = J_0
      + \sum_i J_i\,\sigma_i
      + \sum_{i<j} J_{ij}\,\sigma_i\sigma_j
      + \sum_{i<j<k} J_{ijk}\,\sigma_i\sigma_j\sigma_k
      + \cdots
  \]
  - \(J_0\)：定数項
  - \(J_i\)：単サイト項
  - \(J_{ij}\)：2 体クラスター（ペア相互作用）
  - \(J_{ijk}\)：3 体クラスター … など
- 実務では：
  - 対称性で等価なクラスターをまとめ、「独立なクラスター」の有限個だけを残す。
  - それぞれのクラスターに対応する係数を **有効クラスター相互作用 (Effective Cluster Interaction, ECI)** と呼ぶ。

---

## 有効クラスター相互作用 (ECI) の決定手順

- ステップ 1：構造サンプルの選定
  - 単位胞・スーパーセルの各種秩序配置をいくつか作成（数十〜数百構造）。
  - 各構造に対し、DFT 等でエネルギー \(E^{\text{DFT}}\) を計算。

- ステップ 2：線形回帰によるフィッティング
  - 各構造について、クラスター基底の「平均値」 \(\langle \prod_{i\in \alpha}\sigma_i \rangle\) を計算。
  - 連立方程式
    \[
      E^{\text{DFT}}_k \approx \sum_{\alpha} J_\alpha\,\Phi_\alpha^{(k)}
    \]
    を解いて \(J_\alpha\)（ECI）を求める。
  - 過剰適合を避けるため、LASSO・交差検証などを用いて「必要なクラスターだけ」を選ぶことも多い。

- ステップ 3：検証
  - フィットに使っていない追加構造で、CE による予測エネルギーと DFT のエネルギーを比較し、誤差・バイアスを確認。
  - 誤差が大きい場合は、クラスターの追加・削除・学習構造の見直しを行う。

---

## クラスター展開とモンテカルロの連携

- CE により得られた有効ハミルトニアン：
  \[
    \mathcal{H}_{\text{CE}}(\{\sigma\}) = E(\{\sigma\})
  \]
  を、統計力学のボルツマン重み
  \[
    p(\{\sigma\}) \propto \exp\big(-\beta\,\mathcal{H}_{\text{CE}}(\{\sigma\})\big)
  \]
  に代入すると、**通常のスピン／占有格子模型の MC 計算**と同じ形式になる。

- エネルギー評価が高速：
  - DFT：1 構造あたり「分〜時間〜日」オーダー。
  - CE：1 構造あたり「μs〜ms」オーダー。
  - → 各 MC ステップで何度もエネルギーを評価できるので、**10⁵〜10⁷ ステップ規模の MC が可能**。

- MC で評価できる量：
  - 秩序–無秩序転移温度 \(T_c\)
  - 相図（温度–組成・外場・応力など）
  - 自発秩序パラメータ、比熱・感受率
  - クラスターごとの占有・短距離秩序 (SRO)

---

## 磁性体・合金への典型的な応用イメージ

- 合金（例：Fe–Co, Fe–Cr など）
  - DFT で各種規則構造の全エネルギーを計算。
  - CE で「組成変化・配置変化に対する有効ハミルトニアン」を構築。
  - その CE を用いた MC で、温度–組成平面の相図（秩序相・固溶体・分離相）を決定。

- 磁性体
  - サイトごとにスピン変数 \(\sigma_i=\pm 1\)（またはベクトルスピン）を導入し、
  - CE の形で有効スピンハミルトニアン（Heisenberg 型、イジング型＋多体項）を構築。
  - これを MC でサンプリングし、キュリー温度 \(T_c\)、磁化曲線、スピン相関などを評価。
  - 「第一原理 → CE → スピン MC」という流れで、実材料の Tc 予測が行われる。

---

## 「解析的なクラスター展開」との違い・関係

- 統計力学の教科書で出てくる **「高温クラスター展開」「バイリアル展開」** も「クラスター展開」と呼ばれる。
  - こちらは、分配関数・自由エネルギーを「結合グラフ」の寄与として解析的に展開する方法。
  - 主目的は「級数としての厳密解・近似解」にあり、数値 MC とは別ライン。
- 合金・スピン系における **CE＋MC** は：
  - 「エネルギー汎関数を有限個のクラスター基底で近似 → 有効模型として MC にかける」
  という **数値的・データ駆動的なクラスター展開**。
- 名前は同じ「クラスター展開」だが、  
  - 「解析的な系列展開」か  
  - 「数値 CE＋MC 用の有効ハミルトニアン構築」か  
  を意識して区別しておくと混乱しにくい。

---

## 実務上のポイント・注意点

- クラスターの選び方
  - 近距離のペア・三体・四体クラスターを中心にし、遠距離・高次数のクラスターは切り捨てる。
  - どこまで含めるかは、クロスバリデーション誤差・物理的な知識（相互作用の減衰）を参考に決める。

- 学習構造のバランス
  - 格子定数・応力・組成・秩序状態など、興味のある条件を網羅するように構造を選ぶ。
  - 「相図のどの領域をよく再現したいか」で、サンプル構造の設計が変わる。

- CE の妥当性のチェック
  - 追加の DFT 計算で予測のチェック、
  - 実験の相図や Tc と比較、
  - 物理的に不自然な秩序状態が現れていないか、などを確認する。

- MC 側の注意点
  - 通常のスピン MC と同様に、熱化・自己相関・有限サイズ効果に注意。
  - 相転移近傍ではクラスターアルゴリズム（Swendsen–Wang, Wolff）などの導入も検討。

