# 仮想結晶近似（VCA）とコヒーレントポテンシャル近似（CPA）

置換不規則合金やドープ系では、原子配列の乱れが電子状態・磁性・輸送を左右することが多い。VCA は乱れを平均ポテンシャルで置き換えて組成依存を軽量に追う近似であり、CPA は平均媒質を自己無撞着に決めて合金散乱（寿命・バンド幅）まで含めて扱う近似である。

### 参考ドキュメント
- VASP Wiki: VCA（公式）  
  https://vasp.at/wiki/VCA
- L. Bellaiche and D. Vanderbilt, Virtual crystal approximation revisited, Phys. Rev. B 61, 7877 (2000)  
  https://doi.org/10.1103/PhysRevB.61.7877
- MateriApps アプリコンシェルジュ: 混晶の第一原理計算（VCA/CPA/SQS の位置付け、日本語）  
  https://ma.issp.u-tokyo.ac.jp/concierge/2517

## 1. 不規則合金で何が難しいのか

置換不規則合金 $A_{1-x}B_x$ は、理想的には多数の原子配置（ミクロ状態）を考え、観測量を配置平均する必要がある。しかし第一原理計算で無作為配置スーパーセルを多数用意して平均をとるのは、計算量が大きい。

不規則性がもたらす物理は大きく分けて次の三層である。

- 平均的効果（バンド充填、平均結合強度、平均格子定数など）
- 散乱効果（合金散乱による寿命の有限化、スペクトルの広がり、抵抗率の増加など）
- 局所環境効果（局所歪み、短距離秩序 SRO、クラスター化、局所電荷移動のばらつきなど）

VCA は主に一つ目を、CPA は一つ目と二つ目を平均場的に扱う枠組みである。三つ目は原理的に難しく、SQS やクラスター展開など別枠が必要になりやすい。


## 2. 仮想結晶近似（VCA）の基礎

### 2.1 VCA の定義と考え方
VCA（Virtual Crystal Approximation）は、置換不規則合金を「組成平均された仮想原子」で置き換え、元の単位胞の周期性を保ったまま計算する近似である。概念的には、同一サイトの外部ポテンシャル（あるいは擬ポテンシャル／有効ポテンシャル）を線形混合する：

$$
V_{\mathrm{VCA}}(\mathbf{r};x) \approx (1-x)\,V_A(\mathbf{r}) + x\,V_B(\mathbf{r})
$$

この結果、電子構造は「平均化された結晶」に対して定義され、バンドは鋭い準粒子として残る（寿命の有限化やバンド幅増大は基本的に出ない）という性格を持つ。

### 2.2 VCA が表せること／表しにくいこと
VCA が表せるのは主に平均的効果である。

- 組成によるバンド充填（フェルミ準位の移動）と DOS 形状の連続変化
- 平均的な磁化・局所モーメントのトレンド（ただし局所環境ばらつきは含まない）
- 格子定数を組成で掃引した際の平均的エネルギー地形（平均場の範囲）

一方、次は本質的に捨象される。

- 合金散乱に由来する寿命の有限化、スペクトルの広がり、抵抗率など
- 「A 近傍」「B 近傍」の局所環境に依存する電荷移動・局所歪み・局所磁化の分布
- 短距離秩序（SRO）やクラスター化が支配する現象

このため VCA は、連続組成掃引で全体傾向を素早く把握するのに適し、散乱や局所構造が支配的な量の定量には不向きである。

### 2.3 VASP における VCA 
VASP の VCA は、INCAR の VCA タグにより、POTCAR 内の要素データセットへ重みを与えて「仮想原子」を構成する実装である。入力の作法としては、混合に使う要素を POTCAR に用意し、POSCAR 側でも同一格子点上に該当 species を対応づけて記述し、VCA で重みを指定することで「仮想原子 1 個」を定義する。

VASP Wiki（公式）に実装と注意がまとめられている。  
https://vasp.at/wiki/VCA

### 2.4 VCA の信頼性に影響する要因
VCA は便利であるが、混合する擬ポテンシャル／PAW データセットの整合性に敏感である。例えば半芯（semicore）を価電子として含めるかどうか、参照配置、カットオフ特性が大きく異なると、混合が不自然になりやすい。組成端点 $x=0,1$ の整合性（純相計算へ戻ること）をまず確認し、代表組成でスーパーセル等と比較するのが妥当である。


## 3. コヒーレントポテンシャル近似（CPA）の基礎

### 3.1 CPA の基本思想：平均媒質を自己無撞着に決める
CPA（Coherent Potential Approximation）は、不規則合金を「散乱を含む平均媒質（coherent medium）」で表し、その媒質が合金の平均応答を再現するように自己無撞着に決める近似である。特に KKR（multiple scattering）形式と相性が良く、KKR-CPA として広く使われる。

VCA が平均ポテンシャルだけを混合して「完全に周期的な結晶」を作るのに対し、CPA は平均媒質のグリーン関数（あるいは自己エネルギー）を導入し、合金散乱によりスペクトルが広がることを表現する点が本質である。

### 3.2 代表的な数式（単一サイト CPA の標準形）
単一サイト CPA の見通しとして、各サイトが平均媒質に埋め込まれたときの散乱を考える。平均媒質を特徴づける量として、エネルギー依存の「コヒーレントポテンシャル」あるいは自己エネルギー $\Sigma(E)$ を導入し、平均グリーン関数を

$$
\bar{G}(E) = \left[E - H_0 - \Sigma(E)\right]^{-1}
$$

のように定義する（記号は表現により異なる）。CPA の自己無撞着条件は、平均媒質に A または B の原子を埋め込んだときの散乱が、組成平均で打ち消し合う（平均散乱がゼロになる）という形で表されることが多い。

散乱行列（$t$ 行列）や $T$ 行列を用いた典型表現として、

$$
(1-x)\,T_A(E) + x\,T_B(E) = 0
$$

の形（平均散乱ゼロ条件）が現れる。ここで $T_A(E)$ は「平均媒質中に A 原子を入れたときの散乱」を表す量であり、媒質（すなわち $\Sigma(E)$ や埋め込みグリーン関数）に依存する。よってこれは自己無撞着方程式となり、反復で解く。

この結果、$\Sigma(E)$ は一般に複素数となり、虚部が準粒子寿命の有限性（スペクトル広がり）に対応する：

$$
A(\mathbf{k},E) = -\frac{1}{\pi}\,\mathrm{Im}\,\bar{G}(\mathbf{k},E)
$$

ここで $A(\mathbf{k},E)$ は合金のスペクトル関数であり、VCA のような鋭いバンド線ではなく、エネルギー幅を持った分布として表現される。

### 3.3 CPA が得意とする量
CPA は「配置平均された単電子物性」を得意とし、特に散乱が効く量に強みがある。

- 合金散乱によるバンドの広がり、寿命、状態密度の平滑化
- 配置平均された磁気モーメントや交換相互作用の評価（枠組みに依存）
- Kubo 型の輸送理論と組み合わせた抵抗率、異常ホール、スピンホールなど（実装依存）

磁性では、局所モーメントの向きが乱れた状態を「成分混合」として扱う DLM（disordered local moment）と CPA を組み合わせ、有限温度磁性の平均場近似として用いる流儀もある。

### 3.4 CPA の限界
基本形の CPA は「単一サイト」近似であり、次は表しにくい。

- 近接サイト相関（SRO）やクラスター化
- 局所歪みや局所構造緩和（原子サイズ差が大きい場合に重要）
- 特定配置に由来する局所準位の分裂や局所結合ネットワーク

これらを改善する拡張として、クラスター CPA（例：NL-CPA など）や、SQS／スーパーセル平均との併用が用いられる。


## 4. VCA と CPA の比較

| 観点 | VCA | CPA |
|---|---|---|
| 乱れの扱い | 平均ポテンシャル（仮想原子） | 自己無撞着な平均媒質（散乱を含む） |
| 周期性 | 完全に周期的（鋭いバンド） | 配置平均された非周期性を媒質に押し込む（広がったスペクトル） |
| 合金散乱・寿命 | 基本的に含まれない | 含まれる（$\mathrm{Im}\,\Sigma \neq 0$） |
| 局所環境（SRO、局所歪み） | 含まれない | 単一サイトでは含まれない（拡張が必要） |
| 計算コスト | 低い（単位胞のまま） | 方法と実装に依存するが、一般に VCA より重い |
| 適する用途 | 組成トレンドの俯瞰、バンド充填の効果 | 散乱が効く電子状態・輸送、スペクトルの広がり |
| 代表的実装 | 平面波 DFT（VASP など）での VCA | KKR-CPA（SPR-KKR、AkaiKKR など） |


## 5. どのように使い分けるか

- 組成を細かく連続掃引し、フェルミ準位近傍の充填や DOS の変化、平均モーメントの傾向を掴みたい場合は VCA が有効である。
- 抵抗率、寿命、スペクトルの平滑化、合金散乱が本質となる量を扱う場合は CPA が自然である。
- 原子サイズ差が大きく局所歪みが重要な場合、VCA/CPA のみでは不足しやすく、SQS やスーパーセル緩和を組み合わせる必要がある。
- 短距離秩序やクラスター化が疑われる場合、クラスター展開・モンテカルロ、クラスター CPA、SQS 比較などが必要になる。


## 6. VCA/CPA と他手法（SQS・スーパーセル・クラスター展開）との関係

| 目的 | 有力な方法 | 要点 |
|---|---|---|
| 局所歪み・局所環境を入れる | スーパーセル（無作為配置） | 物理を素直に入れられるが平均に計算量が必要である |
| 少数構造で統計を近似する | SQS | 相関関数を再現するよう設計された構造である |
| 散乱を平均場で扱う | CPA（KKR-CPA） | スペクトル広がりや輸送へつながりやすい |
| 相安定性・秩序化の統計 | クラスター展開 + MC | SRO・相分離・秩序化を扱える |

VCA と CPA は、配置平均の難しさを“平均化の理論”として引き受ける近似であり、SQS やスーパーセルは“具体的配置を直接計算する”方法である。両者は競合というより補完関係にある。


## 7. 磁性材料（Fe–Co 系、Fe–Co–N 系）への含意

Fe–Co 系や Fe$_{4-x}$Co$_x$N のような金属磁性体では、組成でフェルミ準位近傍の $d$ 状態の占有が変化し、磁化・磁気異方性・磁気弾性が敏感に変わる場合がある。

- VCA は、平均的なバンド充填に起因する傾向を見通しよく与える。
- CPA は、合金散乱によるスペクトル広がりが SOC 起源の微小エネルギー差や輸送に与える影響を、配置平均の文脈で扱いやすい。

磁気弾性や磁気異方性のように微小差に敏感な量では、平均化近似の選び方が結論に影響し得るため、代表組成での SQS／スーパーセル比較や、CPA によるスペクトル広がりの評価を併用すると議論の解像度が上がる。

### 参考資料
- VASP Wiki: VCA（公式）  
  https://vasp.at/wiki/VCA
- L. Bellaiche and D. Vanderbilt, Virtual crystal approximation revisited, Phys. Rev. B 61, 7877 (2000)  
  https://doi.org/10.1103/PhysRevB.61.7877
- MateriApps アプリコンシェルジュ: 混晶の第一原理計算（VCA/CPA/SQS の位置付け、日本語）  
  https://ma.issp.u-tokyo.ac.jp/concierge/2517
- J. Soven, Coherent-Potential Model of Substitutional Disordered Alloys, Phys. Rev. 156, 809 (1967)  
  https://doi.org/10.1103/PhysRev.156.809
- B. L. Gyorffy, Coherent-Potential Approximation for a Nonoverlapping-Muffin-Tin-Potential Model of Random Substitutional Alloys, Phys. Rev. B 5, 2382 (1972)  
  https://doi.org/10.1103/PhysRevB.5.2382
- SPR-KKR（KKR-CPA を含む代表的実装の一つ）  
  https://www.ebert.cup.uni-muenchen.de/SPRKKR
