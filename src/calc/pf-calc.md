# フェーズフィールド法の数値解法

フェーズフィールド方程式は、自由エネルギー汎関数の勾配流として構造が決まるため、数値解法にも保存則と散逸則を反映させることが重要である。離散化の選択は、界面幅の解像、非線形性、連成場、計算資源の制約により支配される。

## 参考ドキュメント
1) Phase-Field Recommended Practices Guide: Numerical Implementation（NIST）
https://pages.nist.gov/pf-recommended-practices/bp-guide-gh/ch2-numerical-implementation.html
2) L. Q. Chen, Applications of semi-implicit Fourier-spectral method to phase-field equations, Computer Physics Communications (1998)
https://www.sciencedirect.com/science/article/abs/pii/S001046559700115X
3) 名古屋大学 PFM 講義ノート：第11章 Phase-field法1（凝固）
https://www.material.nagoya-u.ac.jp/PFM/docs/Lecture_H20/H20_Chapter_11.pdf


## 1. 支配方程式
代表例は、非保存のAllen–Cahn（AC）型と、保存量を扱うCahn–Hilliard（CH）型である。
- AC（反応拡散型）
  $$
  \displaystyle \frac{\partial \eta}{\partial t} = -L \frac{\delta F}{\delta \eta}
  $$
- CH（4階拡散型）
  $$
  \displaystyle \frac{\partial c}{\partial t} = \nabla\cdot\left(M\nabla \mu\right),\ \mu=\frac{\delta F}{\delta c}
  $$

数値的な要点は次の通りである。
- CHは空間4階（または2階×2の分割形）であり、陽的時間積分は安定条件が非常に厳しい
- 非線形自由エネルギー（多井戸、対数項、CALPHAD等）により剛性が増す
- 連成（熱・弾性・流体など）では未知数が増え、単純な解法では収束が不安定になりやすい
- 正しい解に見えても、質量保存や自由エネルギー減少が壊れると物理的解釈が崩れる

## 2. 無次元化とメッシュ設計
### 2.1 界面幅と格子幅
界面を有限幅として表すため、界面幅Wを十分に解像する必要がある。目安として界面に対して数点では不十分であり、界面が滑らかに表現される格子幅Δxを選ぶ。

### 2.2 代表的な時間スケール
- 拡散支配（CH）では、$Δx$ が半分になると必要なΔtが急激に小さくなる傾向がある
- 界面移動支配（AC）でも $Δt$ は $Δx$ に強く依存する

このため、計算領域と解像度を先に固定し、時間積分は半陰・陰を基本に設計するのが定石である。

## 3. 空間離散化：FDM/FVM/FEM/FFTの使い分け
### 3.1 有限差分法（FDM）
直交格子で最も簡潔に実装できる。ラプラシアンは例えば2次精度で
$$
\nabla^2 u \approx \sum_{\alpha=x,y,z}\frac{u(\mathbf{r}+ \Delta \alpha)-2u(\mathbf{r})+u(\mathbf{r}- \Delta \alpha)}{\Delta \alpha^2}
$$
となる。CHの4階項は、二重ラプラシアン（$\nabla^4\sim\nabla^2(\nabla^2)$）として組むか、後述の分割形で扱う。

### 3.2 有限体積法（FVM）
保存形（$\partial_t c + \nabla\cdot \mathbf{J}=0$）との相性が良い。CHをフラックス形式で書けば質量保存を数値的に担保しやすい。

### 3.3 有限要素法（FEM）
複雑形状や弾性・熱との連成に強い。一方、CHの4階をそのまま弱形式化すると$C^1$連続要素が必要になりがちであり、実装上は「2階×2」への分割がよく用いられる。

CHの分割形（混合形式）の例：
$$
\mu = \frac{\partial f}{\partial c} - \kappa\nabla^2 c,\qquad
\frac{\partial c}{\partial t} = \nabla\cdot(M\nabla\mu)
$$
未知数を$(c,\mu)$に増やす代わりに、各式は2階となり標準的な$C^0$要素で扱える。

### 3.4 スペクトル法（FFT）
周期境界条件が自然な相分離・粗大化問題で強力である。空間微分がフーリエ空間で代数演算になるため、半陰解法と組み合わせて高速に計算できる。非線形項は実空間で評価し、FFTで往復する実装が一般的である。

## 4. 時間積分：陽・半陰・陰、そしてエネルギー安定化
### 4.1 陽解法（推奨されにくい理由）
陽解法は実装は容易だが、CHでは安定条件が厳しすぎて現実的な計算が困難になりやすい。小さなΔtが必要となり、計算時間が大幅に増える。

### 4.2 半陰解法（IMEX）という基本戦略
線形で剛な項を陰的に、非線形項を陽的に扱う。
例（概念）：
$$
\frac{c^{n+1}-c^{n}}{\Delta t} = \nabla\cdot\left(M\nabla\mu^{n+1}\right),\quad
\mu^{n+1} = \underbrace{-\kappa\nabla^2 c^{n+1}}_{\text{陰的}} + \underbrace{\left.\frac{\partial f}{\partial c}\right|_{c^n}}_{\text{陽的}}
$$
FFTなら$k$空間で線形問題を直接解け、FEM/FDMなら線形ソルバが必要になる。

### 4.3 エネルギー安定（離散散逸）を満たす設計
フェーズフィールドは連続系で自由エネルギー$F$が単調減少する構造を持つため、離散化でも
- $F^{n+1}\le F^n$（少なくとも数値的に破れにくい）
- CHでは$\int c\,dV$が保存
を満たすことが望ましい。

代表的な考え方：
- 凸分割（convex splitting）
  自由エネルギーを凸部と凹部に分け、凸部を陰的、凹部を陽的に扱うことで無条件エネルギー安定を狙う。
- 安定化付き半陰解法（stabilized semi-implicit）
  非線形の外挿に安定化項（線形）を足し、エネルギー安定を担保する設計がある。
- SAV/IEQ系（補助変数法）
  非線形自由エネルギーを補助変数で扱い、線形問題として解きつつエネルギー安定を得る設計がある。

## 5. 非線形・線形ソルバ：収束性は前処理で決まる
### 5.1 単一方程式（ACなど）
- 陰解法ではNewton法（または準Newton）＋Krylov法が基本である
- 収束が悪い場合、時間刻みを下げるより前処理・スケーリングの見直しが効くことが多い

### 5.2 CH（混合形式）のブロック構造
未知$(c,\mu)$の連立はブロック構造を持つ。ブロック前処理（Schur補完近似など）やマルチグリッドが有効になりやすい。

### 5.3 マルチグリッドとAMR（適応メッシュ）
界面近傍だけ細かくしたい問題では、適応メッシュ（AMR）が計算量を劇的に下げうる。ただし、CHの質量保存はメッシュ更新・補間で壊れやすいため、保存性を意識した転送が必要である。

## 6. 境界条件：モデルと離散の両方で整合させる
頻出の選択肢は以下である。
- 周期境界：FFTと相性が良い
- Neumann（勾配ゼロ）：
  - CHでは無流束条件 $\mathbf{n}\cdot \nabla\mu=0$ が質量保存に直結する
  - 追加で $\mathbf{n}\cdot \nabla c=0$ を課す設計もある
- Dirichlet：濃度や秩序変数を固定するが、保存則との整合に注意する

境界条件は「連続系として妥当」でも「離散で破れる」ことがあり、保存量とエネルギーのモニタリングが必須である。

## 7. 連成問題の時間発展：モノリシックか分割か
熱・弾性・流体などと連成する場合、代表的に2方式がある。
- モノリシック（全未知を同時に解く）
  収束が良く、強連成に向くが、実装と前処理が重い。
- 分割（staggered）
  実装しやすいが、連成が強いと不安定化しやすい。必要なら反復（Picard反復など）で補う。

## 8. 検証と比較
モデルが正しく実装されたことの確認には、以下が有効である。
- MMS（Method of Manufactured Solutions）で収束次数を確認する
- 公開ベンチマークで、形態・統計量・計算性能を比較する
- 物理指標として、質量保存誤差、自由エネルギーの単調性、代表長さスケーリング（粗大化則）などを定義して点検する

## 9. 代表的なフレームワーク
- 一般に、FEM系は陰的時間積分＋Newton-Krylov＋PETSc等の線形ソルバで頑健性を確保する設計が多い。
- FFT系は半陰解法と組み合わせ、線形ソルバ無しで高速化する設計が多い。
- いずれも、数値の安定化は「モデルの物理」と「離散の構造（保存・散逸）」の両方から評価する必要がある。

## まとめ
フェーズフィールド法の数値解法は、空間離散（FDM/FVM/FEM/FFT）と時間積分（半陰・陰）を基礎に、保存則とエネルギー散逸を離散化でも壊しにくい設計へ寄せることが要点である。特にCahn–Hilliard型では、混合形式やエネルギー安定化（凸分割、安定化付き半陰、補助変数法）と、前処理・マルチグリッドの選択が計算の成立性を決める。

