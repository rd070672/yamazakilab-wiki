# レプリカ交換 (Replica Exchange Monte Carlo）とスピングラス相

レプリカ交換（Replica Exchange Monte Carlo, REMC）は、多谷（rugged）エネルギー地形で通常のモンテカルロが停滞する問題を、複数温度の並列サンプルと交換操作で緩和する拡張アンサンブル法である。スピングラスの相解析では、平衡化の確保とオーバーラップ統計（P(q)など）の高精度評価に不可欠な基盤手法である。

## 参考ドキュメント（3つ）
- Hukushima, K. and Nemoto, K., Exchange Monte Carlo Method and Application to Spin Glass Simulations, J. Phys. Soc. Jpn. 65, 1604 (1996)（原典）  
  https://www.jstage.jst.go.jp/article/jpsj/65/6/65_6_1604/_article
- Earl, D. J. and Deem, M. W., Parallel tempering: Theory, applications, and new perspectives, Phys. Chem. Chem. Phys. 7, 3910 (2005)（レビュー）  
  https://pubs.rsc.org/en/content/articlelanding/2005/cp/b509983h
- 東京大学OCW（日本語）：スピングラスと計算物性物理（交換MC・Binder比・有限サイズ解析の講義ノートを含む）  
  https://ocw.u-tokyo.ac.jp/lecture_files/issp_02/1/notes/ja/takayama-lecture.pdf
- レプリカ交換モンテカルロ法（パラレル・テンパリング）による混合ガウス分布に従う乱数の生成
  https://teramonagi.hatenablog.com/entry/20120930/1348982608


## 1. 背景：スピングラスが「難しい」理由
### 1.1 スピングラスのミニマル模型（例）
スピングラスの代表例は Edwards–Anderson (EA) 型である。Ising スピン $s_i∈{±1}$ と乱れた相互作用 $J_{ij}$ を用いて

$$
\mathcal{H}(\mathbf{s})=-\sum_{\langle i j\rangle} J_{ij}\, s_i s_j - \sum_i h_i s_i
$$

で与えられる。$J_{ij}$ の符号や大きさがランダムであるため、フラストレーションが生じ、低温で多数の準安定状態（局所極小）が現れる。

### 1.2 多谷地形・緩和の遅さ
通常の単一温度 Metropolis 法は、低温ほど障壁越え確率が小さくなり、エルゴード性が実質的に失われやすい。
スピングラスはとくに
- 自由エネルギー地形が多谷である
- サンプル（乱れ実現）ごとの揺らぎが大きい
- 相転移近傍での臨界緩和も重なる
ため、平衡化が難しい系の代表格である。


## 2. レプリカ交換（PT/REMC）の基本アイデア
温度が異なる M 個のレプリカを同時に走らせる。温度列を

$$
T_1 < T_2 < \cdots < T_M ,\quad \beta_k=\frac{1}{k_{\mathrm{B}}T_k}
$$

とし、各レプリカ $k$ は正準分布

$$
\pi_k(\mathbf{s}) \propto \exp\left(-\beta_k \mathcal{H}(\mathbf{s})\right)
$$

に従って更新する。高温側は障壁を越えて広く状態空間を探索し、その配置が交換操作によって低温側へ運ばれることで、低温レプリカの停滞が緩和される。


## 3. 交換操作と受理確率（詳細釣り合い）
### 3.1 交換の定義
隣接温度 $k$ と $k+1$ のレプリカ間で「配置を交換する（または温度ラベルを交換する）」提案を行う。

交換前： $(s_k, s_{k+1})$  
交換後： $(s_{k+1}, s_k)$

### 3.2 受理確率
詳細釣り合いを満たす Metropolis 受理確率は

$$
p_{\mathrm{acc}}=
\min\left(1,\exp\left[(\beta_k-\beta_{k+1})\left(E(s_{k+1})-E(s_k)\right)\right]\right)
$$

である。ここで $E(s)=H(s)$ である。

この式が示す通り、隣接温度のエネルギー分布が十分に重なっていないと交換がほとんど受理されず、PTの効果が弱くなる。


## 4. 温度ラダー設計
### 4.1 目標：エネルギー分布の重なり
隣接温度でエネルギーヒストグラムが重なるように T_k を配置するのが基本である。経験則として
- 交換受理率：0.2〜0.5 程度を目安に調整する
- 熱容量が大きい温度域（転移近傍）は温度間隔を細かくする
が用いられる。

### 4.2 典型的な温度配置
- 等比（幾何）配置： $T_k = T_1 r^{k-1}$
- エネルギー分散に基づく配置：温度間でエネルギー分布が等しく重なるように最適化
- エントロピー差を均す配置：隣接温度のエントロピー増分を揃える、という見方もある

### 4.3 診断指標
- ラウンドトリップ：最低温度→最高温度→最低温度までレプリカが往復する頻度
- 温度空間での拡散：レプリカの温度インデックスが十分に拡散しているか
- 交換受理率が温度域で極端に落ちていないか


## 5. 用語の注意：「レプリカ」の2つの意味
スピングラスでは「レプリカ」という語が2系統で使われ、混同しやすい。

表：2種類のレプリカ
| 用語 | 意味 | 典型用途 |
|---|---|---|
| PT/REMCのレプリカ | 温度（やパラメータ）が異なる複数の同一系のコピー | 平衡化・混合の改善 |
| スピングラスの実レプリカ（two replicas） | 同一温度・同一乱れ実現で独立に生成した2つの配置 | オーバーラップ q の評価 |
| レプリカ法（解析手法） | 無秩序平均のための解析的トリック（n→0極限） | 理論解析（数値計算とは別物） |

PTの運用では、オーバーラップ統計を取るために「同一温度の独立実レプリカ」を別途用意する設計が多い（例：同一乱れ実現についてPTを2本走らせる、あるいは温度ごとに2コピーを保持する、などである）。


## 6. スピングラス相解析での代表的観測量
### 6.1 オーバーラップ秩序パラメータ q
同一乱れ実現で独立に平衡化した2つの配置 a,b を用いて

$$
q=\frac{1}{N}\sum_{i=1}^{N} s_i^{(a)} s_i^{(b)}
$$

を定義する。スピングラス相では $q$ が非自明な分布を持つとされ、分布 $P(q)$ の形やサイズ依存が議論の中心になる。

### 6.2 Binder 比（有限サイズスケーリング）
Ising の例では、オーバーラップの Binder 比の一例として

$$
g_q=\frac{1}{2}\left(3-\frac{\langle q^4\rangle}{\langle q^2\rangle^2}\right)
$$

が用いられる。複数サイズ L の g_q(T) を描くと、転移温度付近で曲線が交差する（あるいは交差に近い挙動を示す）ことがある。交差温度のサイズ依存を有限サイズスケーリングで解析する。

### 6.3 スピングラス感受率
$$
\chi_{\mathrm{SG}} = N \langle q^2\rangle
$$

はスピングラス秩序の強さを測る量の一つである（前因子や定義は文献・模型で差があるため整合が必要である）。

### 6.4 乱れ平均（disorder average）
スピングラスでは、熱平均に加えて乱れ実現 $J_{ij}$ の平均が必要であり、

$$
[\langle O \rangle]_{\mathrm{disorder}}
$$

のように、熱平均 ⟨ ⟩ と乱れ平均 [ ] を区別して扱う。統計誤差は
- 熱揺らぎ（各サンプルのMC統計）
- サンプル間揺らぎ（乱れ実現のばらつき）
の二重構造になるため、乱れサンプル数の設計が重要である。


## 7. 平衡化の実務（REMCでも油断できない）
PTは混合を助けるが、自動的に平衡が保証されるわけではない。実務では以下を併用する。

- 対数ビニング：観測量を時間窓でまとめ、時間に対する収束を確認する
- 独立初期条件の比較：異なる初期状態（ランダム/整列など）からの一致を確認する
- ラウンドトリップ回数：低温レプリカが高温へ何度も“脱出”できているかを見る
- 交換頻度の調整：局所更新と交換の比率を調整し、温度空間の拡散を改善する

スピングラス相解析では、$P(q)$ の尾や高次モーメントが平衡化に敏感であるため、平均値だけでなく分布の形に対しても収束確認が必要である。


## 8. 材料科学への接続：どこで効くか
### 8.1 乱れ・フラストレーションを持つ磁性材料
材料科学では、以下がスピングラス様の振る舞い（または類似の多谷地形）を持ち得る。
- 希薄磁性合金・ランダム合金（例：競合する相互作用が混在）
- アモルファス／ナノ結晶系（局所環境ゆらぎ、ランダム異方性）
- フラストレート磁性体（格子幾何による競合）
- 界面・多層膜（層ごとの相互作用が競合し、準安定状態が増える）

原子論的スピンモデル（$J_{ij}, D_{ij}, K_i$ などを局所的に割り当てる模型）を立て、REMCで平衡状態や温度依存を評価する流れが有効である。

### 8.2 拡張：温度以外のパラメータ交換
REMCは温度だけでなく、磁場、異方性、相互作用強度、化学ポテンシャルなどのパラメータを交換する形（ハミルトニアンレプリカ交換）にも一般化できる。材料系では、特定パラメータの掃引で多谷性が強い場合に検討価値がある。


## 9. 近縁法との比較（最小限）
表：多谷地形に対する代表的手法
| 手法 | 何を拡張するか | 特徴 |
|---|---|---|
| 単一温度MC | なし | 低温で停滞しやすい |
| レプリカ交換（PT/REMC） | 温度（またはパラメータ）を並列化＋交換 | 実装が比較的簡便、平衡化が大幅に改善しやすい |
| Simulated Tempering | 温度を1本の鎖で可変にする | 重み推定が必要になりやすい |
| マルチカノニカル／Wang–Landau | エネルギー重みを平坦化 | 重み推定が手間だが、障壁越えに強い場合がある |
| Population Annealing | 集団をアニーリングで進める | 大規模並列と相性が良い |

スピングラスでは、PT/REMCが平衡化・再現性・実装負担のバランスが良く、標準的な選択肢になりやすい。


## まとめ
レプリカ交換（PT / REMC）は、多谷エネルギー地形での停滞を温度拡張と交換操作で緩和し、スピングラスの平衡化と相解析（$P(q)$, Binder 比など）を実務レベルで可能にする中核手法である。材料科学では、乱れ・競合相互作用・局所不均一性が支配する磁性材料の温度依存や準安定状態の統計評価に直結し、原子論的スピンモデルと組み合わせることで設計・解釈の解像度を上げられる枠組みである。

