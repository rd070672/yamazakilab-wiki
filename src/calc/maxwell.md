# マクスウェル方程式にもとづく電磁界解析

電磁界解析は、マクスウェル方程式と材料の構成則から電場・磁場の分布を求め、損失・共鳴・伝搬・誘導加熱・渦電流などを定量化する枠組みである。扱う周波数帯と材料応答（導電・誘電・磁性・分散）が、近似と数値解法の選択を決める。

## 参考ドキュメント
- MEEP Documentation: Introduction（FDTDでマクスウェル方程式を時間発展させる枠組み）
  https://meep.readthedocs.io/en/latest/Introduction/
- COMSOL Blog: What Is the Curl Element (and Why Is It Used)?（電磁界FEMで辺要素が必要になる理由）
  https://www.comsol.com/blogs/what-is-the-curl-element-and-why-is-it-used
- 解析電磁気学 授業ノート（日本語PDF：マクスウェル方程式から電磁波までの講義資料）
  https://www.emlab.cei.uec.ac.jp/jugyo/h29_kaiseki_denjiki/notes.pdf

## 1. マクスウェル方程式（微分形）と構成則
空間 r、時間 t に対して、微分形は次である。

$$
\nabla\times \mathbf{E} = -\frac{\partial \mathbf{B}}{\partial t},\quad
\nabla\times \mathbf{H} = \mathbf{J} + \frac{\partial \mathbf{D}}{\partial t}
$$

$$
\nabla\cdot \mathbf{D} = \rho,\quad
\nabla\cdot \mathbf{B} = 0
$$

材料中では構成則により場と物性が結びつく。

$$
\mathbf{D}=\varepsilon \mathbf{E},\quad
\mathbf{B}=\mu \mathbf{H},\quad
\mathbf{J}=\sigma \mathbf{E}+\mathbf{J}_s
$$

ここで $\varepsilon,\mu,\sigma$ は一般に空間依存し、異方性（テンソル）や周波数分散を持ちうる。磁性体では $\mu$ が非線形（B-H曲線）になることがあり、強磁性体の高周波では複素透磁率で近似されることが多い。

## 2. 周波数領域（調和場）と時間領域
解析目的により、時間領域（過渡応答）と周波数領域（定常調和応答）を使い分ける。

### 2.1 周波数領域（phasor）表現
$\mathbf{E}(\mathbf{r},t)=\Re\{\tilde{\mathbf{E}}(\mathbf{r})e^{i\omega t}\}$ とおくと、時間微分は $i\omega$ になる。導電を含むとき、複素誘電率

$$
\varepsilon_c = \varepsilon - i\frac{\sigma}{\omega}
$$

を用いると式が整理されやすい。電場を未知数とする代表的な偏微分方程式は

$$
\nabla\times \left(\mu^{-1}\nabla\times \tilde{\mathbf{E}}\right)
-\omega^2 \varepsilon_c\,\tilde{\mathbf{E}}
= i\omega \tilde{\mathbf{J}}_s
$$

であり、散乱・導波路・共鳴器・Sパラメータ計算の基本形になる。

### 2.2 時間領域（過渡）
時間領域ではマクスウェル方程式を直接時間発展させ、パルス応答、広帯域散乱、非線形・分散材料の時間応答などを扱う。有限差分時間領域法（FDTD）はこの代表例であり、格子上でEとHを時間交互に更新する（Yee格子）。

## 3. 近似（quasi-static）と適用範囲の見積もり
材料・周波数帯によって、マクスウェル方程式を簡略化した支配方程式で十分な場合がある。

### 3.1 電磁波（波動）領域
対象寸法が波長と同程度以上、または位相差が重要な場合は、変位電流を含むフルマクスウェル（波動方程式）を解く必要がある。

### 3.2 渦電流（eddy current）近似
金属内部などで $\sigma \gg \omega\varepsilon$ のとき、変位電流を無視して

$$
\nabla\times \mathbf{H}\approx \mathbf{J},\quad \mathbf{J}=\sigma \mathbf{E}
$$

とし、誘導・拡散型の問題として扱う。鉄損、誘導加熱、磁気シールド、トランスコア近傍の電流分布評価などで中心となる。

皮相深さ（skin depth）は

$$
\delta=\sqrt{\frac{2}{\omega \mu \sigma}}
$$

で与えられ、金属・磁性体では $\delta$ が小さくなりやすい。メッシュは少なくとも $\delta$ を解像する必要があり、これが計算難易度に直結する。

### 3.3 静電場・静磁場
時間変化が無視できる場合は、静電場（Poisson/Laplace）や静磁場（磁気スカラー/ベクトルポテンシャル）に落とせる。永久磁石・直流磁場、低周波の近似設計で有効である。

## 4. 材料モデル
電磁界解析で材料をどう表すかは、結果の妥当性を決める。

### 4.1 線形等方材料（最も基本）
$\varepsilon,\mu,\sigma$ を定数（または空間分布）として与える。損失は複素誘電率・複素透磁率で表すことが多い。

### 4.2 分散モデル（Drude/Lorentzなど）
光学・テラヘルツやプラズモニクスでは、$\varepsilon(\omega)$ が強い分散を持つ。時間領域では補助微分方程式（ADE）等で分散を実装し、周波数領域では直接 $\varepsilon(\omega)$ を代入する。

### 4.3 異方性・テンソル物性
結晶や層状材料、磁気光学、配向組織では $\varepsilon$ や $\mu$ がテンソルとなる。FEMでは自然に扱えるが、境界条件・座標系（結晶軸の向き）を明確にする必要がある。

### 4.4 非線形磁性（B-H曲線）とヒステリシス
電機鉄心や強磁性材料では $\mu$ が場依存となり、非線形反復が必要になる。ヒステリシスを入れる場合はJiles–AthertonやPreisach系モデル、あるいは複素透磁率近似（小信号）など、目的に応じたモデリングが必要である。


## 5. 数値解法の系統
電磁界解析の離散化は、支配方程式の形（curl、div、grad）と境界条件（開放境界、導体、周期）に強く左右される。

### 5.1 FEM（有限要素法）：複雑形状と波動・渦電流に強い
FEMは任意形状・異方性・局所的メッシュ細分化に強い。一方、電磁界ではスカラー要素だけでベクトル場を離散化すると、スプリアスモード（不物理な解）や接線成分の不連続が問題になりやすい。

このため、電磁波・渦電流の標準では、H(curl)適合の辺要素（Nédélec要素、edge/curl element）を用いることが多い。辺要素は要素境界で電場（または磁場）の接線成分の連続性を自然に満たし、curl演算に整合する。

周波数領域FEMは線形方程式（複素対称・非対称）を解く形になり、共鳴・導波路モードでは固有値問題が現れる。COMSOLのRF Moduleなどでも、マクスウェル方程式をFEM（安定な辺要素）で解く旨が明記されている。

### 5.2 FDTD（有限差分時間領域法）：広帯域・過渡に強い
FDTDは時間発展で広帯域の周波数応答を一度に得やすく、光学・メタマテリアル・散乱、短パルス応答などで広く使われる。Yee格子上でEとHを交互更新する定式化が基本であり、Meepはこの枠組みを採る代表的なオープンソースである。

注意点は次である。
- クーラン条件により時間刻みが空間格子に縛られる
- 高導電・高透磁の材料では皮相深さを解像するため格子が極端に細かくなる
- 開放境界には吸収境界（PML）が必須になり、設計次第で反射誤差が残る

### 5.3 BEM/MoM（境界要素法・モーメント法）：開放境界を自然に扱う
自由空間散乱、アンテナなどでは境界積分により無限領域を自然に扱える。ただし密行列になりやすくメモリが重い。材料が均一な外部領域を持つ問題と相性がよい。

### 5.4 ハイブリッドと高速化（FMM、FFT、マルチグリッド）
- FEM+BEMで内部（複雑材料）と外部（無限空間）を分担する
- FMMで境界積分の遠方寄与を高速化する
- 反復法（GMRES等）と前処理（ILU、マルチグリッド）で大規模線形系を解く

渦電流問題では、磁化シミュレーションと同様に長距離相互作用をどう扱うかがボトルネックになりうる。

## 6. 境界条件・励起・後処理
### 6.1 境界条件
- PEC（完全導体）：導体表面で接線電場がゼロ
- PMC（完全磁気導体）：理想化境界として用いる場合がある
- インピーダンス境界：表皮効果を境界条件で近似し、薄い皮相深さを直接メッシュ化しない
- 周期境界（Bloch境界）：結晶/メタ構造のバンド構造、回折格子解析
- 吸収境界（PML）：開放空間を有限領域で模擬する

### 6.2 励起
- 電流源・電圧源（コイル、導体）
- 平面波入射（散乱、光学）
- ポート励起（導波路、同軸、マイクロストリップ）
- 初期値（時間領域過渡）

### 6.3 エネルギー流・損失・等価回路
時間調和場では、複素場 $\tilde{\mathbf{E}},\tilde{\mathbf{H}}$ を用いて平均ポインティングベクトル

$$
\langle \mathbf{S}\rangle=\frac{1}{2}\Re(\tilde{\mathbf{E}}\times \tilde{\mathbf{H}}^{*})
$$

を計算できる。損失は

- ジュール損（導電損）：
$$
P_J=\frac{1}{2}\int \Re(\sigma)\,|\tilde{\mathbf{E}}|^2\,dV
$$

- 誘電損：
$$
P_\varepsilon=\frac{\omega}{2}\int \Im(\varepsilon)\,|\tilde{\mathbf{E}}|^2\,dV
$$

- 磁性損（小信号近似）：
$$
P_\mu=\frac{\omega}{2}\int \Im(\mu)\,|\tilde{\mathbf{H}}|^2\,dV
$$

などとして評価する。高周波磁性体では複素透磁率の周波数依存と渦電流が競合するため、モデルの整合が重要である。

## 7. 手法選択の目安
| 目的/状況 | 推奨されやすい枠組み | 主要な注意点 |
|---|---|---|
| 導波路・共鳴器・Sパラメータ | 周波数領域FEM（辺要素） | スプリアスモード回避、ポート/放射境界 |
| 広帯域散乱・短パルス | FDTD + PML | クーラン条件、分散材料の実装 |
| 渦電流・誘導加熱・鉄心近傍 | 渦電流近似（FEM、A-φ等） | 皮相深さ、非線形B-H、コイル励起 |
| 開放空間アンテナ・散乱（均質背景） | BEM/MoM（必要に応じFMM） | 密行列、材料不均一が多いと不利 |
| 複雑形状・異方性材料・局所細分化 | FEM | 無限領域の扱い（PMLや無限要素） |

## 8. 位置づけ
- 日本語の講義ノートでは、マクスウェル方程式が「電磁場を決定する基本方程式」であり、そこから電磁波や境界値問題へ進む流れが整理されている。
- 電磁界解析のFEM入門資料では、境界条件付き微分方程式として電磁界問題を捉え、要素分割と弱形式・行列化へ落とす視点がまとめられている。

## まとめ
マクスウェル方程式にもとづく電磁界解析は、構成則（$ε$, $μ$, $σ$）と境界条件を含む場の境界値問題として定式化され、目的に応じて周波数領域・時間領域・準静的近似を使い分ける枠組みである。数値法としては、辺要素を用いるFEMが複雑形状と波動問題に強く、FDTDが広帯域過渡に強く、BEM/MoMが開放境界に適するが、皮相深さ・分散・非線形性・境界設計が精度を支配するため、材料モデルと検証設計を一体として扱う必要がある。
