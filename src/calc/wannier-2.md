# 最局在ワニエ関数（MLWF）の基礎と発展

最局在ワニエ関数（Maximally Localized Wannier Functions; MLWF）とは、第一原理計算で得たブロッホ状態の部分空間を、実空間でよく局在した基底へ写像する方法である。バンドを再現しつつ、ホッピング（TB）・ベリー位相・トポロジー量・輸送・相関模型への射影など、多様な発展計算へ同一の“低エネルギー表現”として接続できる点が中核である。

## 1. なぜ MLWF なのか：ブロッホ表現と局在基底の補完関係

周期系の電子状態はブロッホ関数で表すと計算に自然である。一方、局所結合像、低エネルギー有効模型、位相幾何学的量（分極やベリー曲率）を議論するには、実空間で局在する基底が有利である。MLWF はこの両者の間を“情報を保ったまま”往復するための基盤である。

| 観点 | ブロッホ基底 | MLWF 基底 |
|---|---|---|
| 得意な対象 | SCF、バンド構造、対称性の扱い | 有効模型（TB）、結合像、位相幾何学、補間 |
| 直観 | バンドとしての理解 | 軌道・結合・局所中心の理解 |
| 数値計算 | 直接積分は高密度 $k$ が必要になりやすい | 低コストで高密度 $k$ を扱える（ワニエ補間） |
| 代表的な利用 | DOS、全エネルギー、力 | AHE/SHE、分極、トポロジー、DMFT など |


## 2. ワニエ関数とは何か：ゲージ自由度をもつ逆フーリエ変換

ブロッホ関数を
$$
\psi_{n\mathbf{k}}(\mathbf{r}) = e^{i\mathbf{k}\cdot\mathbf{r}} u_{n\mathbf{k}}(\mathbf{r})
$$
とする。ワニエ関数は、ブロッホ状態の線形結合を $\mathbf{k}$ 空間から実空間へ逆フーリエ変換したものである。

離散 $k$ 点（数 $N_k$）で、対象とする $J$ 次元部分空間（バンド群）に対し
$$
|w_{n\mathbf{R}}\rangle
=
\frac{1}{N_k}\sum_{\mathbf{k}} e^{-i\mathbf{k}\cdot\mathbf{R}}
\sum_{m=1}^{J}U_{mn}(\mathbf{k})|\psi_{m\mathbf{k}}\rangle
$$
と定義する。ここで $U(\mathbf{k})$ はユニタリ変換であり、同じ部分空間を張る限り自由に選べる（ゲージ自由度）ため、ワニエ関数の形は一意ではない。MLWF はこの自由度を用いて「局在性が最大となるゲージ」を選ぶ手法である。


## 3. 「最局在」とは何を最小化しているのか：スプレッド汎関数

MLWF（Marzari–Vanderbilt 流儀）では、各ワニエ関数の空間的広がり（スプレッド）を最小化して局在性の高い基底を得る。代表的な汎関数は
$$
\Omega
=
\sum_n \left(\langle r^2\rangle_n - |\langle \mathbf{r}\rangle_n|^2\right)
$$
であり、$\Omega$ を最小化する $U(\mathbf{k})$ を探索する。ワニエ中心 $\langle \mathbf{r}\rangle_n$ は、分極やワニエ電荷中心（WCC）などの議論にも直結する量である。

実装上は、隣接 $k$ 点の重なり行列
$$
M_{mn}^{(\mathbf{k},\mathbf{b})}=\langle u_{m\mathbf{k}}|u_{n,\mathbf{k}+\mathbf{b}}\rangle
$$
（$\mathbf{b}$ は $k$ メッシュ上の隣接ベクトル）を用い、$\Omega$ の勾配に基づいて $U(\mathbf{k})$ を反復更新する。したがって MLWF の品質は、(i) 参照する部分空間の連続性、(ii) $k$ メッシュ、(iii) 初期射影（初期 guess）に強く依存する。


## 4. 金属・混成バンドへの拡張：disentanglement（部分空間の最適化）

金属やバンド交差を含む系では、関心帯域が他バンドと絡み合い（entangled）、単純に「このバンド群」と固定できない場合が多い。Souza–Marzari–Vanderbilt により、次のような二段階が与えられる。

1. 外側窓（outer window）で候補状態を広く取り、滑らかに連結する $J$ 次元部分空間を最適化する  
2. 内側窓（inner/frozen window）では第一原理バンドの再現を固定し、その上で局在化を行う

この設計により、金属磁性体や遷移金属化合物のフェルミ準位近傍に対しても、局在性とバンド再現性を両立した MLWF が得られる。

設計変数としての要点は以下である。
- $J=$ 作りたいワニエ軌道数（低エネルギー自由度の数）
- 内側窓：厳密再現したいエネルギー範囲
- 外側窓：混成を許容して部分空間を選ぶ範囲
- 初期射影：原子軌道（$d,p,s$ 等）や結合軌道、対称性を反映した初期関数


## 5. MLWF から TB（有効ハミルトニアン）へ：実空間行列要素

MLWF が得られると、ワニエ基底での実空間ハミルトニアン
$$
H_{nm}(\mathbf{R})=\langle w_{n\mathbf{0}}|\hat{H}|w_{m\mathbf{R}}\rangle
$$
が得られる。これをフーリエ変換して
$$
H_{nm}(\mathbf{k})=\sum_{\mathbf{R}} e^{i\mathbf{k}\cdot\mathbf{R}} H_{nm}(\mathbf{R})
$$
とすれば、任意の $\mathbf{k}$ で高速にバンドを再構成できる（ワニエ補間）。“局在性が高い”とは、$H_{nm}(\mathbf{R})$ が距離とともに急速に減衰し、有限範囲のホッピングで高精度になることを意味する。

この表現の物理的利点は、オンサイト項 $H(\mathbf{0})$ が局所準位（結晶場・混成を含む）に、$\mathbf{R}\neq \mathbf{0}$ の項がホッピング（結合）に対応し、材料依存の“有効結合地図”として解釈できる点にある。


## 6. MLWF の発展計算 1：ベリー位相・分極・ワニエ中心

絶縁体の電子分極は、現代的理論ではベリー位相として定義されるが、MLWF を用いると「占有ワニエ中心の総和」による直観的表現が得られる。概念的には
$$
\mathbf{P} \propto -\frac{e}{V}\sum_{n\in \mathrm{occ}} \langle \mathbf{r}\rangle_n
\quad (\mathrm{mod}\  \mathbf{P}_q)
$$
のように、分極の変化はワニエ中心の移動として理解できる（分極量子 $\mathbf{P}_q$ による多価性に注意が必要である）。

この枠組みは、強誘電体、界面電荷、圧電応答の電気的寄与など、周期境界条件下での電気量の整理に有効である。


## 7. MLWF の発展計算 2：ベリー曲率・異常ホール（AHE）・スピンホール（SHE）

異常ホール伝導度などはベリー曲率のブリルアンゾーン積分で書けるため、高密度 $k$ メッシュが必要になりやすい。MLWF 補間により、第一原理の粗い $k$ メッシュ情報から高密度積分を低コストに実現できる。

概念式として、占有バンド $n$ のベリー曲率は
$$
\Omega_{n,ij}(\mathbf{k})
=
-2\,\mathrm{Im}\sum_{m\neq n}
\frac{\langle u_{n\mathbf{k}}|\partial_{k_i}\hat{H}|u_{m\mathbf{k}}\rangle
      \langle u_{m\mathbf{k}}|\partial_{k_j}\hat{H}|u_{n\mathbf{k}}\rangle}
{(\varepsilon_{m\mathbf{k}}-\varepsilon_{n\mathbf{k}})^2}
$$
のように書け、分母の小ささ（準縮退）や SOC に敏感である。よって MLWF-TB は、SOC を含む微小差物性の評価（AHE/SHE/ANE、軌道磁化など）へ自然に接続する。


## 8. MLWF の発展計算 3：トポロジー不変量と表面・エッジ状態

MLWF-TB を用いると、ウィルソンループ（ワニエ電荷中心; WCC）の流れから $Z_2$ 不変量を評価したり、スラブ幾何で表面状態を計算したりできる。第一原理から抽出した TB は、トポロジカル材料探索・ワイル点探索・表面フェルミ弧解析などの基盤となる。

ここで重要なのは、トポロジー量はゲージに敏感に見える一方で、物理的に意味のある量（不変量）は適切な形式で評価すると表現の違いに依存しない、という点である。MLWF はその計算を数値的に安定化する役割を持つ。


## 9. MLWF の発展計算 4：電子格子相互作用（電子フォノン）と超伝導・輸送

MLWF は、電子フォノン行列要素 $g_{mn}(\mathbf{k},\mathbf{q})$ の補間にも用いられる。電子フォノン相互作用はフェルミ面近傍で高密度サンプリングを要求するため、ワニエ補間が本質的に有効である。

この方向の代表例として、Quantum ESPRESSO + Wannier90 を基盤にした EPW（Electron–Phonon coupling using Wannier functions）が知られており、電気抵抗・熱電・超伝導転移温度評価などへ展開できる。


## 10. MLWF の発展計算 5：相関模型（Hubbard, DMFT）への射影

強相関を扱う枠組みでは、第一原理の広い電子空間から「相関が重要な低エネルギー部分空間」を定義し、その上で Hubbard $U$ や自己エネルギーを導入する。MLWF はこの部分空間を明確に定義する代表的手段である。

例えば、$d$ 軌道のみの模型や $p$–$d$ 連成模型を
- どの原子中心に、どの対称性で、どれほど局在しているか
- 混成（ホッピング）がどの距離まで重要か
という形で整理できるため、DFT+DMFT、cRPA による有効相互作用評価などの前処理として重要である。


## 11. SOC・非共線磁性・磁気弾性への接続（発展的観点）

SOC を含む場合、波動関数はスピノルとなり、ワニエ化もスピノル形式で行う必要がある。スピノル MLWF により、SOC 由来の結合をワニエ基底の行列として扱えるため、次のような議論へ接続しやすい。
- 磁気異方性エネルギー（MAE）の起源を「どの軌道対の SOC 混成が支配するか」として整理する
- ひずみ $\varepsilon$ で $H_{nm}(\mathbf{R})$ がどう変わるかを比較し、磁気弾性（磁歪）に関わるエネルギー変化を分解して理解する

概念として、磁気弾性は「磁化方向で変わる SOC 由来のエネルギー差」がひずみに応答する量であるため、
$$
B \sim \left.\frac{\partial}{\partial \varepsilon}\Delta E_{\mathrm{SOC}}(\varepsilon)\right|_{\varepsilon=0}
$$
という構造をもつ。MLWF-TB が与える“ホッピングとオンサイトの分解”は、この微視的内訳（どの結合・どの局所分裂が効くか）を論理的に整理する際の共通言語になり得る。

---

## 12. 対称性と MLWF：対称性適合ワニエという考え方

MLWF は局在化を優先するため、見かけ上、結晶対称性に沿わない形（中心のわずかなずれ、軌道の混ざり）を示すことがある。材料の議論では対称性が重要な制約となるため、対称性を尊重したワニエ化（symmetry-adapted Wannier functions）の考え方が有用である。

対称性を保ったまま得ることを優先するか、局在性を最大化するかは目的依存であり、どちらが“正しい”というより、観測したい物理量に対して適切な表現を選ぶ問題である。

---

## 13. 設計と確認事項（基礎を外さないために）

MLWF の解釈は、軌道の形そのものを観測量とみなすのではなく、「再現性」を軸に支えるのが基本である。以下は最低限の確認事項である。

1. 内側窓で、ワニエ補間バンドが第一原理バンドと一致しているか  
2. スプレッド $\Omega$ が不自然に大きくないか（局在が著しく悪い場合は窓・射影・$k$ メッシュを見直す）  
3. ホッピング $H_{nm}(\mathbf{R})$ が距離とともに減衰し、有限距離で十分か  
4. SOC、磁性、非共線などの計算条件とワニエ化の前提（スピノル、時間反転の扱いなど）が整合しているか  
5. 目的の物性値（例えば AHE、分極、MAE など）が、$k$ メッシュや窓設定に対して安定か  


## まとめと展望

MLWF は、第一原理計算のブロッホ状態から、局在基底による低エネルギー表現を構成する方法であり、TB 模型化とベリー位相由来物性の高速評価を同時に可能にする。金属・混成バンドにも disentanglement により拡張でき、SOC を含む系ではスピノル MLWF を通じて、異常ホール、トポロジー、磁気異方性、磁気弾性などの微小差物性へ発展的に接続できる。

今後の展望としては、(i) SOC と準縮退の位置関係を MLWF-TB の行列要素で整理し、(ii) ひずみや組成変化によるオンサイト分裂・ホッピング変化を追跡し、(iii) ベリー曲率や MAE の感度の起源を“軌道結合の言葉”で統一的に記述する方向が有望である。さらに電子フォノン補間（EPW）や相関模型（DFT+DMFT）への橋渡しを組み合わせることで、スペクトル・輸送・応答関数を含む多面的な材料設計指針へ展開できる可能性が高い。

## 参考資料
- N. Marzari et al., Maximally localized Wannier functions: Theory and applications, Reviews of Modern Physics 84, 1419 (2012)  
  https://link.aps.org/doi/10.1103/RevModPhys.84.1419
- Wannier90 Documentation  
  https://wannier90.readthedocs.io/
- （日本語）是常グループ Practical QE tutorial: 最局在ワニエ関数  
  https://www.cmpt.phys.tohoku.ac.jp/~koretsune/SATL_qe_tutorial/wannier.html
- 追加（基礎論文）Marzari & Vanderbilt, Phys. Rev. B 56, 12847 (1997)  
  https://link.aps.org/doi/10.1103/PhysRevB.56.12847
- 追加（混成バンド）Souza, Marzari & Vanderbilt, Phys. Rev. B 65, 035109 (2001)  
  https://link.aps.org/doi/10.1103/PhysRevB.65.035109
