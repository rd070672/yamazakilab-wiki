# 格子ボルツマン法（LBM）入門

格子ボルツマン法（Lattice Boltzmann Method, LBM）は、連続体の支配方程式を直接離散化するのではなく、速度分布関数の発展を通じて流れ場を得る数値手法である。局所更新則と格子上ストリーミングにより、複雑形状・多相系・多物理連成へ拡張しやすい点が特徴である。

## 参考ドキュメント
1. Aidun, C. K.; Clausen, J. R., Lattice-Boltzmann Method for Complex Flows, Annual Review of Fluid Mechanics 42, 439–472 (2010). 
  DOI: 10.1146/annurev-fluid-121108-145519
2. Krüger, T. et al., The Lattice Boltzmann Method: Principles and Practice, Springer (2017). 
  DOI: 10.1007/978-3-319-44649-3
3. 蔦原 道久, 格子ボルツマン法の基礎と応用, 日本機械学会論文集B編 77巻784号 (2011). 
  https://www.jstage.jst.go.jp/article/kikaib/77/784/77_784_2367/_pdf


## 1. 連続体と原子論の間の「メゾスコピック」記述
流体の運動は連続体としてはナビエ–ストークス方程式で記述できるが、微視的には粒子の運動と衝突（統計力学）に基づくボルツマン方程式で記述される。LBMはこの両者の中間に位置し、格子点上に定義した離散速度の分布関数 $f_i(\mathbf{x},t)$ を更新することで、巨視的量（密度・速度・圧力など）を復元する枠組みである。

直感的には以下の対応を意識するとよい。
- ボルツマン方程式：$f(\mathbf{x},\mathbf{v},t)$ を位相空間で解く
- LBM：$\mathbf{v}$ を少数の離散速度 $\{\mathbf{c}_i\}$ に縮約して $f_i(\mathbf{x},t)$ を格子上で更新する
- 巨視量：分布関数の低次モーメントから得る

LBMは「運動論（kinetic）」に立脚するため、拡散・熱輸送・電荷輸送などの輸送現象を、同じ“分布関数の進化”という文法で統一的に扱いやすい。

## 2. 離散ボルツマン方程式（LBE）
### 2.1 連続ボルツマン方程式とBGK近似
連続系では（外力なしの）ボルツマン方程式は
$$
\frac{\partial f}{\partial t}+\mathbf{v}\cdot\nabla f=\Omega(f)
$$
であり、右辺の衝突項 $\Omega(f)$ を単一緩和（BGK）で近似すると
$$
\Omega(f)\approx -\frac{1}{\tau}\left(f-f^{\rm eq}\right)
$$
となる。ここで $\tau$ は緩和時間、$f^{\rm eq}$ は局所平衡（マクスウェル分布）である。

### 2.2 格子上の離散化
LBMの代表形は、時間刻み $\Delta t$、格子間隔 $\Delta x$ を用いて
$$
f_i(\mathbf{x}+\mathbf{c}_i\Delta t,t+\Delta t)-f_i(\mathbf{x},t)
= -\frac{\Delta t}{\tau}\left(f_i(\mathbf{x},t)-f_i^{\rm eq}(\mathbf{x},t)\right) + \Delta t\,F_i
$$
である。左辺がストリーミング（格子速度 $\mathbf{c}_i$ で隣接格子へ輸送）、右辺が衝突（平衡へ緩和）と外力項 $F_i$ である。

### 2.3 巨視的量の復元
密度 $\rho$、運動量密度 $\rho\mathbf{u}$ は
$$
\rho=\sum_i f_i,\qquad \rho\mathbf{u}=\sum_i \mathbf{c}_i f_i + \frac{\Delta t}{2}\mathbf{F}
$$
などとして得る（外力定式化により細部は変わる）。

圧力は等温の標準LBMでは状態方程式
$$
p=c_s^2\rho
$$
で関係付けられる。$c_s$ は格子音速であり、離散速度集合により一定値を取る。

### 2.4 ナビエ–ストークス方程式が現れる条件
チャップマン–エンスコグ展開により、低マッハ数（概ね $M=u/c_s\ll 1$）かつ緩やかな変化を仮定すると、LBEから非圧縮性（あるいは弱圧縮性）ナビエ–ストークス方程式が導かれる。標準BGK（SRT）では動粘性係数 $\nu$ が
$$
\nu=c_s^2\left(\tau-\frac{\Delta t}{2}\right)
$$
で与えられることが重要である。数値上は $\tau/\Delta t$ を $0.5$ に近づけるほど低粘性（高Re）になるが、安定性が悪化しやすい。

## 3. 格子と離散速度モデル
LBMは「次元D」「速度の本数Q」を組として格子モデルを選ぶ。代表例を以下に示す。

| モデル | 次元 | 速度本数Q | 典型用途 | 備考 |
|---|---:|---:|---|---|
| D2Q9 | 2D | 9 | 2次元の標準流れ・多相の基礎 | 格子音速 $c_s^2=1/3$（格子単位） |
| D3Q19 | 3D | 19 | 3次元の標準流れ | 速度数と精度・計算量のバランス |
| D3Q27 | 3D | 27 | 高等方性・高精度を狙う場合 | 境界や乱流で有利なことがある |

格子単位ではしばしば $\Delta x=\Delta t=1$ とおき、$\mathbf{c}_i$ は整数ベクトルで表される。このとき、物理単位への写像（スケーリング）が設計の核心になる。

## 4. 衝突演算子の拡張
### 4.1 SRT（BGK）からMRTへ
最も簡単な衝突は単一緩和（SRT, BGK）であるが、数値安定性や境界での誤差が問題になりやすい。これに対し、モーメント空間で複数の緩和率を使うMRT（Multiple-Relaxation-Time）や、2つの緩和を用いるTRT（Two-Relaxation-Time）が広く用いられる。

### 4.2 セントラルモーメント・キュムラント衝突
近年はガリレイ不変性の改善や高Reでの安定化を狙い、セントラルモーメント（流速で中心化したモーメント）やキュムラントに基づく衝突（Cumulant LBM）が提案・発展している。キュムラントは統計量としての独立性が高く、数値的な堅牢性に寄与しうる。

### 4.3 エントロピックLBM
非線形安定性を制御する観点から、離散H関数（エントロピー）の単調性を満たすように設計するエントロピックLBMが体系化されている。乱流の未解像スケールや強いせん断場でも破綻しにくい設計思想である。

衝突モデルは「計算コスト」「実装の複雑さ」「安定性」「境界誤差」のトレードオフで選ぶ。研究目的（低粘性・多相・乱流・複雑境界）を先に固定し、その目的に効く衝突モデルを選ぶのが合理的である。

## 5. 外力・拡散・熱輸送
LBMは流体だけでなく、対流拡散方程式や熱輸送方程式も“分布関数の進化”として同形式に書ける。例えば濃度 $C$ の輸送
$$
\frac{\partial C}{\partial t}+\nabla\cdot(C\mathbf{u})=D\nabla^2 C+R
$$
に対し、濃度用の分布関数 $g_i$ を導入して
$$
g_i(\mathbf{x}+\mathbf{c}_i\Delta t,t+\Delta t)-g_i(\mathbf{x},t)
= -\frac{\Delta t}{\tau_g}\left(g_i-g_i^{\rm eq}\right) + \Delta t\,S_i
$$
とすれば、拡散係数 $D$ を $\tau_g$ で制御できる。反応項 $R$ はソース $S_i$ として組み込む。

この統一形式は、反応拡散・電気化学反応・相変態の秩序変数方程式などを連成させる際の見通しを良くする。

## 6. 境界条件
LBMの強みの一つは境界条件が局所的に実装できる点である。代表例を挙げる。
- バウンスバック（bounce-back）：壁面で分布関数を反射させ、無滑り条件を近似的に満たす
- Zou–He 型：速度境界・圧力境界を与えるための関係式を用いる
- 補間バウンスバック：曲面境界や部分セルを扱い、幾何誤差を低減する
- Immersed Boundary/Moving Boundary：粒子分散系や変形境界を扱う

材料系では、X線CTや3Dトモグラフィのボクセル形状をそのまま格子化し、複雑な多孔質内部流れや二相浸透を扱う設計が馴染みやすい。

## 7. 界面をどう入れるか
LBMが「複雑流体」と相性が良いのは、界面力や相分離をモデル化する流儀が複数あり、目的に応じて選べるためである。

代表的な多相LBMの枠組みは以下である。
- 擬ポテンシャル（Shan–Chen）型：近接格子との相互作用で非理想性を導入し相分離を再現する
- 自由エネルギー型：界面自由エネルギーを設計して圧力テンソルを整合させる
- カラー勾配（color-gradient）型：二相の分布を色で分けて界面張力を制御する
- フェーズフィールド連成型：秩序変数（Cahn–Hilliard/Allen–Cahn）で界面を記述し、流れをLBMで解く

濡れ性（接触角）や表面張力を扱う場合、境界条件と界面モデルの整合が精度を左右する。また、密度比が大きい気液二相や強い表面張力条件では、スパリアスカレント（偽流）や数値拡散が顕在化しやすいため、モデル選択と格子解像度の設計が重要になる。

## 8. 乱流・高レイノルズ数・安定化
LBMは完全陽的更新であるため大規模並列に向く一方、低粘性（$\tau\to \Delta t/2$）の条件では不安定化しやすい。これに対し、
- MRT/TRT/正則化（regularized）による高次モーメントの制御
- エントロピックLBMによる非線形安定性の担保
- セントラルモーメント／キュムラント衝突による不変性と安定性の改善
- LES（サブグリッドモデル）との併用
が研究されている。

国内でも、キュムラント衝突とフェーズフィールドを組み合わせて二相流の安定性を高める試みなどが報告されている。

## 9. 固体物理・材料プロセスへの見通し
LBMは「流体」だけの方法ではない。輸送方程式と幾何学の扱いやすさにより、材料系では次のような形で現れる。

### 9.1 多孔質・浸透・反応輸送
電極・触媒担体・焼結体・岩石・多孔質膜など、内部構造が複雑な媒体では、透過率・屈曲度・界面濡れ性・二相浸透の非線形性が物性を支配する。LBMはボクセル形状に対して局所ルールで流れを進められるため、形状情報（画像）と輸送現象を結びつけやすい。

### 9.2 凝固・デンドライト・相変態の連成
合金凝固や急速凝固では、界面の移動（相変態）と溶質拡散、温度場、そして溶融金属の対流が結び付く。フェーズフィールドを相変態に、LBMを流れに用いる連成は自然な設計であり、近年もデンドライト成長を対象にしたLBM–フェーズフィールド結合モデルが提案されている。

### 9.3 熱輸送：ボルツマン輸送方程式との接続
固体の格子熱伝導は、フォノン・ボルツマン輸送方程式（phonon BTE）の解として理解される。LBMは本来ボルツマン方程式の離散化に由来するため、フォノンBTEを基礎にした熱輸送の数値スキームとしての展開もある。拡散極限ではフーリエ則が再現され、非平衡・非局所輸送の近似にも入り口を与える。

## 10. 物理量のスケーリング
LBMでは格子単位（lattice unit）で計算することが多い。そのため、現実単位への対応付け（単位写像）が必須である。基本手順は次の通りである。

1. 代表長さ $L$（例：孔径、試料厚み、粒径）を決め、格子分解能 $N$ を決める  
   $$
   \Delta x = L/N
   $$
2. 代表速度 $U$ とマッハ数制約 $M=U/c_s\ll 1$ を満たすように $\Delta t$ を選ぶ  
   格子音速は格子モデルで決まるため、$U$ を格子単位へ写す際は $M$ を意識する。
3. 物性（粘性 $\nu$、拡散 $D$ など）から緩和時間を決める  
   $$
   \nu=c_s^2\left(\tau-\frac{\Delta t}{2}\right),\qquad
   D=c_s^2\left(\tau_g-\frac{\Delta t}{2}\right)
   $$
4. 無次元数（$Re=UL/\nu$, $Pe=UL/D$ など）で目的条件が再現できているか確認する

注意点として、(i) $M$ を十分小さくしないと圧縮性誤差が増える、(ii) $\tau$ を $0.5$ に近づけるほど不安定化しやすい、(iii) 境界・界面の数値誤差は格子解像度に敏感である、が挙げられる。

## 11. ベンチマークと検証
初期導入では、次の順で検証すると破綻しにくい。
- 静止流体：一様場が保持されるか（数値ノイズや発散の有無）
- ポアズイユ流：解析解と速度プロファイルが一致するか
- ふた付きキャビティ（lid-driven cavity）：渦構造の再現
- 体積力駆動（外力項の検証）
- 多相なら液滴静止：ラプラス圧と界面保持
- 多孔質なら透過率：ダルシー則の再現

## まとめ
LBMは、離散速度分布関数の更新という運動論的な枠組みから、弱圧縮性ナビエ–ストークス方程式を回収しつつ、複雑形状・多相・多物理を局所更新則で拡張できる手法である。衝突演算子（SRT/MRT/エントロピック/キュムラントなど）と界面モデル、単位写像（スケーリング）の3点が設計の要であり、目的現象に合わせて選ぶことで、材料組織・輸送・相変態を含む幅広い有限スケール現象を一貫した数理で扱える。