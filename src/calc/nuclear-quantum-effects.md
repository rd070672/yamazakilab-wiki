# 核量子効果（NQE）と量子統計

核量子効果（NQE）は、軽元素（特に水素）や低温・高圧・強い結合（強い水素結合など）で顕在化し、構造安定性、同位体効果、拡散、振動スペクトル、相転移温度などを左右する要因となる。第一原理電子状態計算に、経路積分に基づく核の量子統計を統合することで、電子と原子核の量子性を同じ枠組みで扱えるようになる。

## 参考ドキュメント
1. i-PI documentation
   https://ipi-code.org/
2. Ceriotti et al., i-PI: A Python interface for ab initio path integral molecular dynamics simulations (Computer Physics Communications, 2014)
   https://arxiv.org/abs/1311.5050
3. Kapil et al., i-PI 3.0: A universal force engine for advanced molecular simulations (J. Chem. Phys., 2024)
   https://pubs.aip.org/aip/jcp/article/161/4/044111/3311526/i-PI-3-0-A-universal-force-engine-for-advanced


## 1. 核量子効果（NQE）とは何か
原子核を古典粒子として扱うと、次のような現象が取りこぼされることがある。

- 零点振動（zero-point energy, ZPE）
- 量子的非局在化（波動関数の広がり）
- トンネル効果（障壁越え・拡散・反応の促進）
- 同位体効果（H/D/T 置換での構造・ダイナミクスの差、逆同位体効果など）

重要度の目安の一つは熱ド・ブロイ波長である。
$$
\lambda_{\mathrm{dB}}=\frac{h}{\sqrt{2\pi m k_{\mathrm{B}}T}}
$$
$\lambda_{\mathrm{dB}}$ が、原子間距離スケール（例えば 0.5〜1 Å 程度）やポテンシャル井戸幅に近づくと、古典核近似は破綻しやすい。

代表例
- 金属中水素：拡散係数の温度依存が単純な Arrhenius 則から外れる、同位体で拡散機構が変わる
- 高圧氷・水素結合結晶：ZPE と非局在化が格子定数、相の安定性、誘電応答に寄与する
- 水素化物・プロトン伝導体：プロトンの量子揺らぎが欠陥形成や伝導の律速を変える

## 2. 「第一原理計算」と核量子性の接続点
標準的な第一原理分子動力学（AIMD）は、ボルン–オッペンハイマー近似のもとで
- 電子：量子力学（多くは DFT）
- 原子核：古典力学（ニュートン方程式）
として進めることが多い。

NQE を導入する基本発想は、核を「量子統計（有限温度量子ボルツマン分布）」でサンプリングする点にある。ここで登場するのが経路積分である。

## 3. 経路積分：量子統計をリングポリマーへ写像する
量子系の分配関数は
$$
Z=\mathrm{Tr}\left[e^{-\beta \hat{H}}\right],\quad \beta=\frac{1}{k_{\mathrm{B}}T}
$$
で与えられる。運動エネルギー $\hat{T}$ とポテンシャル $\hat{V}$ に対し、トロッター分解により
$$
e^{-\beta(\hat{T}+\hat{V})}\approx \left(e^{-\beta\hat{T}/P}e^{-\beta\hat{V}/P}\right)^P
$$
と書ける（$P$ はビーズ数、$P\to\infty$ で厳密）。

この操作により、量子統計平均は「同じ粒子が $P$ 個の複製（ビーズ）として環状に結合した」古典系（リングポリマー）の統計平均に等価となる。1 粒子 1 次元の直感的な形は
$$
H_P(\{q_j,p_j\})=\sum_{j=1}^{P}\left[\frac{p_j^2}{2m}+\frac{1}{2}m\omega_P^2(q_j-q_{j+1})^2+\frac{1}{P}V(q_j)\right]
$$
$$
\omega_P=\frac{P}{\beta\hbar},\quad q_{P+1}=q_1
$$
であり、実系では全原子・3次元に拡張される。

この写像が意味すること
- 量子核の「広がり」は、ビーズ配置の広がりとして表現される
- 平衡物性（構造分布、自由エネルギー、同位体効果など）は、リングポリマーの統計として評価できる

## 4. 第一原理PIMD（Path Integral Molecular Dynamics）とは何か
### 4.1 PIMD の定義と狙い
経路積分分子動力学（PIMD：Path Integral Molecular Dynamics）は、上のリングポリマー分布
$$
\rho_P \propto e^{-\beta H_P}
$$
をサンプリングするために、古典 MD や確率過程（熱浴）を用いる手法である。重要点は次である。

- PIMD は有限温度量子統計（平衡分布）を得るためのサンプリング法である
- PIMD で得られる「時間発展」は、平衡サンプリングのための仮想的ダイナミクスであり、実時間の量子ダイナミクスそのものではない

ここに第一原理が加わると、
- 各ビーズの力 $-\nabla V(q_j)$ を DFT などで on-the-fly に計算する
という形になり、これが第一原理 PIMD（ab initio PIMD）である。

ここで用語の整理をしておく。
- 経路積分法（path integral, PI）
  有限温度量子統計（分配関数や統計平均）を、リングポリマーの古典統計として書き換える数理である。

- Ab initio経路積分法
  リングポリマーの各ビーズで必要となるポテンシャルと力を、DFTなどの電子状態計算でその場計算する枠組みである。言い換えると「第一原理PES上の経路積分」である。

- 経路積分分子動力学（PIMD: Path Integral Molecular Dynamics）
  経路積分で得られたリングポリマー分布をサンプルするために、MD（と熱浴）を用いるサンプリング手法である。PIMDは平衡量（静的量）に強い。

関係を一行で書くと次である。
- 経路積分（PI）は写像の理論
- Ab initio は力の出所（第一原理）
- PIMD は写像された古典系をどうサンプルするか（MDで回す）

### 4.2 計算コストと並列性
PIMD はビーズ数 $P$ だけ力評価が増えるため、単純にはコストが $P$ 倍になる。一方で、ビーズごとの力評価は並列化しやすく、計算資源の使い方が性能を左右する。

### 4.3 ビーズ数 $P$ の目安と収束
経験的に、最も高い振動数 $\omega_{\max}$（例：X–H 伸縮）に対して
$$
P \gtrsim \beta\hbar\omega_{\max}
$$
が粗い目安となる。温度が下がるほど（$\beta$ が大きいほど）必要な $P$ は増える。

収束判断の典型
- $P$ を 2 倍にして、目的物性（格子定数、RDF、自由エネルギー差、拡散係数など）が誤差内で変わらない
- 推定量（kinetic energy estimator など）の統計誤差と系統誤差を分けて監視する


### 4.4 収束加速の代表例
- 正規モード変換・staging 変換：リングポリマー内部モードの硬さを扱いやすくする
- 熱浴（Nosé–Hoover chain, Langevin, GLE など）：カノニカル分布を効率よくサンプリングする
- PIGLET（GLE による加速）：少ない $P$ でも量子ゆらぎを再現しやすくする
- Ring Polymer Contraction（RPC）：高価な遠距離成分などを粗いビーズで評価して加速する
- DFT の代わりに ML ポテンシャルを併用：PIMD のボトルネック（多回の力評価）を軽量化する

## 5. RPMD (Ring Polymer Molecular Dynamics) は何か：PIMD とどう関わるのか
### 5.1 PIMD と RPMD の位置づけ（混同しやすい点）
PIMD は平衡量（量子統計平均）を得るための方法である。これに対し、RPMD は
- 量子の実時間相関関数（のうち Kubo 変換相関）を近似的に評価する
ことを目的とした「近似量子ダイナミクス法」である。

両者の関係は次のように整理できる。

- PIMD：初期分布（量子ボルツマン）をサンプリングする枠組み
- RPMD：その初期分布上で、リングポリマーの古典ハミルトン方程式を実時間で発展させ、相関関数を近似する枠組み

図式
- 平衡：量子分布  →（経路積分写像）→  リングポリマー分布  →（PIMD）→  サンプル生成
- 動力学：リングポリマー分布から初期条件を取り  →（RPMD の実時間発展）→  近似相関

### 5.2 近似する対象：Kubo 変換相関関数
量子の時間相関の一つとして Kubo 変換相関がある。
$$
\tilde{C}_{AB}(t)=\frac{1}{\beta}\int_{0}^{\beta} d\lambda\,
\langle e^{\lambda \hat{H}}\hat{A}e^{-\lambda \hat{H}}\hat{B}(t)\rangle
$$
RPMD は、この種の相関（特に位置依存演算子を含む場合）に対して、リングポリマー上の古典相関で近似する。

### 5.3 RPMD の長所と注意点
長所（典型的に語られる性質）
- 初期分布が量子ボルツマン分布（P→∞ で厳密）に整合
- 調和系では良い性質（短時間極限や調和ポテンシャルでの整合性）を持つ
- 拡散や振動スペクトルなどで有用な場合がある

注意点（誤解を避ける要点）
- RPMD は厳密な量子実時間ダイナミクスではない
- 深いトンネル支配、強い干渉効果、非断熱効果などでは破綻しうる
- 振動スペクトルではリングポリマー内部モード由来の偽ピーク（スプリアス共鳴）が問題になることがある

## 6. CMD / TRPMD：RPMD 周辺の代表的拡張
PIMD と RPMD の間には「量子ダイナミクスをどう近似するか」という流派が複数ある。特に凝縮系物性で頻出するのが CMD と TRPMD である。

- CMD（Centroid Molecular Dynamics）
  - セントロイド（ビーズ平均座標）に注目し、セントロイドの運動として動力学量を近似する
  - ある条件では振動スペクトルの扱いで有利だが、曲率問題などのバイアスが知られる

- TRPMD（Thermostatted RPMD）
  - リングポリマー内部モードに熱浴を入れて、スプリアス共鳴の影響を抑える狙い
  - スペクトル評価で RPMD より安定にふるまう場合がある

## 7. 目的別の選択表
| 目的 | 主な候補 | 得意な点 | 典型的な注意点 |
|---|---|---|---|
| 平衡構造（RDF、格子定数、配位統計） | PIMD | 量子統計平均を直接評価できる | P の収束、熱浴設定、統計誤差 |
| 自由エネルギー差、同位体効果 | PIMD + TI など | 同位体置換や相安定性の差を評価 | 経路（λ）の設計、収束 |
| 拡散係数、時間相関（近似） | RPMD / CMD | Kubo 変換相関を近似 | 深いトンネル・非断熱に弱い |
| 振動スペクトル（IR/Raman の一部） | TRPMD / CMD | スペクトルの安定化 | 手法依存の歪み、ピーク位置の検証 |

## 8. 典型ワークフロー
### 8.1 第一原理 PIMD
1. 構造準備（欠陥、界面、固溶、圧力条件など）
2. DFT 条件決定（交換相関、k 点、カットオフ、スピン、U、分散補正など）
3. 温度・アンサンブル・ビーズ数 $P$ の初期設定
4. 平衡化（短い古典 MD → PIMD に移行することも多い）
5. 収束確認（$P$ と時間長、推定量の安定性）
6. 解析（構造統計、ZPE 指標、同位体差、自由エネルギー差など）

### 8.2 RPMD（または CMD/TRPMD）
1. PIMD で量子分布に整合する初期条件をサンプリング
2. リングポリマーの実時間発展を行う（手法に応じた発展式）
3. 速度自己相関、位置相関などから物性へ変換（拡散係数、スペクトルなど）
4. 近似の妥当性確認（古典 MD・調和近似・実験とのクロスチェック）

## 9. 注意点
- PIMD のトラジェクトリを、そのまま「実時間の運動」と解釈してしまう
- $P$ 不足で ZPE や同位体効果が過小評価される
- 時間刻みが大きすぎて内部モードが不安定になる（リングポリマー内部は高周波）
- RPMD のスペクトルで偽ピークが出る場合に、TRPMD などの検討をせず結論してしまう
- 第一原理誤差（汎関数、擬ポテンシャル、磁性、励起状態）が NQE と同程度に効いているのに分離して議論してしまう

## まとめ
- 核量子効果は、軽元素系や低温・高圧・強い結合で顕在化し、構造・拡散・同位体効果などの理解に不可欠となる場合がある。  
- 第一原理 PIMD は、DFT 等で得るポテンシャル上で核の量子統計をリングポリマーとしてサンプリングする枠組みであり、平衡物性に強い。  
- RPMD は、PIMD で得た量子ボルツマン分布を初期分布として用い、リングポリマーの実時間発展により Kubo 変換相関を近似する手法であり、PIMD と目的が異なる。  
- PIMD／RPMD／CMD／TRPMD は相補的であり、対象現象（平衡か、相関か、スペクトルか）と近似の限界を明確にした上で使い分けるのが基本である。  

