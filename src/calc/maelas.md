# MAELAS による磁気弾性効果の計算

MAELASは、スピン分極DFT計算（主にVASPを想定）で得た全エネルギーの差から、磁気弾性定数・磁歪係数・自発体積磁歪などを一貫して評価するための自動化ツールである。SOCを含む磁化方向依存エネルギーと、ひずみ印加によるエネルギー応答を組み合わせ、磁気—格子結合を定量化する枠組みである。

## 参考ドキュメント
- MAELAS公式GitHub（READMEとExamplesが実務の起点）
  https://github.com/pnieves2019/MAELAS
- 交換磁歪（等方成分）まで含めた手法（MAELAS v3.0に対応）
  https://arxiv.org/abs/2210.00791
- 日本語での概要（JST・京大機械翻訳）
  https://jglobal.jst.go.jp/detail?JGLOBAL_ID=202202205918153778

## 1. MAELASが扱う量と位置づけ
主に次を対象とする。
- 磁気異方性エネルギー（MAE）の確認用計算支援
- 異方性磁気弾性定数（anisotropic magnetoelastic constants）$b^{ani}$
- 異方性磁歪係数（anisotropic magnetostrictive coefficients）$λ^{ani}$
- 等方性（交換）磁気弾性定数（isotropic magnetoelastic constants）$b^{iso}$
- 等方性磁歪係数 $λ^{iso}$ と自発体積磁歪 $ω_s$（とくにインバー的挙動の議論に重要）

磁歪係数 $λ$ が実験（ひずみ応答）の言語に近い一方、磁気弾性定数 $b$ は連続体モデル（磁歪エネルギー項）やマルチフィジックス連成に直結する量である。MAELASは、$λ$ と $b$ を弾性定数 $C_{ij}$ で相互に変換できるよう設計されている（弾性定数の入力がある場合）。

## 2. 磁気弾性エネルギーと“エネルギー差”のフィッティング
磁気弾性は、ひずみ $ε$ と磁化方向（方向余弦）$α$ の結合として展開される。代表例として立方晶では、一次の磁気弾性エネルギーは

$$
E_{me}
=
b_1(\varepsilon_{xx}\alpha_x^2+\varepsilon_{yy}\alpha_y^2+\varepsilon_{zz}\alpha_z^2)
+
2b_2(\varepsilon_{xy}\alpha_x\alpha_y+\varepsilon_{yz}\alpha_y\alpha_z+\varepsilon_{zx}\alpha_z\alpha_x)
$$

の形で書ける（符号規約は文献・実装により差があり得る）。実務的には、

- ある磁化方向（例：[100] と [001]）を固定したSOC計算を複数行い
- ひずみ $ε$ を系統的に振って全エネルギー $E(ε)$ を集め
- $E(ε)$ の差分が理論式と整合するようにフィットして $b$ や $λ$ を得る

という流れになる。MAELAS v2以降は、非立方晶を含めて “エネルギー vs ひずみ” の線形フィッティングに基づく直接導出が中核となる。

## 3. MAELASのmode
MAELASは mode によって、どの量を一次情報（直接フィット）として得るかが変わる。

| mode | 直接導出する主量 | SOC | 典型用途 |
|---|---|---|---|
| -mode 1 | $λ^{ani}$（長さ最適化ベース） | 要 | 立方晶中心の従来法、比較・検証用途 |
| -mode 2 | $b^{ani}$（E–strain線形フィット） | 要 | 非立方晶を含む異方性磁気弾性の主力 |
| -mode 3 | $b^{iso}$（交換磁歪に対応） | 不要（任意で含む） | 体積磁歪・インバー寄りの議論、等方成分の抽出 |

弾性定数（AELAS形式など）が与えられると、$b$ と $λ$ の相互変換や $ω_s$ の評価までを一気通貫で行える。

## 4. 典型ワークフロー
MAELASは「入力生成 → VASP実行 → 解析」の分業を前提としている。概略は次の通りである。

1. 基準構造の用意と緩和
   - 格子定数・内部座標の基準を定める（磁性体は初期磁気モーメントと磁気秩序に注意）
2. MAEのテスト（SOC計算が安定に回るか確認）
   - 磁化方向を変えて、エネルギー差が十分収束するかを確認する
3. ひずみ系列の生成（-g と -mode を指定）
   - 所定のひずみ振幅 $s$ と点数 $n$ で歪んだPOSCAR群と入力群を生成する
4. 各条件でVASP（SOC/非共線）計算を実行
   - OSZICAR などから最終エネルギーを回収できる形で揃える
5. 解析（-d と -mode を指定）
   - エネルギー差のフィットにより $b$ または $λ$ を導出する
6. 弾性定数との結合（任意）
   - $C_{ij}$ を与えて $λ(b,C)$ や $ω_s$ を算出し、材料定数セットとして整形する

MAELASはVASP入力の生成を強く支援するが、計算資源管理（ジョブ投入、再実行、収束不良の検知など）はユーザーの運用に依存するため、材料系の大規模スイープではジョブ配列やワークフロー管理（AiiDA, FireWorks, custodian等）と組み合わせると安定する。

## 5. 計算設計と精度
磁気弾性・磁歪は“エネルギー差の二次・一次係数”であり、数meV以下の差を扱う場面が多い。以下は効きやすい。

- k点、カットオフ、混成の収束
  - SOC計算はとくに収束がシビアになりやすい
- 対称性の扱い
  - 磁化方向固定（SAXIS等）では対称操作が意図せず有効に働くことがあるため注意する
- ひずみ振幅 $s$ の選び方
  - 小さすぎると数値ノイズに埋もれ、大きすぎると線形近似が破れる
- 原子位置緩和の方針
  - “ひずみを入れたあと内部座標を緩和するか”は物理的に意味が変わるため、対象（薄膜・バルク・拘束条件）に合わせて統一する
- mode 3（等方成分）の参照状態
  - 自発体積磁歪 $ω_s$ を得る参照状態は、常磁性の平衡体積と基底状態の磁気秩序を組み合わせたものとして定義されるため、入力構造の取り方が結果を支配する

## 6. 出力の読み方（$b$ と $λ$ をどこで使うか）
- $b^{ani}, b^{iso}$
  - 連続体の磁気弾性エネルギーや、磁歪・磁歪共鳴・磁気—弾性連成FEMに直接投入しやすい
- $λ^{ani}, λ^{iso}$
  - 実験の磁歪係数との比較、方位依存の伸び縮みの予測、テクスチャ（集合組織）を仮定した多結晶平均に使いやすい
- $ω_s$
  - 体積磁歪（交換相互作用の体積依存）を通じて、温度膨張やインバー的挙動の議論に接続しやすい

必要に応じて、MAELASviewerのような可視化ツールで、方向依存の磁歪曲面や係数セットの整合性を確認する運用が有効である。

## 7. 注意点
- 非立方晶でmode 1をそのまま使い、ばらつきが大きい
  - mode 2（E–strain線形フィット）へ切り替え、ひずみ系列と収束条件を見直す
- SOC計算で磁化が意図せず回転する／別の局所解に落ちる
  - 初期磁気モーメント、混成、対称性、電子温度（スメアリング）などを固定し、再現性を優先する
- ひずみ系列の符号や定義が混線する
  - ひずみテンソル、変形勾配、測定方向（長さの取り方）をドキュメント化し、入力生成の版管理を徹底する
- “弾性定数の入力”の単位・形式が合わない
  - AELAS互換形式（GPaなど）に揃え、変換の検証ケースを一度通す

## まとめ
- MAELASは、SOCを含むDFT全エネルギーのひずみ応答から、磁気弾性定数・磁歪係数・体積磁歪を自動導出するための実務的ツールである。
- 非立方晶や高精度が要求される場面では、mode 2（E–strain線形フィット）を中心に、収束設計と参照状態の定義を厳密に揃えることが要点である。
- 得られた $b$ と $λ$ は、実験比較だけでなく、磁気—弾性連成シミュレーションや材料設計の定数セットとしても再利用価値が高い。


