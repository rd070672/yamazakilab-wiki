# TOMBOの全電子混合基底法

TOMBOは、芯電子の強い局在と価電子・連続状態の広がりを同一の枠組みで扱うために、平面波と数値原子軌道を組み合わせた全電子混合基底法に基づく第一原理計算プログラムである。結晶だけでなく、表面・界面やクラスター等の非周期性を含む系にも同型の定式化で対応する点が特徴である。

## 参考ドキュメント
1. 佐原亮二, 小野頌太, 大野かおる, 全電子混合基底法プログラムTOMBOを活用した材料科学, まてりあ 53(9) (2014)
   https://www.jstage.jst.go.jp/article/materia/53/9/53_53.400/_pdf
2. MateriApps: TOMBO（日本語解説・公式サイト導線を含む）
   https://ma.issp.u-tokyo.ac.jp/app/455
3. TOMBO公式サイト（mixed basisの概念図と拡張法の概説）
   https://tombo.page/


## 1. TOMBOとは何か

TOMBO（TOhoku Mixed-Basis Orbitals ab-initio program）は、全電子・全ポテンシャルの密度汎関数理論（DFT）を中核とし、平面波（PW）と局在原子軌道（AO）の混合基底でKohn–Sham方程式を解くコードである。擬ポテンシャルでは捨象されやすい芯電子や、真空準位近傍から連続状態にかけての成分を含め、同一の波動関数表現で記述することを目的として設計される。

全電子法を採用する動機は、次のように整理できる。

- 芯電子を明示的に扱うことで、コア準位の束縛エネルギー、化学シフト、超微細相互作用といった量へ直接アクセスしやすい
- 表面・界面・クラスターでは、真空領域や非周期性に由来する連続状態・散乱状態の表現が重要になる場合がある
- 元素依存の擬ポテンシャル近似に起因する系統誤差を避け、電子状態の全体像（芯から価電子まで）を一貫して評価できる

一方で、全電子は計算コストが増えやすい。TOMBOは混合基底により、局在状態はAOで、広がった成分はPWで表現して「必要な自由度を必要な場所に割り振る」ことを狙っている。

## 2. Kohn–Sham方程式と混合基底展開

### 2.1 Kohn–Sham方程式
DFTの標準的な一電子方程式は

$$
\left[
-\frac{\hbar^2}{2m}\nabla^2 + V_{\mathrm{eff}}(\mathbf{r})
\right]\psi_{\nu}(\mathbf{r})
=
\varepsilon_{\nu}\psi_{\nu}(\mathbf{r})
$$

である。$V_{\mathrm{eff}}$ は外部ポテンシャル、Hartree項、交換相関ポテンシャル等から構成され、電子密度 $\rho(\mathbf{r})=\sum_{\nu}^{\mathrm{occ}}|\psi_\nu(\mathbf{r})|^2$ と自己無撞着に決まる。

### 2.2 混合基底（PW + AO）による波動関数表示
TOMBOの中核は、Kohn–Sham軌道を平面波と原子核近傍に局在した原子軌道の線形結合で表す点にある。概念式として

$$
\psi_{\nu}(\mathbf{r})
=
\frac{1}{\sqrt{\Omega}}\sum_{\mathbf{G}} c^{\mathrm{PW}}_{\nu}(\mathbf{G})e^{i\mathbf{G}\cdot\mathbf{r}}
+
\sum_{j}\sum_{nlm} c^{\mathrm{AO}}_{\nu}(jnlm)\,
\phi^{\mathrm{AO}}_{jnlm}(\mathbf{r}-\mathbf{R}_j)
\equiv \sum_{\xi} c_{\nu,\xi} f_{\xi}(\mathbf{r})
$$

と書ける。$\Omega$ はセル体積（周期系）、$\mathbf{G}$ は逆格子ベクトル、$\mathbf{R}_j$ は原子位置である。PWは空間的に滑らかな成分や真空領域を、AOは原子核近傍の急峻な変化や芯電子の局在を効率よく表現する。

## 3. 原子軌道の「閉じ込め」と過完全性の抑制

### 3.1 AOの生成：数値放射関数と（立方）調和関数
AOは一般に

$$
\phi^{\mathrm{AO}}_{jnlm}(\mathbf{r}) = Y_{lm}(\hat{\mathbf{r}})\,R_{jnl}(r)
$$

の形で表される。TOMBOでは球面調和関数の代わりに立方調和関数を用いる流儀があり、対称性に沿った積分の扱いを簡潔にする設計になっている。放射関数 $R_{jnl}(r)$ は原子計算に基づき数値的に生成される。

### 3.2 隣接原子との重なりを避ける：valence AOの切り出し
価電子に対応するAOは空間的に広がるため、そのままでは隣接原子のAOと重なり、重なり積分の計算が煩雑になり、基底の過完全性（overcompleteness）問題も生じやすい。TOMBOでは、非重複の原子球（cutoff半径 $r_{\mathrm{ct}}$）の内部に価電子AOを「閉じ込める」ための操作を導入する。

手順の要点は次である。

- もとのAOから、$r_{\mathrm{ct}}$ で関数値と1階微分が連続になる滑らかな多項式関数を差し引く
- 差し引きで得られた“残差”が、原子球内に局在した新しい価電子AOとなる
- もとのAOに相当する滑らかな部分は、PWで良好に表現できる

この分割により
- 隣接原子間AOの重なり積分の扱いが単純化する
- AOがより局在化し、過完全性が緩和される
といった利点が得られる。

## 4. 空間分割とポテンシャル：原子球内の球対称成分と全域成分

TOMBOは、単位胞（あるいは計算格子）に対し
- 全域（global）のメッシュ
- 各原子位置を中心とする非重複原子球（atomic sphere）
を定義し、密度や有効ポテンシャルを球内の球対称成分と残差（全域成分）に分けて取り扱う流儀を採る。

概念的には

$$
\rho(\mathbf{r}) = \sum_{j}\rho^{\mathrm{sph}}_j(r_j) + \rho^{\mathrm{rest}}(\mathbf{r})
$$

のように分解し、同様に $V_{\mathrm{eff}}(\mathbf{r})$ も分割して計算する。AOが支配的な原子球内では局在成分の精度を高め、PWが支配的な全域では滑らかな成分を効率よく扱うための設計である。これにより、孤立系と周期系を近い枠組みで扱えるという思想が明確になる。

## 5. 一般化固有値問題として解く

混合基底では基底関数が直交しないため、固有値問題は一般化固有値問題になる：

$$
\mathbf{H}\mathbf{c}_{\nu} = \varepsilon_{\nu}\mathbf{S}\mathbf{c}_{\nu}
$$

ここで $\mathbf{H}$ はハミルトニアン行列、$\mathbf{S}$ は重なり行列である。計算では、Cholesky分解などで

$$
\mathbf{S}=\mathbf{T}\mathbf{T}^{\dagger}
$$

として直交化し、通常の固有値問題へ変換したうえで対角化する流れが典型である。混合基底の利点は、PWカットオフを必要以上に上げずに、芯近傍の急峻な成分をAO側で回収できる点にある。

## 6. 相対論・スピン軌道・励起状態へ

### 6.1 相対論補正と重元素
重元素や精密な芯準位評価では相対論効果が重要である。TOMBOでは、入力設定によりDarwin項やmass-velocity項などの半相対論補正を取り込む設計が示されている。スピン軌道相互作用（SOC）を含む拡張も、全電子基盤との相性が良いテーマである。

### 6.2 GW・BSE・TDDFTなど
TOMBOはDFTに加え、GW近似やBethe–Salpeter方程式（BSE）など、励起状態計算の拡張が開発ラインとして強調されている。擬ポテンシャルでは扱いづらい芯準位や絶対エネルギー（例：電子親和力、イオン化ポテンシャル、コア準位束縛エネルギー）の議論と接続しやすいことが、全電子励起状態計算の動機となる。

また、時間依存密度汎関数理論（TDDFT）に基づく電子励起状態の分子動力学（励起状態MD）へも言及されており、光励起下のダイナミクスや反応過程、表面での非断熱的現象の近似的取り扱いに接続する。

## 7. 典型的な適用領域

TOMBOの特性から、次のようなテーマで有効性が出やすい。

- 芯準位・内殻寄りの物性
  - コア準位束縛エネルギー、化学シフト、ハイパーファイン（超微細）相互作用、Auger過程など
- 表面・界面・クラスター
  - 真空領域を含むポテンシャル形状、連続状態への接続、局在状態と拡張状態の混成
- 遷移金属・第一行元素
  - AOにより芯近傍を表現しつつ、PWの自由度を抑えて全ポテンシャルの精度を狙う
- 励起状態スペクトル
  - GW/BSE/TDDFTを通じた吸収・発光・励起子、絶対エネルギー基準が重要な問題設定

HPCI等の利用報告では、水素貯蔵材料を対象にTDDFTを導入したMD計算が試みられているなど、応用がエネルギー材料へも広がっている。

## 8. 他手法との比較

| 系統 | 代表例 | 芯電子 | 基底 | 得意な方向 | 代表的な注意点 |
|---|---|---|---|---|---|
| 擬ポテンシャルPW（PAW含む） | VASP, QE 等 | 多くは凍結（PAWで部分回復） | PW中心 | 構造最適化、大規模周期系 | コア準位や絶対エネルギーは設定依存が残りうる |
| FLAPW系 | WIEN2k 等 | 全電子 | LAPW | バルクの高精度、磁性・反強磁性 | 表面・孤立系の扱いは設定が重くなる場合がある |
| 全電子混合基底 | TOMBO | 全電子 | PW + 閉じ込め数値AO | 局在と拡張の同時記述、表面・クラスター、励起状態拡張 | 基底設計（原子球半径、AO選択、PWカットオフ）で収束像が変わる |

TOMBOの見通しは、「局在＝AO、滑らか＝PW」を徹底し、全電子・全ポテンシャルの精度を維持しつつ、計算自由度を抑えることである。一方で、混合基底ゆえにパラメータ（原子球の半径、AOの選択、PWカットオフ等）の相互依存が強く、収束確認の手順は丁寧である必要がある。

## 9. 収束と検証

- PWカットオフ
  - 混合基底では、擬ポテンシャルPWより低めのカットオフで同程度精度が出る場合があるが、全域ポテンシャルの鋭さ（真空領域、表面双極子、局在欠陥等）で必要値が増えることもある
- 原子球半径 $r_{\mathrm{ct}}$ とAO選択
  - 価電子AOの閉じ込めが過剰だと柔軟性が落ち、過小だと重なりや過完全性が増えるため、系に応じた探索が必要である
- 参照値との比較
  - 原子・小分子ではスペクトルや束縛エネルギー、結晶では格子定数・弾性・バンドギャップ等、段階的に検証する設計が有効である
- 励起状態
  - GW/BSE/TDDFTでは、基底・空間メッシュ・周波数積分等の追加パラメータが増えるため、DFT基底収束の上に追加収束を積むのが基本である

## まとめ
TOMBOは、平面波と閉じ込め数値原子軌道を混合基底として用い、全電子・全ポテンシャルのKohn–Sham方程式を一般化固有値問題として解く第一原理計算プログラムである。価電子AOを非重複原子球内に局在化する設計により、局在状態と拡張状態を同一の形式で精密に記述し、表面・クラスターから結晶までを一貫した枠組みで扱うことを目指すものである。

