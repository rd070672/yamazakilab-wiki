# ベリー位相とトポロジカル応答の計算

ベリー位相は、周期系の波動関数が持つゲージ構造を通じて、分極・ホール応答・軌道磁化・表面状態といった観測量を統一的に記述する概念である。計算では、ブリルアンゾーン上のベリー接続やベリー曲率を安定に評価し、積分・Wilson loop・対称性解析へ落とし込むことが要点である。

## 参考ドキュメント
1) D. Xiao, M.-C. Chang, Q. Niu, Berry phase effects on electronic properties, Rev. Mod. Phys. 82, 1959 (2010).
https://link.aps.org/doi/10.1103/RevModPhys.82.1959
2) Wannier90 Tutorials 18: Berry curvature, anomalous Hall conductivity and optical conductivity.
https://wannier90.readthedocs.io/en/latest/tutorials/tutorial_18/
3) 塩崎 謙, 結晶対称性とトポロジカル絶縁体（講義ノート, 日本語）.
https://www2.yukawa.kyoto-u.ac.jp/~ken.shiozaki/doc/Natsugaku.pdf


## 1. Berry接続とBerry曲率
結晶中の電子状態はブロッホ関数
$$
\psi_{n\mathbf{k}}(\mathbf{r}) = e^{i\mathbf{k}\cdot\mathbf{r}}\,u_{n\mathbf{k}}(\mathbf{r})
$$
で表される。ここで $u_{n\mathbf{k}}$ は格子周期関数であり、位相変換
$$
|u_{n\mathbf{k}}\rangle \rightarrow e^{i\phi_n(\mathbf{k})}|u_{n\mathbf{k}}\rangle
$$
に対して物理量が不変となるため、ゲージの取り方が数値計算の安定性に直結する。

単一バンド（あるいは非縮退近似）でのベリー接続（Berry connection）は
$$
\mathbf{A}_n(\mathbf{k}) = i\langle u_{n\mathbf{k}}|\nabla_{\mathbf{k}}|u_{n\mathbf{k}}\rangle
$$
であり、ベリー曲率（Berry curvature）は
$$
\mathbf{\Omega}_n(\mathbf{k})=\nabla_{\mathbf{k}}\times \mathbf{A}_n(\mathbf{k})
$$
である。多バンド・縮退を含む場合は、占有部分空間の非可換（non-Abelian）ベリー接続を用いる。

ベリー位相は閉曲線 $C$ に沿って
$$
\gamma_n(C)=\oint_C d\mathbf{k}\cdot \mathbf{A}_n(\mathbf{k})
$$
で与えられ、曲面 $S$ に対しては（適切な条件下で）
$$
\gamma_n(C)=\int_S d\mathbf{S}\cdot\mathbf{\Omega}_n(\mathbf{k})
$$
と関係づけられる。

## 2. 離散k点上での安定な評価
第一原理計算では $u_{n\mathbf{k}}$ は離散k点で得られる。したがって、微分を直接評価するのではなく、隣接k点の重なり
$$
M_{mn}(\mathbf{k},\mathbf{k}+\Delta\mathbf{k})=\langle u_{m\mathbf{k}}|u_{n,\mathbf{k}+\Delta\mathbf{k}}\rangle
$$
を用いてゲージ不変な量を構成するのが基本である。

例えば、離散ループ上のベリー位相は、占有空間（あるいは対象バンド集合）に対して
$$
e^{i\gamma} \approx \prod_{j=1}^{N}\det M(\mathbf{k}_j,\mathbf{k}_{j+1})
$$
のように計算できる。ここで $\mathbf{k}_{N+1}=\mathbf{k}_1$ とする。

2次元格子上では、格子プラーケットごとの曲率を位相として定義し、全BZ和からChern数を得る方法（Fukui–Hatsugai–Suzuki型の離散化）が広く用いられる。

## 3. Berry位相と電気分極の計算
バルク分極は電子の“位置”を単純な期待値として定義できず、多価性（分極の量子）を伴う。現代的分極理論では、分極差がベリー位相で与えられる。

概念的には、ある方向（例：$\hat{x}$）の分極は
$$
P_x = -\frac{e}{(2\pi)^3}\sum_{n\in \mathrm{occ}}\int_{\mathrm{BZ}} d\mathbf{k}\,A_{n,x}(\mathbf{k})
$$
の形で表される（実装では離散化と分極量子の解釈が必要である）。
強誘電・圧電・界面電荷などに直結し、DFTの標準機能として実装されていることが多い。

計算上の注意は、(i) 絶縁体ギャップの確保、(ii) k点メッシュの収束、(iii) 分極枝（branch）の選択である。分極は絶対値よりも、構造変形・電場・歪に伴う相対変化として扱うと堅牢である。

## 4. Berry曲率が支配するトポロジカル応答

### 4.1 異常ホール伝導度（AHE）
スピン軌道相互作用を含む強磁性体などでは、外部磁場がなくても異常ホール効果が生じる。ベリー曲率に基づく（いわゆる内因性）異常ホール伝導度は
$$
\sigma_{xy} = -\frac{e^2}{\hbar}\sum_{n\in\mathrm{occ}}\int_{\mathrm{BZ}}\frac{d^3k}{(2\pi)^3}\,\Omega_{n,z}(\mathbf{k})
$$
で与えられる（符号・添字は規約による）。

実際の計算では、BZ積分に極めて密なk点が必要になりやすい。そこで、最大局在ワニエ関数（MLWF）による補間でベリー曲率を高密度に評価し、積分収束を得る流儀が一般的である。

### 4.2 スピンホール伝導度（SHE）
時間反転対称性がある金属・半導体でも、スピン流の横応答（スピンホール）が現れる。実装ではスピン流演算子とKubo形式（あるいはスピンBerry曲率）で評価することが多い。SOCの扱い、スピン流の定義（保存則の問題）により数値が揺れやすいため、定義と比較条件を明示する必要がある。

### 4.3 軌道磁化と磁気光学応答
軌道磁化はベリー曲率とエネルギー重みを伴う量として定式化され、ギャップ系でも有限となりうる。磁気光学（Kerr/Faraday）も、ベリー曲率とKubo形式が結びついた形で評価されることが多い。

### 4.4 非線形応答
反転対称性の破れた結晶では、二次の光起電流（shift current）が生じ、これもベリー接続・ベリー曲率に関する幾何量で表される。実時間TDDFTで直接追う方法と、ワニエ補間＋非線形感受率で評価する方法が併存する。

## 5. トポロジカル不変量の定義と計算ルート

### 5.1 Chern数（量子ホール・Chern絶縁体）
2次元絶縁体でのChern数は
$$
C = \frac{1}{2\pi}\sum_{n\in\mathrm{occ}}\int_{\mathrm{BZ}} d^2k\,\Omega_{n,z}(\mathbf{k})
$$
で定義される。数値計算は離散化プラーケット和、またはワニエ補間による高密度積分で行う。

### 5.2 $\mathbb{Z}_2$ 不変量（時間反転対称トポロジカル絶縁体）
時間反転対称性をもつ系では、Chern数は全体として0でも、$\mathbb{Z}_2$ 指標が非自明になりうる。

代表的な計算法は次の2つである。
- Wilson loop（Wannier charge center; WCC）の流れ：占有部分空間のWilson loop演算子をk空間で計算し、ハイブリッドワニエ中心の“流れ”から $\mathbb{Z}_2$ を判定する。
- 反転対称性がある場合のパリティ判定：TRIM点での反転固有値から $\mathbb{Z}_2$ を決める（SOC込みでの対称性評価が鍵である）。

Wilson loop法は一般性が高く、実装も豊富である。一方、パリティ法は計算が軽いが、反転対称性が必須である。

### 5.3 鏡Chern数・結晶対称トポロジー
鏡対称などの結晶対称性で保護されたトポロジカル相では、鏡固有部分空間ごとのChern数（鏡Chern数）などが定義される。これらは対称演算子による部分空間分解と、部分空間ごとのベリー曲率積分で評価される。

### 5.4 Weyl点・ノーダル線
Weyl半金属では、Weyl点がベリー曲率の“磁荷”として働き、囲む面のChern数がchiralityに一致する。ノーダル線では、線をリンクする閉曲線のベリー位相が $\pi$ となることでトポロジカルに保護される場合がある。ギャップレス系では、有限温度・スミアリング・Fermi面近傍の数値安定性が重要となる。

## 6. 計算ワークフロー
代表的な流れを、実装非依存に整理する。

1. DFT基底状態
- SOCが必要な場合は必ず含める（AHE、SHE、$\mathbb{Z}_2$ などで本質的である）。
- 自己無撞着計算の精度、k点収束、スミアリング条件を整える。

2. 必要量に応じた表現選択
- 直接k点積分：小系・簡単な不変量には有効だが、AHEなどは収束が重い。
- ワニエ補間：ベリー曲率、AHE/SHE、WCC、表面状態などの評価に強い。

3. ワニエ化（MLWF）
- 目標バンドの選定、エネルギー窓、disentanglement の設定で結果が大きく変わる。
- 再現性チェックとして、ワニエ補間バンドがDFTバンドを十分な精度で再現することを確認する。

4. ポスト処理
- ベリー曲率、AHE、光学／磁気光学、軌道磁化、shift current など
- Wilson loop/WCC、Chern数、鏡Chern数、$\mathbb{Z}_2$ 指標
- 表面状態、Fermi arc、スピンテクスチャなど（エッジ対応を含む）

5. 対称性ベースの高速判定（近年の主流）
- 既約表現（irreps）や対称性指標（symmetry indicators）を用いる方法は、探索・スクリーニングで強力である。
- 平面波DFTの出力（波動関数・空間群演算）から既約表現を抽出するツールも存在し、トポロジカル量子化学（TQC）との接続が容易である。

## 7. 目的別まとめ
| 目的量 | 代表式（概念） | 代表的な評価法 | よくある落とし穴 |
| --- | --- | --- | --- |
| 分極差 | Berry位相（BZ積分） | 離散k点の重なり積、DFT実装 | 分極枝、ギャップ不在、k点不足 |
| AHE | $\int \Omega(\mathbf{k})$（占有） | ワニエ補間で高密度積分 | SOC未導入、Fermi準位依存、収束不良 |
| Chern数 | $(1/2\pi)\int \Omega$ | プラーケット和、ワニエ補間 | 数値ゲージ不安定、ギャップ閉鎖 |
| $\mathbb{Z}_2$ | WCC流れ、またはパリティ | Wilson loop/WCC、TRIMパリティ | 反転対称の要否、占有数の誤り、平面のギャップ |
| 鏡Chern等 | 対称部分空間ごとのChern | 既約表現・射影＋曲率積分 | 対称演算子と基底の整合 |
| Weyl chirality | 囲む面のChern | 小球面上の曲率積分 | 点同定の誤り、数値ノイズ |

## 8. 注意点
- ゲージの滑らかさが重要であり、縮退点や近接バンドでは非可換定式化が不可欠である。
- ワニエ補間では、局所化の良否とdisentanglementの妥当性が応答量に直結する。
- AHEやSHEはFermi準位近傍の寄与が鋭く、k点密度とスミアリングの系統依存性が大きい。
- $\mathbb{Z}_2$ を平面ごとに評価する場合、その平面でギャップが閉じていないことを確認すべきである。
- 対称性指標を用いる場合でも、実バンド構造（ギャップ、交差、SOC）に照らした整合検証が必要である。

## まとめ
ベリー位相とベリー曲率は、分極・ホール応答・軌道磁化・非線形光応答を同一の幾何学的言語で結びつけ、トポロジカル不変量として相の分類を可能にする。計算では、離散k点上の重なり行列でゲージ不変量を作ること、ワニエ補間で高密度評価を実現すること、対称性解析（既約表現・指標）と物理量（曲率積分・WCC流れ）を相互検証することが要点である。

