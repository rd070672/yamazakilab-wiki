# 第一原理分子動力学（AIMD）の原理

第一原理分子動力学（AIMD: ab-initio molcular dynamics）は、電子状態計算で得た原子間力を用いて原子核の運動方程式を直接積分し、温度・圧力下での構造ゆらぎや反応を追跡する手法である。経験力場に依らず、結合の切断・生成や電荷移動を含む現象を同一の枠組みで扱える点が特徴である。

## 参考ドキュメント
1. R. Car, M. Parrinello, Unified approach for molecular dynamics and density-functional theory, Phys. Rev. Lett. 55, 2471 (1985)
   https://link.aps.org/doi/10.1103/PhysRevLett.55.2471
2. VASP Wiki: MDALGO（サーモスタット/バロスタットとアンサンブルの実装）
   https://vasp.at/wiki/MDALGO
3. 森川良忠, カー・パリネロ法（<小特集>「第一原理による電子物性」）, 日本物理学会誌 48(6), 428-437 (1993)
   https://www.jstage.jst.go.jp/article/butsuri1946/48/6/48_6_428/_article/-char/ja/


## 1. AIMDが解く問題の骨格

### 1.1 電子と原子核の分離（断熱近似）
電子座標を $r$、原子核座標を $R$ とし、全波動関数を $Ψ(r, R)$ とする。電子は原子核より十分高速に緩和するとみなし、ある瞬間の $R$ に対して電子系が（概ね）基底状態または有限温度平衡にあると仮定する。

このとき原子核は、電子の作るポテンシャルエネルギー面 $U(R)$（または自由エネルギー面 $F(R)$）上を古典力学で運動する。

### 1.2 力の定義と運動方程式
原子核 $I$ の質量を $M_I$、座標を $R_I$ とすると

$$
M_I \ddot{\mathbf R}_I = \mathbf F_I = - \nabla_{\mathbf R_I} U(\{\mathbf R\})
$$

である。$U$ は通常、DFT（Kohn–Sham）全エネルギー $E_KS$ を用いて与える。平面波のような完備基底に近いとき力は主にヘルマン–ファインマン力で与えられ、局在基底などではプーリー補正（Pulay force）が重要となる。

### 1.3 金属・高温で効く「有限温度」電子
金属や高温では占有数の平滑化（smearing）や電子温度 $T_e$ を導入し、エネルギーではなく自由エネルギー

$$
F = E - T_e S
$$

を最小化して力を定義することが多い。これによりSCFが安定し、温度条件に整合した力を得やすい。

## 2. 代表的な2方式：BOMDとCPMD

AIMDは大きく2系統に分かれる。

### 2.1 Born–Oppenheimer MD（BOMD）
各MDステップで電子系を（所定の収束まで）自己無撞着に解き、原子核を進める方式である。

特徴
- 電子が常に基底（または定義した有限温度）にいるので解釈が明快
- SCFの収束が悪い条件（金属、ギャップ閉鎖、相転移近傍）ではコスト増・不安定化しやすい
- エネルギードリフトは、積分誤差に加えSCF誤差が効きやすい

### 2.2 Car–Parrinello MD（CPMD）
電子軌道にも仮想質量 $μ$ を与え、拡張ラグランジアンで原子核と同時に時間発展させる方式である。

$$
L =
\sum_I \frac{1}{2} M_I \dot{\mathbf R}_I^2
+ \frac{\mu}{2}\sum_i \langle \dot{\psi}_i | \dot{\psi}_i \rangle
- E_{\mathrm{KS}}[\{\psi_i\},\{\mathbf R_I\}]
+ \sum_{ij}\Lambda_{ij}\left(\langle \psi_i|\psi_j\rangle-\delta_{ij}\right)
$$

特徴
- ステップ毎の完全SCFを避けやすい（条件次第で高速化）
- $μ$ の選定、断熱分離の維持、エネルギー移行（電子系への加熱）に注意が必要
- 金属や強い励起では扱いが難しくなりやすい

### 2.3 比較表

| 項目 | BOMD | CPMD |
|---|---|---|
| 電子状態 | 毎ステップで最小化（SCF） | 軌道も運動方程式で更新 |
| パラメータ依存 | SCF閾値・混合法依存が大きい | 仮想質量μなどの依存が大きい |
| 金属への強さ | smearing等で改善するがSCFがボトルネックになりやすい | 断熱分離が崩れやすく難度が上がりやすい |
| 解釈 | 最も素直 | 条件を満たす限りBOMD近似 |

## 3. 統計力学：どのアンサンブルを回すか

AIMDは「力の計算」が高価であるため、目的に合わせた最小限のアンサンブル設計が重要である。

| アンサンブル | 制御量 | 主な用途 |
|---|---|---|
| NVE | N,V,E | エネルギー保存・ダイナミクス解析の基準（ドリフト確認） |
| NVT | N,V,T | 熱平衡構造、拡散、欠陥移動、反応の初期評価 |
| NPT | N,P,T | 熱膨張、相転移、密度変化、融解・急冷の密度整合 |

温度制御（サーモスタット）
- Nosé–Hoover系：決定論的、平衡分布を理論的に扱いやすい
- Langevin：確率的、数値的に頑健で緩和が速いことが多い

圧力制御（バロスタット）
- Parrinello–Rahman：セル自由度を動的に扱い、異方的応力にも対応しやすい
- NPTは緩和が遅いことがあるため、NVTで予備平衡→NPTで微調整という運用が多い

## 4. 代表的な計算設定

### 4.1 時間刻み $Δt$ と計算時間
- Δt は最速振動（軽元素や強結合）に支配される
- 目安として 0.5–2 fs 程度から始め、温度制御やエネルギードリフトで妥当性を判断する
- AIMDで到達しやすい時間は ps〜数十psが中心であり、希少事象（核生成、ゆっくりした拡散）はそのままでは観測困難になりがちである

### 4.2 系サイズと境界条件
- 周期境界を前提とするため、欠陥・表面・界面ではセルサイズ依存を必ず疑う
- 相転移や長波長ひずみを扱うときは、セルの自由度（NPT、応力制御）の導入が有効である

### 4.3 k点、カットオフ、擬ポテンシャル
- MDでは単一k点（Γ）運用が多いが、金属・小セルでは誤差が増えやすい
- カットオフ不足は力のノイズとして現れ、温度・拡散係数に直結する
- 目的（拡散、反応、相安定）に対して、静的計算での収束確認を先に行うのが定石である

### 4.4 電子温度・smearingの扱い
- 金属では smearing を使うが、電子温度が実温度と一致しているとは限らない
- ただし有限温度自由エネルギー最小化は、数値安定性と物理整合の両方に効く場合がある

## 5. AIMDから物性量を引き出す基本手順

### 5.1 平衡化とサンプリング
- 初期緩和（構造最適化）→加熱・冷却（温度ランプ）→平衡化（定温）→統計取得
- 物性評価は「平衡化後」のトラジェクトリ区間で行うのが原則である

### 5.2 構造関数：RDFと配位数
部分RDF $g_{αβ}(r)$ は局所秩序の定量化に有効である。配位数は

$$
N_{\alpha\beta}(r_c)=4\pi \rho_\beta \int_0^{r_c} r^2 g_{\alpha\beta}(r)\,dr
$$

で定義できる（$r_c$は第一極小など）。

### 5.3 拡散係数：MSDからの評価
粒子の平均二乗変位

$$
\mathrm{MSD}(t)=\left\langle \left|\mathbf r(t)-\mathbf r(0)\right|^2 \right\rangle
$$

長時間極限で

$$
D = \lim_{t\to\infty}\frac{1}{6t}\mathrm{MSD}(t)
$$

である。有限時間・有限サイズの補正が必要になることがある。

### 5.4 振動状態密度：速度自己相関
速度自己相関関数 $C_v(t)=⟨ v(0)·v(t) ⟩$ のフーリエ変換から、振動状態密度やIR/Raman相当の情報を推定できる。固体の格子振動、アモルファスのボソンピーク的特徴の議論にも用いられる。

## 6. AIMDの適用範囲と拡張

### 6.1 得意領域
- 経験力場が不確かな系（新規組成、欠陥化学、界面反応）
- 化学反応、電荷移動、局所構造変化を伴う高速現象
- 小〜中規模セルでの短時間ダイナミクスの定量

### 6.2 制約
- 時間スケールとサイズの制約が本質的である
- 交換相関汎関数、スピン、$U$、分散補正などのモデル化が結果に影響しうる
- 希少事象は、加速法（メタダイナミクス、umbrella sampling、温度加速、経路探索）を併用するのが現実的である

### 6.3 実務上の合理的な併用
AIMDで局所化学を担保しつつ、より長時間・大規模には機械学習ポテンシャルや古典MDへ接続する運用が広く用いられている。国内でもHPC環境における第一原理ダイナミクス活用事例が継続的に整理・共有されている。

## 7. チェックリスト
- NVEでエネルギードリフトが許容範囲か
- 温度・圧力の緩和時間が目的に対して十分短いか
- カットオフ、k点、smearingが力のノイズを増やしていないか
- セルサイズ依存（欠陥相互作用、界面相互作用）が疑われないか
- 解析区間が平衡化後に限定されているか

## まとめ
AIMDは、電子状態に裏付けられた原子間力で温度・圧力下の構造とダイナミクスを扱うための中核手段である。BOMDとCPMD、アンサンブル設計、数値収束、統計処理の4点を押さえることで、短時間・中規模のシミュレーションからでも材料現象に直結する定量情報を引き出せるようになる。
