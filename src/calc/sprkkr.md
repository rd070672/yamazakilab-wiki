# SPR-KKRによる磁性計算：

SPR-KKRは、KKR（Korringa–Kohn–Rostoker）グリーン関数法に基づいて電子状態を解き、磁性（SOC、ノンコリニア、スピン螺旋、無秩序合金など）を一貫して扱える計算パッケージである。とくに交換相互作用や磁気異方性など、応答・分光・輸送へつながる量を「同じグリーン関数の枠組み」で実装できる点が特徴である。

## 参考ドキュメント
- MateriApps: SPRKKR（日本語）
  https://ma.issp.u-tokyo.ac.jp/app/394
- Munich SPRKKR（機能一覧・入手方法）
  https://www.ebert.cup.uni-muenchen.de/old/index.php?option=com_content&view=article&id=8&catid=4&Itemid=7&lang=en
- Ebert et al., “Calculating condensed matter properties using the KKR-Green’s function method—recent developments and applications” の該当節（トルク法、交換相互作用、DMI等の式）
  https://psi-k.net/download/highlights/Highlight_97.pdf

## 1. 何が得意か（位置づけ）
SPR-KKRが強い典型シーンは次の通りである。

- 無秩序合金（置換無秩序）をCPAで扱い、組成依存の磁性・輸送を連続的に追う
- SOCを含む全相対論（fully relativistic）で、磁気異方性（MAE）や軌道磁気モーメントを評価する
- ノンコリニア磁性、任意スピン配向、スピン螺旋を用いて、交換相互作用やDMIへ接続する
- 層状系・表面・界面・クラスターを（近似も含めて）グリーン関数的に扱う

一方で、巨大スーパーセルでの欠陥ランダム配置を正面から扱う用途は、平面波DFT＋大規模セルのほうが向く場合が多い。SPR-KKRは「無秩序を平均場（CPA等）で表現し、応答量まで含めて効率良く進む」方向で真価が出やすい。

## 2. 理論：多重散乱とグリーン関数
KKR法は、多重散乱理論に基づく「グリーン関数で解く」バンド計算法である。直感的には、

- 各原子サイトの散乱の強さ（単一サイト散乱：t行列）
- 結晶幾何が作る伝播（構造定数：structure constants）
- それらの総和としての散乱経路（scattering path operator）

を組み合わせ、必要な物性をグリーン関数から取り出す枠組みである。

状態密度の典型式は、グリーン関数 $G(E)$ を用いて

$$
n(E) = -\frac{1}{\pi}\,\mathrm{Im}\,\mathrm{Tr}\,G(E)
$$

で与えられる。SPR-KKRでは、非相対論、スカラー相対論、全相対論（SOC込み）というモード切替で同じ骨格を使い分ける。

## 3. 磁性計算で重要なモードとモデル化
### 3.1 相対論（SOC）と磁性
磁気異方性や軌道磁気モーメント、DMIなどはSOCが鍵である。SPR-KKRでは全相対論モードで、任意スピン配向（ノンコリニア）まで含めた取り扱いが可能である。

### 3.2 無秩序：CPAとDLM
- CPA（Coherent Potential Approximation）は、置換無秩序を有効媒質で表現する近似であり、$A_{1-x}B_x$ のような合金を「組成 $x$ を連続的に振って」評価できる。
- DLM（Disordered Local Moment）は、局所モーメントの向きが熱で乱れた常磁性状態を、統計平均として扱う代表的な枠組みである。有限温度磁性・輸送・異方性への入口として用いられることが多い。

### 3.3 スピン螺旋・ノンコリニア
スピン螺旋は、交換相互作用のフーリエ空間での見通しを得る道具であり、非整合磁性やスピンテクスチャの安定性の議論にもつながる。SPR-KKRはスカラー相対論モードでもスピン螺旋を扱える設計がある。

## 4. 何をどう計算するか（磁性の主要アウトプット）
### 4.1 磁気異方性エネルギー（MAE）
MAEは磁化方向 $\hat{n}$ への全エネルギー依存性であり、基本は

$$
\Delta E_{\mathrm{MAE}} = E(\hat{n}) - E(\hat{n}')
$$

である。厳密には各方向でSCFを回すが、実務では磁気力定理（frozen potentialでのバンドエネルギー差）や、トルク法を使うことが多い。

多重散乱の枠組みに基づくトルク表現の一例は、回転軸 $\hat{u}$ まわりの微小回転に対するトルク成分として

$$
T_{\hat{n}}^{\alpha \hat{u}}
= -\frac{1}{\pi}\,\mathrm{Im}\int^{E_F} dE\,
\frac{\partial}{\partial \alpha_{\hat{u}}}
\left[ \ln \det\, t(\hat{n})^{-1} - G_0 \right]
$$

の形で書ける（実装上はエネルギー積分・収束が支配的である）。

実務メモ：
- MAEは微小差（meV/原子以下）であるため、$k$ 点密度、エネルギー積分メッシュ、$l_{\max}$（角運動量展開の打ち切り）の収束確認が最重要である。
- SOCの弱い系でも、MAEはSOCの二次効果として現れるため、数値誤差と競合しやすい。

### 4.2 交換相互作用 $J_{ij}$（Heisenberg写像）
局所磁化 $\hat{m}_i$ に対し、等方的Heisenberg模型

$$
H = -\sum_{i\neq j} J_{ij}\, \hat{m}_i\cdot \hat{m}_j
$$

へ写像する代表式（LKAG式）は、KKRの散乱量と散乱経路演算子 $\tau_{ij}$ を用いて

$$
J_{ij}
= -\frac{1}{4\pi}\,\mathrm{Im}\int^{E_F} dE\,
\mathrm{Tr}\left[
\left(t^{-1}_{i\uparrow}-t^{-1}_{i\downarrow}\right)\tau^{\uparrow}_{ij}
\left(t^{-1}_{j\uparrow}-t^{-1}_{j\downarrow}\right)\tau^{\downarrow}_{ji}
\right]
$$

のように表される。これにより、第一原理から $J_{ij}$ を取り出し、後段でモンテカルロやスピンダイナミクスへ接続する流れが作れる。

注意点：
- この写像は近似であり、剛体スピン近似（RSA）などの仮定に起因する限界がある。遍歴磁性・強い縦揺らぎが支配的な系では、解釈を慎重にする必要がある。

### 4.3 SOC込みの交換テンソルとDMI
SOCを入れると、交換はスカラー $J_{ij}$ ではなくテンソル $J_{ij}$ へ一般化される。典型的には

$$
H = -\sum_{i\neq j}\hat{m}_i \, \mathbf{J}_{ij}\, \hat{m}_j + \sum_i K_i(\hat{m}_i)
$$

であり、標準分解として

$$
-\sum_{i\neq j} J_{ij}\,\hat{m}_i\cdot \hat{m}_j
-\sum_{i\neq j}\hat{m}_i\,\mathbf{J}^{S}_{ij}\,\hat{m}_j
-\sum_{i\neq j}\mathbf{D}_{ij}\cdot(\hat{m}_i\times \hat{m}_j)
+\sum_i K_i(\hat{m}_i)
$$

のように、等方交換・対称異方性交換・反対称交換（DMI）・単一サイト異方性へ分解できる。
界面系や重元素添加系ではDMIや異方性交換が磁気構造を支配する場合があり、ノンコリニアの有限温度スナップショット解析へ展開できる。

### 4.4 輸送・分光への拡張（磁性とセットで効く）
同じグリーン関数基盤から、残留抵抗や各種分光（光電子、XAS/XMCD等）・応答関数へ広げられる設計がある。磁性評価と観測量（たとえばXMCDスペクトルや輸送）の整合で議論を閉じやすいのが利点である。

## 5. 実務フロー
### 5.1 入力準備
- 結晶構造：格子・サイト・原子種を定義する
- 近似・設定：ASA/フルポテンシャルの選択、交換相関汎関数、$l_{\max}$、エネルギーグリッドなどを決める
- 無秩序：置換サイトと組成をCPAで定義する（必要なら磁気状態はDLMも検討する）

### 5.2 SCF（基底ポテンシャルの確立）
- まずはcollinear・scalar-relativisticで安定に収束させる
- 次にfully relativistic（SOC）やnoncollinearへ拡張する
- 収束判定は全エネルギーだけでなく、モーメント、フェルミ準位近傍のDOS安定性も併用する

### 5.3 物性計算
- MAE：磁化方向を変えた評価（力定理・トルク法を含む）
- 交換相互作用：$J_{ij}$（必要ならテンソル・DMIまで）
- 温度特性：$J_{ij}$ をHeisenberg模型へ写像し、MC等で $M(T)$ や転移温度を推定する
- 合金依存：CPAで $x$ を掃引し、$m(x)$、MAE$(x)$、抵抗$(x)$ などを並列整理する

## 6. 収束と再現性
| 目的 | 収束で効くもの | 失敗しやすい点 |
|---|---|---|
| 磁気モーメント | $k$ 点、混合、$l_{\max}$ | 収束しても準安定解に入っている場合がある |
| MAE | $k$ 点密度、エネルギー積分、SOC設定、力定理の妥当性 | meV以下差分なので数値誤差が支配しやすい |
| $J_{ij}$ | SCFの質、フェルミ準位付近の安定性、エネルギー積分 | 写像の解釈（遍歴性、RSA限界） |
| DMI・異方性交換 | fully relativistic、非対称性（界面モデル） | 超微小量なので計算条件差が結果に出やすい |
| 無秩序合金 | CPA設定、濃度依存の連続性 | 局所環境ゆらぎが重要な場合はCPAの限界を意識する |

## 7. 他手法との比較
- 平面波DFT（VASP等）：大規模セルでの局所歪み・欠陥・原子緩和に強い
- SPR-KKR：無秩序（CPA）・表面/クラスター（GF的）・応答/分光/輸送の統合に強い
- 実務では、平面波で構造最適化 → KKRで合金平均・応答量、という分業も有効である

## まとめ
- SPR-KKRはKKRグリーン関数法に基づき、無秩序合金（CPA）やSOC込みノンコリニア磁性まで含む電子状態計算を実行できる枠組みである。
- MAE（力定理・トルク法）や交換相互作用 $J_{ij}$（テンソル・DMIを含む）を第一原理から取り出し、有限温度磁性や輸送・分光へ接続できる。
- 磁性量は微小差分に敏感であるため、$k$ 点・エネルギー積分・$l_{\max}$ の収束確認と、写像（Heisenberg化）の近似限界を明示した解釈が要点である。
