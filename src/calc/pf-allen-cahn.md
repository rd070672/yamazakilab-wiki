# Allen–Cahn 方程式に基づく金属組織シミュレーション

Allen–Cahn 方程式は「界面をぼかした連続場」で金属組織の時間発展を追う基礎式であり、粒成長・相変態・規則化の駆動力を同じ枠組みで扱えるのが強みである。自由エネルギーの勾配流として書けるため、モデルの拡張（化学自由エネルギー、弾性、結晶方位、異方性など）に一貫性がある。

## 参考ドキュメント
1. S. M. Allen and J. W. Cahn, A microscopic theory for antiphase boundary motion and its application to antiphase domain coarsening, Acta Metallurgica, 27 (1979) 1085–1095.
   https://www.sciencedirect.com/science/article/abs/pii/0001616079901962
2. I. Steinbach, A phase field concept for multiphase systems, Physica D: Nonlinear Phenomena, 94 (1996) 135–147.
   https://www.sciencedirect.com/science/article/abs/pii/0167278995002987
3. 小山敏幸, Phase-field法に関する最近の進展と今後の展望, まてりあ 42 (2003) 397.
   https://www.jstage.jst.go.jp/article/materia1994/42/5/42_5_397/_pdf


## 1. 何を Allen–Cahn で解くのか
Allen–Cahn は「非保存量」の秩序変数（order parameter）φの緩和を記述する。金属組織では、例えば次のような $φ$ を置くのが典型である。

- 相の状態（$α/γ$、固相/液相、析出相/母相など）：$φ=0$ と $φ=1$ を相に対応させる
- 規則・不規則（$B2$、$L1₂$ など）：長距離秩序の強さを φ で表す
- 多結晶粒（粒 $i$ の占有率）：${η_i$} を用い、各点でどの粒に属するかを連続的に表す
- 変形・再結晶の進行度：蓄積ひずみエネルギーを駆動力として $φ$ を進める

保存量（溶質濃度 $c$ など）は Cahn–Hilliard 方程式に担わせ、非保存量（界面の位相、規則度、粒の占有）は Allen–Cahn に担わせる、という役割分担が基本である。

## 2. 自由エネルギーの勾配流としての Allen–Cahn
秩序変数 $φ$ に対する自由エネルギー汎関数を
$$
F[\phi] = \int_\Omega \left( f(\phi, \mathbf{x}; T, c, \ldots) + \frac{\kappa}{2}|\nabla \phi|^2 \right)\, dV
$$
とする。ここで $f$ は局所自由エネルギー密度、$κ$ は勾配エネルギー係数である。

Allen–Cahn 方程式は
$$
\frac{\partial \phi}{\partial t} = -L \frac{\delta F}{\delta \phi}
$$
で与えられ、汎関数微分より
$$
\frac{\delta F}{\delta \phi} = \frac{\partial f}{\partial \phi} - \kappa \nabla^2 \phi
$$
なので
$$
\frac{\partial \phi}{\partial t} = -L\left(\frac{\partial f}{\partial \phi} - \kappa \nabla^2 \phi\right)
$$
となる。$L$ は緩和係数（モビリティに相当）である。

この形の重要点は、適切な境界条件（例：Neumann 境界で $∇φ·n=0$）を置けば
$$
\frac{dF}{dt} = -\int_\Omega \frac{1}{L}\left(\frac{\partial \phi}{\partial t}\right)^2 dV \le 0
$$
が成り立ち、数値解が物理的に「自由エネルギーを下げる方向」に進む構造が明確であることである。

## 3. 金属組織に効く自由エネルギー設計
### 3.1 二相モデル（相変態・析出・規則化）
二つの安定相を持つために、ダブルウェル（例：$φ^2(1−φ)^2$）を用いる。
$$
f(\phi) = W\, \phi^2(1-\phi)^2 + h(\phi)\, \Delta g(\mathbf{x},T,c,\sigma,\ldots)
$$
- $W$：エネルギー障壁（界面の鋭さや界面エネルギーに効く）
- h$(φ)$：相補間関数（例：$h(\phi)=\phi^3(6\phi^2-15\phi+10)$ など）
- $Δg$：相間の自由エネルギー差（化学駆動力、応力場、磁場、蓄積ひずみエネルギーなどを含められる）

このとき、$κ$ と $W$ により拡散界面の厚み $δ$ と界面エネルギー $σ$ が決まる。一般に 1 次元平衡界面では
$$
\sigma = \int_{-\infty}^{\infty}\left(\frac{\kappa}{2}\left(\frac{d\phi}{dx}\right)^2 + f(\phi)\right)dx
= \int_{\phi=0}^{1}\sqrt{2\kappa f(\phi)}\, d\phi
$$
の関係が使える。$δ$ を厚くしすぎると界面物理がぼやけ、薄くしすぎると格子解像度が足りなくなるため、$δ$ と格子幅 $Δx$ の比（例：$δ$ が 5–10 格子点で解像されるか）を設計指標にする。

### 3.2 多結晶の粒成長：多相・多秩序変数（multi-phase-field）
$N$ 個の粒を秩序変数 ${η_i} (i=1..N)$で表し、各点で
$$
\sum_{i=1}^{N}\eta_i=1,\quad 0\le\eta_i\le1
$$
を課すモデルが多い。自由エネルギーの一例は
$$
F[\{\eta_i\}] = \int_\Omega \left(\sum_{i<j}\left[ W_{ij}\eta_i^2\eta_j^2 + \frac{\kappa_{ij}}{2}|\eta_i\nabla\eta_j-\eta_j\nabla\eta_i|^2\right]\right)\, dV
$$
であり、時間発展は制約付きの Allen–Cahn 型になる（ラグランジュ未定乗数 $λ$ を用いて）
$$
\frac{\partial \eta_i}{\partial t}
= -L_i\left(\frac{\delta F}{\delta \eta_i} - \lambda\right)
$$
と書ける。粒界エネルギー σ_ij、粒界モビリティ $M_ij$ を $(W_ij, κ_ij, L_i)$ に対応付けることで、曲率駆動の粒界移動、三重点の力学、粒成長則（平均粒径の時間スケーリング）を再現できる。

蓄積ひずみエネルギー $E_{store}$ を組み込みたい場合、再結晶の「新粒が低エネルギーで広がる」駆動力として
$$
f \leftarrow f + h(\{\eta_i\})\, E_{\mathrm{store}}(\mathbf{x},t)
$$
のように追加し、$E_{store}$ は結晶塑性や実験推定場から与える、というカップリングが考えられる。

### 3.3 結晶方位を場で持つ：orientation-field（KWC 系など）
粒占有 ${η_i}$ を増やさずに、方位角 $θ$（3D では回転表現）を連続場として持たせ、粒界を「$θ$ の急変領域」として表現する枠組みがある。典型的には
- 粒界でのみ $θ$ の勾配エネルギーが効くように、$φ$（または粒界指標場）と結合させる
- 粒界エネルギーの方位差依存（Read–Shockley 型など）を自由エネルギーに反映する

この系では $θ$ に対する式も勾配流になるが、特異拡散（singular diffusivity）を含む形になり得るため、数値実装では安定性と正則化が重要になる。

## 4. Allen–Cahn と金属組織
### 4.1 粒成長（grain growth）
- 駆動力：粒界曲率による界面エネルギー低下
- 実装：多相 ${η_i}$ もしくは 方位場 $θ$
- 出力：平均粒径、粒径分布、三重点角度、粒界エネルギー総量の減少

### 4.2 固相変態・析出（$α/γ$、析出相の成長）
- 駆動力：化学自由エネルギー差 Δg、弾性ミスフィット、界面エネルギー
- 実装：相場 $φ$（Allen–Cahn）＋ 濃度 $c$（Cahn–Hilliard）
- 出力：体積分率、形態（板状・球状）、成長速度、時効硬化などの指標

### 4.3 規則化・逆位相ドメイン（APB coarsening）
- 駆動力：規則度の回復（秩序パラメータ）、逆位相境界の界面エネルギー
- 実装：規則度 $φ$ の Allen–Cahn（場合により複数秩序変数）
- 出力：ドメインサイズ、APB 面積密度、粗大化則

## 5. 数値解法の安定性・収束・スケール
### 5.1 空間離散：FDM / FEM / スペクトル法
- FDM：実装が軽い。規則格子に強い。複雑形状や適応メッシュは苦手になりやすい
- FEM：複雑形状・境界・不均一メッシュ・適応化に強い。大規模計算でのソルバ選択が鍵になる
- スペクトル法：周期境界と整形領域で高精度。FFT と相性が良い

### 5.2 時間積分：エネルギー減少構造を壊さない
Allen–Cahn は反応拡散型であり、非線形項の扱いによって安定性条件が変わる。代表的な考え方は次の通りである。

- 陽解法：単純だが $Δt$ が厳しく小さくなりやすい
- 半陰解法：拡散項を陰的にして安定性を改善する
- 逐次線形化：非線形を Newton などで解く（反復回数とコストが増える）
- エネルギー安定化（convex splitting 等）：自由エネルギーの凸・凹分解で、離散化後も $F$ が単調減少するよう設計する

### 5.3 代表的な設定指針
- 界面幅 δ：少なくとも数格子点で解像（例：5–10 点）
- Δt：まずエネルギー $F(t)$ が非増加となる範囲を探索し、収束試験（$Δx$ と $Δt$）を行う
- 初期条件：ノイズの与え方で核生成挙動が変わるため、目的に応じて統一する
- 境界条件：周期境界は統計量評価に便利、Neumann 境界は孤立系近似に便利

## 6. 解析・可視化で見るべき量
- 自由エネルギー $F(t)$ とその内訳（局所項、勾配項、弾性項など）
- 相分率・秩序度の時間発展（Avrami 型の整理ができる場合がある）
- 粒径分布、粒界長/面積密度、ミスオリエンテーション分布
- 速度場（必要なら）：界面法線速度 $V_n$ を等値面追跡で評価する

## 7. 公開実装・計算基盤の選択肢
Allen–Cahn を含むフェーズフィールドは、自由エネルギーを書くと方程式が決まるという構造が明確なため、汎用フレームワークと相性が良い。

- MOOSE Phase Field：FEM ベースで Allen–Cahn / Cahn–Hilliard を体系化している
- PRISMS-PF：大規模並列を意識したフレームワークとして整備されている
- FiPy：教育・検証・試作に適した PDE 解析環境として例題が豊富である
- NIST の Phase-Field Recommended Practices：検証、数値実装、問題設定の勘所を整理している

自作コードで最初に固めるべきは、(i) エネルギー単調減少の検証、(ii) 収束試験、(iii) 物理量へのキャリブレーション方針（$σ$、$M$、熱力学データ、弾性定数など）である。

## 8. よくある落とし穴
- 界面幅 $δ$ を変えると結果が変わる：薄界面極限・定量モデル・パラメータ再調整が必要である
- 粒数 $N$ が大きい ${η_i}$ モデルはメモリと計算量が増える：方位場モデルや粒のリマッピングなどが検討対象となる
- 方位場（KWC 系）は特異項が数値的に効く：正則化と安定化が不可欠である
- 濃度場と結合すると時間スケールが硬くなる：陰解法や分割法、前処理付き反復法が重要である

## まとめ
Allen–Cahn 型フェーズフィールドは、金属組織の「界面が動いて形が変わる」問題を自由エネルギーに基づいて統一的に記述できる枠組みである。粒成長・相変態・規則化を同じ方程式骨格で扱える一方、界面幅の解像、エネルギー減少構造を保つ離散化、物理量（界面エネルギー・モビリティ）への対応付けが結果を支配するため、検証とキャリブレーションを設計の中心に据えるべきである。

