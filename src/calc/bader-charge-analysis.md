# Bader電荷解析

Bader電荷解析は、第一原理計算で得られる電子密度を「原子ごとの領域（Bader basin）」に分割し、各原子に帰属する電子数や体積を定量化する手法である。結合性・電荷移動・欠陥や界面の局所状態を、空間分解した量として整理できる点が利点である。

## 参考ドキュメント
- Henkelman group: Bader charge analysis code  
  https://theory.cm.utexas.edu/henkelman/code/bader/
- VASP Wiki: CHGCAR
  https://www.vasp.at/wiki/CHGCAR  
- MateriApps Live!（日本語）：Bader Charge Analysis  
  https://ma.issp.u-tokyo.ac.jp/app/bader/

## 1. Bader電荷とは何か
電子密度を $ρ(r)$ とする。Bader（QTAIM: Quantum Theory of Atoms in Molecules）では、各原子Aの領域 $Ω_A$ を「電子密度勾配の流れ（gradient flow）」で定義し、領域境界 $S_A$ はゼロフラックス条件を満たすものとする。

ゼロフラックス条件：
$$
\nabla \rho(\mathbf{r})\cdot \mathbf{n}(\mathbf{r}) = 0 \quad (\mathbf{r}\in S_A)
$$

このとき、原子Aに帰属する電子数 $N_A$ は
$$
N_A=\int_{\Omega_A}\rho(\mathbf{r})\,d^3\mathbf{r}
$$
で与えられる。原子電荷を
$$
q_A = Z_A - N_A
$$
と定義することが多いが、ここでの $Z_A$ を「全電子」か「価電子」かは、入力密度（擬ポテンシャル/PAW、コア密度の扱い）に依存するため、絶対値よりも比較の一貫性が重要である。

## 2. 適用事例
- 吸着・界面：吸着種への電荷移動、界面双極子の指標化
- 置換・ドーピング：元素置換に伴う周辺原子の電荷再分配
- 欠陥：空孔・間隙原子の近傍での局在化／脱局在化の定量
- 磁性系：スピン密度（磁化密度）を同様に領域分割して局所モーメントの補助量として用いる

注意として、Bader電荷は「形式酸化数」を直接返すものではなく、電子密度の連続量に基づく分割結果である。酸化数と対応付ける場合は、系列比較（同一計算設定での差分）として扱うのが安全である。

## 3. グリッド分割
実務では、DFTが出力する実空間グリッド上の $ρ(r)$ を用いて、各グリッド点がどの極大（attractor）へ流れ込むかを追跡してBader領域を構成する。計算結果はグリッド分解能に依存するため、FFTグリッドやカットオフを上げた収束チェックが不可欠である。

## 4. 入力データ：密度
Bader解析は「電子密度」に対して実行するが、どの密度を採用するかで解釈が変わる。

- 擬（valence-only）密度：価電子密度のみ（手軽だが“全電子”ではない）
- 全電子（all-electron相当）密度：コア密度＋再構成価電子密度（PAW再構成を含む密度を足し合わせる流儀）

同じ物理問いに対して、異なる密度を混ぜると比較が崩れるため、研究室内で標準を決めておくとよい。

## 5. ワークフロー
構造最適化（relax）とは別に、最終構造で静的計算（single-point）を行い、解析用の密度ファイルを生成するのが基本である。

### 5.1 価電子密度ベース
- CHGCAR（またはCHG）をBader解析に入力する
- 系列比較の“相対変化”を見る用途で使われることが多い

### 5.2 コアを含めたい場合：PAWの再構成
VASPでは、コア密度と再構成価電子密度を別ファイルとして出力し、それらを加算して参照密度を作る運用が一般的である。

典型例（ファイル名は慣習）：
- AECCAR0：コア電子密度
- AECCAR2：再構成された価電子密度
- CHGCAR：（通常）価電子密度を含む出力

よく用いられる実行例（概念）：
```
chgsum.pl AECCAR0 AECCAR2 # 参照密度（合計密度）の生成
bader CHGCAR -ref CHGCAR_sum # CHGCARをBader領域で積分
```

この「参照密度で領域（basin）を決め、擬（CHGCAR）密度を積分する」流儀は、PAWにおける実用上の折衷として広く用いられる。

## 6. 磁性体での取り扱い
スピン分極計算では、電荷密度 $ρ(r)$ に加えて磁化密度 $m(r)=ρ↑(r)−ρ↓(r)$ を解析したい場面がある。
- CHGCARに電荷密度とスピン密度が併記される場合がある
- その場合、電荷とスピンを別ファイルに分離して可視化・解析する補助ツールが実務上有用である

Bader領域を用いて $m(r)$ を積分すれば、原子ごとの“領域積分された磁化”が得られる（局在の強い系では直感と対応しやすいが、金属では解釈に注意が必要である）。

## 7. チェックリスト
- グリッド収束：FFTグリッドやENCUT（または等価な設定）を上げて $N_A$ が十分収束するか確認する
- 近接原子・短結合：密度の急峻さが増すため、粗いグリッドで誤差が増えやすい
- 真空を含む系（表面・2D）：真空側に“未割当領域”が出ることがあるため、合計電荷（全領域和）と残差の確認を行う
- 比較の一貫性：POTCAR（擬ポテンシャル）や密度再構成の有無を揃える

収束の目安は系に依るが、系列比較では「差分がグリッド変更で符号反転しない」「変化が 0.01 e 程度以下で安定」などを最低条件にする運用が多い。

## 8. 他の電荷分割法との比較
| 手法 | 入力 | 特徴 | 注意点 |
|---|---|---|---|
| Bader（QTAIM） | 実空間の$ρ(r)$ | “ゼロフラックス面”で原子領域を定義 | グリッド依存、密度の選び方で解釈が変わる |
| Mulliken/Löwdin | 軌道基底 | 分子軌道計算で古典的 | 基底依存が大きい |
| Hirshfeld | 参照原子密度 | “stockholder”分割で安定しやすい | 参照密度の選択が効く |
| DDEC系 | 参照密度＋制約 | 固体系の電荷移動・電荷モデルに強い | 実装・前提が手法ごとに異なる |
| Voronoi | 幾何 | 速い（密度不要の場合も） | 波動関数由来の情報が入らない |

研究の目的が「電荷移動モデル（力場や部分電荷）」なのか、「電子状態の空間分解（密度に基づく議論）」なのかで、Baderを含む選択が変わる。

## まとめ
- Bader電荷解析は、電子密度 $ρ(r)$ をゼロフラックス面で分割し、原子ごとの電子数・体積を得る手法である。
- 実用上は、密度の種類（価電子のみか、コアを含むか）とグリッド収束が結果の信頼性を支配する。
- 絶対値の議論よりも、同一条件での系列比較として用いると解釈が安定し、欠陥・界面・置換の局所変化を定量化しやすい。
