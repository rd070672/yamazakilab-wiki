# ファインマンダイアグラム入門
ファインマンダイアグラムは、多体系における相互作用の効果を、グリーン関数の摂動展開として系統的に整理し、計算可能な形へ落とし込むための表記法である。線一本・頂点一つが演算子の積分と縮約を代表し、自己エネルギー、遮蔽、励起の寿命、応答関数を統一的に扱う道具立てを与える。

## 参考ドキュメント
- R. P. Feynman, Space-Time Approach to Quantum Electrodynamics, Physical Review 76, 769 (1949)
  https://link.aps.org/doi/10.1103/PhysRev.76.769
- G. C. Wick, The Evaluation of the Collision Matrix, Physical Review 80, 268 (1950)
  https://link.aps.org/doi/10.1103/PhysRev.80.268
- 北大・木田研究室（講義ノート）, 量子輸送方程式と非平衡エントロピー1（付録に松原グリーン関数と図式展開を含む, 日本語PDF）
  https://phys.sci.hokudai.ac.jp/~kita/QTEver3.pdf

## 位置づけと到達目標
量子多体系では、観測量は相関関数（時間順序化された演算子の期待値）として定義される。ファインマンダイアグラムは、その相関関数を
1) 相互作用の次数で展開し、
2) Wick の定理で縮約へ分解し、
3) ルール（線・頂点・ループ）で積分式に写像し、
4) Dyson 方程式などの再和で物理量に還元する、
という流れを一貫して実行する記法である。

本稿の到達目標は、(i) ダイアグラムがどの数式から出てくるか、(ii) 基本のルール（符号・因子・保存則）が何を意味するか、(iii) 自己エネルギーと応答関数へどう接続するか、を一通り自力で展開できる状態を作ることである。


## 1. 相関関数とグリーン関数
### 1.1 時間順序化と1粒子グリーン関数
フェルミオン場演算子を $\psi(\mathbf{r},t)$ とし、基底状態または熱平衡平均を $\langle \cdots \rangle$ と書く。実時間の時間順序化 $T$ を用いて
$$
G(1,2)=-i\langle T\,\psi(1)\psi^{\dagger}(2)\rangle
$$
を定義する。ここで $1\equiv(\mathbf{r}_1,t_1)$ などの略記を用いる。符号と $-i$ は、スペクトル表現・線形応答との整合を取る標準的規約である。

材料・固体で重要なのは、この $G$ から
- スペクトル関数 $A(\mathbf{k},\omega)$（ARPES など）
- 準粒子のエネルギーと寿命（自己エネルギーの実部・虚部）
- 密度 $n(\mathbf{r})$ や占有数
- 応答関数（密度応答・スピン応答）
が直接または間接的に得られることである。

### 1.2 松原グリーン関数
松原グリーン関数は温度グリーン関数とも呼ばれる。熱平衡（温度 $T$、$\beta=1/k_B T$）では虚時間 $\tau\in[0,\beta)$ を導入し、虚時間順序化 $T_{\tau}$ により
$$
G(\mathbf{r}_1\tau_1,\mathbf{r}_2\tau_2)
=
-\langle T_{\tau}\,\psi(\mathbf{r}_1,\tau_1)\psi^{\dagger}(\mathbf{r}_2,\tau_2)\rangle
$$
と定義する。フェルミオンでは反周期性 $G(\tau+\beta)=-G(\tau)$ を持ち、Fourier 変換は Matsubara 周波数
$$
\omega_n=(2n+1)\pi/\beta
$$
を用いる。ボソン場には $\nu_m=2m\pi/\beta$ が対応する。

虚時間形式は、熱力学ポテンシャル、平衡相関、RPA や GW の導出に都合がよい。実験との比較には実周波数へ解析接続する段階が現れる。


## 2. 相互作用表示と Dyson 展開
### 2.1 ハミルトニアンの分割
多体系の基本形として
$$
H = H_0 + H_{\mathrm{int}}
$$
と分け、$H_0$ を可解（自由粒子、バンド、独立フォノンなど）、$H_{\mathrm{int}}$ を相互作用（クーロン、電子–フォノン、交換相互作用の効果的表現など）とする。

相互作用表示では演算子は $H_0$ で時間発展し、相互作用は時間発展演算子（S 行列）へ押し込められる。実時間では
$$
U(t,t_0)=T\exp\left[-i\int_{t_0}^{t}dt'\,H_{\mathrm{int}}(t')\right]
$$
である。

### 2.2 相関関数の摂動展開
例えば時間順序化相関は
$$
\langle T\,\mathcal{O}\rangle
=
\frac{\langle T\,\mathcal{O}\, \exp\left[-i\int dt\,H_{\mathrm{int}}(t)\right]\rangle_0}
{\langle T\,\exp\left[-i\int dt\,H_{\mathrm{int}}(t)\right]\rangle_0}
$$
の形に書ける。$\langle \cdots\rangle_0$ は $H_0$ による平均である。

指数を展開すると、$H_{\mathrm{int}}$ の次数ごとに多重積分を伴う演算子積が現れ、これを Wick の定理で縮約に分解することで、線（収縮）と頂点（相互作用）からなる図形へ写像される。

分母は連結でない寄与（真空泡）を打ち消す働きを持ち、結果として連結ダイアグラムのみが残る。この構造が、自由エネルギーや有効作用の図式展開へ直結する。


## 3. Wick の定理と収縮
### 3.1 収縮の定義
フェルミオンに対し、自由理論での時間順序化積は
$$
T\,\psi(1)\psi^{\dagger}(2)
=
:\psi(1)\psi^{\dagger}(2):
+
\overline{}{\psi}{(1)}{\psi^{\dagger}}
\psi(1)\psi^{\dagger}(2)
$$
のように正規順序項と収縮（contraction）へ分解される。収縮は自由グリーン関数に等しく
$$
\overline{}{\psi}{(1)}{\psi^{\dagger}}
\psi(1)\psi^{\dagger}(2)
=
\langle T\,\psi(1)\psi^{\dagger}(2)\rangle_0
=
iG_0(1,2)
$$
である（規約に応じて $i$ の置き方は変わるが、線が自由伝播を表すという点が本質である）。

Wick の定理は、多数の演算子の時間順序化積を、全ての可能な収縮の和として表す定理である。これにより、次数 $n$ の項は「どの演算子同士を結ぶか」の組合せへ還元され、図形（ダイアグラム）で整理できる。

### 3.2 フェルミオン符号とループ
フェルミオンでは演算子交換で符号が出るため、ダイアグラムには
- フェルミオン閉ループごとに $(-1)$
- 交換に対応する追加の符号
が現れる。ボソン線にはそのような符号は現れない。

符号規則は慣れが必要だが、基本として「反交換関係があるものを入れ替えれば符号が反転する」という原理に立脚している。図としては、閉ループが生む $(-1)$ が最初の目印になる。


## 4. ダイアグラムの辞書
ここでは凝縮系で頻出の二つを例に、ルールを明確化する。

### 4.1 クーロン相互作用を持つ電子系
相互作用を
$$
H_{\mathrm{int}}=\frac{1}{2}\int d\mathbf{r}d\mathbf{r}'\,\psi^{\dagger}(\mathbf{r})\psi^{\dagger}(\mathbf{r}')\,v(\mathbf{r}-\mathbf{r}')\,\psi(\mathbf{r}')\psi(\mathbf{r})
$$
とする（$v$ はクーロンまたは遮蔽クーロン）。

Matsubara で運動量・周波数表示に移れば、基本対応は次の通りである。
- 電子線：$G_0(\mathbf{k},i\omega_n)=1/(i\omega_n-\xi_{\mathbf{k}})$
- 相互作用線：$v(\mathbf{q})$（クーロンなら $4\pi e^2/q^2$ など）
- 頂点：運動量・周波数保存（入出力で同じ $\mathbf{q},\nu$ が流れる）

内部線の運動量・周波数は全て和積分
$$
\frac{1}{\beta}\sum_{\omega_n}\int\frac{d^d k}{(2\pi)^d}
$$
で足し上げる。格子では $\int d^d k$ の代わりにブリルアンゾーン和に置き換わる。

### 4.2 電子–フォノン相互作用
電子–フォノンを
$$
H_{e\text{-}ph}=\sum_{\mathbf{k},\mathbf{q}} g_{\mathbf{q}}\,c^{\dagger}_{\mathbf{k}+\mathbf{q}}c_{\mathbf{k}}(a_{\mathbf{q}}+a^{\dagger}_{-\mathbf{q}})
$$
とする。ここで $c$ は電子、$a$ はフォノン、$g_{\mathbf{q}}$ は結合定数である。

このとき
- 電子線：$G_0(\mathbf{k},i\omega_n)$
- フォノン線：$D_0(\mathbf{q},i\nu_m)=2\omega_{\mathbf{q}}/[(i\nu_m)^2-\omega_{\mathbf{q}}^2]$ など（規約に依る）
- 頂点：$g_{\mathbf{q}}$ と保存則
が基本となる。

電子の自己エネルギーは最初の非自明次数（フォノン1本の挿入）から現れ、準粒子寿命や質量増大に結びつく。フォノン側の自己エネルギーは電子泡（バブル）で与えられ、Kohn 異常や線幅（減衰）に繋がる。


## 5. 連結性と1粒子既約性
### 5.1 自己エネルギーと Dyson 方程式
相互作用込みの1粒子グリーン関数 $G$ は、自己エネルギー $\Sigma$ を用いて
$$
G^{-1}(\mathbf{k},i\omega_n)=G_0^{-1}(\mathbf{k},i\omega_n)-\Sigma(\mathbf{k},i\omega_n)
$$
と書ける。これは Dyson 方程式である。

ここで重要なのは、$\Sigma$ は
1粒子線を一本切るだけでは二つに分解できない（1粒子既約, 1PI）ダイアグラムの総和として定義される点である。1PI を集めることで、$G$ の摂動級数を幾何級数的に再和でき、上式の形が成立する。

### 5.2 準粒子と寿命
実周波数に解析接続して
$$
\Sigma(\mathbf{k},\omega+i0^+)=\Sigma'(\mathbf{k},\omega)+i\Sigma''(\mathbf{k},\omega)
$$
と書けば、
- $\Sigma'$ は分散の再正規化（有効質量、バンドの押し下げ・押し上げ）
- $\Sigma''$ は減衰（寿命 $\tau^{-1}\sim -2\Sigma''$）
を与える。ARPES の線幅、光学伝導の散乱率、熱輸送の緩和時間などは、どれもこの構造と密接である。


## 6. 応答関数のダイアグラム
### 6.1 密度応答と分極関数
外場に対する線形応答はKubo 公式で相関関数として表される。密度演算子 $\rho_{\mathbf{q}}$ に対する感受率は
$$
\chi(\mathbf{q},i\nu_m)=\int_{0}^{\beta}d\tau\,e^{i\nu_m\tau}\langle T_{\tau}\rho_{\mathbf{q}}(\tau)\rho_{-\mathbf{q}}(0)\rangle
$$
である。自由系の最初の寄与は電子バブル（泡）で
$$
\chi_0(\mathbf{q},i\nu_m)=-\frac{1}{\beta}\sum_{\omega_n}\int\frac{d^d k}{(2\pi)^d}\,
G_0(\mathbf{k},i\omega_n)\,G_0(\mathbf{k}+\mathbf{q},i\omega_n+i\nu_m)
$$
となる（符号は規約で変わり得るが、泡が $GG$ の畳み込みである点が核である）。

### 6.2 環状図の再和と遮蔽
クーロン相互作用による基本の再和として 環状図の再和（RPA）がある。バブルを鎖状に繋いだ環状図を再和すると
$$
\chi_{\mathrm{RPA}}(\mathbf{q},i\nu_m)=\frac{\chi_0(\mathbf{q},i\nu_m)}{1-v(\mathbf{q})\chi_0(\mathbf{q},i\nu_m)}
$$
が得られる。これにより遮蔽ポテンシャル
$$
W(\mathbf{q},i\nu_m)=\frac{v(\mathbf{q})}{1-v(\mathbf{q})\chi_0(\mathbf{q},i\nu_m)}
$$
が導入され、プラズモンや誘電関数の議論が可能になる。

### 6.3 梯子図と二体散乱・超伝導
粒子–粒子または粒子–正孔チャネルで相互作用を繰り返すと梯子図が現れる。これは
- 有効相互作用の増強
- 近藤効果やスピン揺らぎ
- クーパー対形成（BCS, Eliashberg）
などと深く関係する。

二粒子頂点 $\Gamma$ に対して Bethe–Salpeter 型の方程式が立ち、励起子（電子–正孔束縛）や光学応答（BSE）ともつながる。


## 7. 代表的ダイアグラム
凝縮系で頻出の図式を、意味とともに整理する。

| 図式 | 現れる量 | 数式上の役割 | 物理的内容 |
|---|---|---|---|
| Hartree | $\Sigma$ | 密度平均場 | 静的なポテンシャルシフト、電荷再配分 |
| Fock（交換） | $\Sigma$ | 非局所交換 | 交換相互作用、バンドの歪み |
| バブル（泡） | $\chi,\Pi$ | 分極・応答 | 遮蔽、プラズモン、誘電関数 |
| リング（環） | 自由エネルギー | RPA 再和 | 長距離相互作用の主要寄与 |
| 梯子 | 頂点 $\Gamma$ | 散乱の再和 | 束縛状態、協力現象（対形成） |
| 頂点補正 | $\Sigma,\chi$ | Ward 恒等式と整合 | 保存則（電荷保存）を満たす修正 |
| 自己無撞着骨格図 | $\Sigma$ 決定 | $G$ を太線にする | 緩和・散乱を自己整合で取り込む |

ここで $\Pi$ は分極（英語圏で polarization function）を表し、記号の細部は文献に依存するが、構造は共通である。


## 8. Matsubara 和：虚時間から実周波数へ
### 8.1 Matsubara 和の一般形
内部周波数の和
$$
\frac{1}{\beta}\sum_{\omega_n} f(i\omega_n)
$$
は、複素解析（留数定理）により実軸積分と分布関数で評価できる。基本形として
$$
\frac{1}{\beta}\sum_{\omega_n} f(i\omega_n)
=
-\oint_{\mathcal{C}}\frac{dz}{2\pi i}\,n_F(z)\,f(z)
$$
（フェルミオンの場合）などが用いられる。ここで $n_F(z)=1/(e^{\beta z}+1)$ である。

この段階で、熱励起・占有数が自然に入り、有限温度の応答や散乱率の温度依存が導かれる。

### 8.2 解析接続とスペクトル表現
Matsubara 表式で得た $\chi(\mathbf{q},i\nu_m)$ や $\Sigma(\mathbf{k},i\omega_n)$ を実周波数へ移すには解析接続 $i\nu_m\to\omega+i0^+$ を行う。スペクトル表現は
$$
G(\mathbf{k},i\omega_n)=\int_{-\infty}^{\infty}\frac{d\omega}{2\pi}\frac{A(\mathbf{k},\omega)}{i\omega_n-\omega}
$$
の形を与え、$A$ の正値性や和則が数値の健全性を支える。

材料計算では、この解析接続が不安定になり得るため、最大エントロピー法や Padé 近似などの手法が使われることがある。ただし、どの量を接続するか（自己エネルギーかグリーン関数か）で数値特性が変わる点は意識しておくべきである。


## 9. 近似スキーム
ファインマンダイアグラムは無限個存在するため、何らかの再和や打ち切りが必要になる。凝縮系でよく使われる考え方を、図式と対応させる。

### 9.1 GW 近似
遮蔽相互作用 $W$ を用いて
$$
\Sigma \approx iGW
$$
とする近似である。$W$ は多くの場合 RPA で得る。準粒子エネルギー、バンドギャップ、衛星構造などの記述に広く用いられる。

### 9.2 電子–フォノン系（Migdal–Eliashberg）
電子–フォノン系では、Migdal の議論により頂点補正が小さい領域があり、その場合
- 電子自己エネルギー：電子線とフォノン線の基本図を自己無撞着に再和
- 超伝導：異常グリーン関数を導入した Eliashberg 方程式
へ進む。ここで、フォノン媒介の有効相互作用が対形成へ繋がる。

### 9.3 スピン揺らぎと RPA/FLEX
スピン・電荷の揺らぎをバブル・梯子の再和として構成し、自己エネルギーに反映させる枠組みがある。Fe 系超伝導や強相関金属の議論で頻出であり、揺らぎのチャネル分解がダイアグラムとして見える利点がある。

### 9.4 DMFT と図式
DMFT は局所自己エネルギーを非摂動的に求め、格子の自己無撞着条件で閉じる。図式的には、局所骨格図の無限再和を行っているとみなせる。DFT+DMFT は、バンド構造（現実材料）と強相関（局所動力学）を接続する代表的枠組みである。


## 10. 材料・固体系への具体例
### 10.1 電子–フォノンと Kohn 異常
フォノン自己エネルギーは電子バブルで与えられ、
$$
D^{-1}(\mathbf{q},\omega)=D_0^{-1}(\mathbf{q},\omega)-\Pi_{ph}(\mathbf{q},\omega)
$$
の形になる。$\Pi_{ph}$ は電子の状態密度やフェルミ面のネスティングに敏感であり、分散の折れ曲がり（Kohn 異常）や線幅増大（減衰）として観測される。

### 10.2 交換・遮蔽と磁性
遍歴電子磁性では、スピン感受率 $\chi_s$ が Stoner 条件やスピン揺らぎの議論に直結する。RPA の形は
$$
\chi_s=\frac{\chi_0}{1-U\chi_0}
$$
（$U$ を有効オンサイト相互作用とした簡約形）を与え、磁気不安定性の判定に使われる。さらに二粒子頂点を改良すると、臨界揺らぎや非フェルミ液体的振る舞いに踏み込める。

### 10.3 不純物散乱と輸送
不純物ポテンシャルを摂動として扱うと、自己エネルギーに散乱率が入り、伝導度はバブル図に頂点補正を加えた形で表される。頂点補正は保存則（電荷保存）と関係し、適切に採ると Ward 恒等式と整合する。

### 10.4 光学応答と励起子
独立粒子の光学吸収は粒子–正孔バブル（独立応答）で与えられるが、電子–正孔相互作用（梯子図）を入れると励起子が現れる。第一原理分野では BSE によりこの構造が実装され、吸収端やピーク構造の理解に用いられる。


## 11. 注意点
ダイアグラム計算で頻出の不整合は、物理の誤りというより規約の混在で起きることが多い。以下は混同しやすい点の整理である。

- 実時間 $G(t)$ と虚時間 $G(\tau)$ の符号・$i$ 因子は、定義の違いがそのまま残る。文献間で規約が異なるため、最初に定義式へ立ち戻る必要がある。
- ボソン線の規約（$D$ に $-i$ を含めるか、含めないか）は文献で揺れる。頂点因子と合わせて最終式が一致するように統一する。
- 内部周波数和は、分布関数と留数で処理するか、スペクトル表現に落として実軸積分へ変換するかで見え方が変わる。どちらも同値であるが、途中式の形は異なる。
- $\Sigma$ を $G_0$ で計算するか、$G$ を太線にして自己無撞着にするかで、保存則や和則の満たし方が変わる。どの性質（例えば粒子数保存、エネルギー保存）を重視するかで選択が変わる。
- 解析接続は、数値としては不安定になり得る。実軸で直接方程式を解く枠組み（Keldysh 形式など）へ移る選択肢もある。


## 12. まとめ
ファインマンダイアグラムは、相互作用表示の Dyson 展開と Wick の定理により、多体相関関数を「線と頂点の積分規則」へ写像するための表記法である。自己エネルギーと Dyson 方程式により準粒子像と寿命が定義され、バブル・梯子・リングの再和により遮蔽、揺らぎ、対形成、励起子などの凝縮系の主要現象が統一的に理解できる。材料物性の議論では、どのクラスの図を採用するかが近似の内容そのものであり、規約の整合と保存則の満足が計算結果の物理的信頼性を決める要点である。


## 関連研究
- 京都大学基礎物理学研究所 物性研究会, 多体効果の最前線（DFT+DMFT と DFT+RPA などの位置づけ, 日本語PDF）
  https://mercury.yukawa.kyoto-u.ac.jp/~bussei.kenkyu/pdf/06/1/0096-061205.pdf
- 國見昌哉（東京大学）, A. L. Fetter and J. D. Walecka 計算ノート（多体理論と図式計算の実際, 日本語PDF）
  https://www2.yukawa.kyoto-u.ac.jp/~masaya.kunimi/Fetter_note_110915.pdf
- G. D. Mahan, Many-Particle Physics（図式展開、松原形式、応答関数）
  https://web.phy.ntnu.edu.tw/~hongyi/notes/Books/Mahan_Many-Particle%20Physics_2000_GF.pdf
- APS Physical Review Archive（Feynman 1949 論文の掲載情報）
  https://journals.aps.org/pr/issues/76/6
- 電気通信大学 学位論文資料（2粒子グリーン関数の摂動展開・図式の例, 日本語PDF）
  https://uec.repo.nii.ac.jp/record/834/files/9000000841.pdf
