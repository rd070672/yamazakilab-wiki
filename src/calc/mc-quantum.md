# 量子モンテカルロ（QMC）法

量子モンテカルロ（Quantum Monte Carlo; QMC）計算は、多体量子系の期待値を確率サンプリングで評価し、相関効果を一次近似に押し込めずに扱うための数値手法群である。電子構造から模型ハミルトニアンまで同じ発想で接続でき、手法ごとの近似（符号問題の回避策）を理解したうえで使い分けることが要点である。

## 参考ドキュメント
- W. M. C. Foulkes et al., Quantum Monte Carlo simulations of solids, Rev. Mod. Phys. 73, 33 (2001)
  https://link.aps.org/doi/10.1103/RevModPhys.73.33
- QMCPACK Manual（Introduction）
  https://qmcpack.readthedocs.io/en/develop/introduction.html
- （日本語）第一原理量子モンテカルロ法の現状と物質科学分野での応用（セラミックス 59 (2024) No.11）
  https://member.ceramic.or.jp/journal/content/pdf_free_access/59_11_771.pdf

## 1. QMC：期待値を「確率分布の平均」に落とす
観測量 $\hat{O}$ の基底状態期待値は
$$
\langle \hat{O}\rangle=\frac{\langle \Psi|\hat{O}|\Psi\rangle}{\langle \Psi|\Psi\rangle}
$$
である。QMCは、ある確率分布 $P(\mathbf{X})$（配置、補助場、経路など）を定め、
$$
\langle \hat{O}\rangle = \int d\mathbf{X}\, P(\mathbf{X})\, O_\mathrm{loc}(\mathbf{X})
$$
の形に変形し、サンプル平均で評価する枠組みである。ここで $O_\mathrm{loc}$ は局所エネルギーやグリーン関数など、手法に応じた評価量である。

統計誤差は概ね
$$
\mathrm{SE}\sim \frac{\sigma}{\sqrt{N_\mathrm{eff}}}
$$
で減るが、自己相関により有効サンプル数 $N_\mathrm{eff}$ は総サンプル数より小さくなり得るため、ビニングや自己相関時間の見積もりが必要である。

## 2. QMCの大別：波動関数型と経路積分（有限温度）型
QMCは大きく二系統に分かれる。

1) 波動関数（実空間）型 QMC  
連続空間の電子を座標 $\mathbf{R}=(\mathbf{r}_1,\dots,\mathbf{r}_N)$ で扱い、試行波動関数 $\Psi_T(\mathbf{R})$ を用いる。

代表例は 
- 変分モンテカルロ法（VMC）
- 拡散モンテカルロ法（DMC）
である。

2) 経路積分・補助場型 QMC  
有限温度の分配関数
$$
Z=\mathrm{Tr}\,e^{-\beta \hat{H}}
$$
や虚時間グリーン関数 $G(\tau)$ を、虚時間離散化や補助場変換（Hubbard–Stratonovich変換）で確率測度に落としてサンプルする。格子模型（Hubbard模型など）、DMFT不純物ソルバー（CTQMC）などで重要である。

代表例は 
- 補助場量子モンテカルロ法（AFQMC）
- 決定論的量子モンテカルロ法（DQMC）
- 連続時間量子モンテカルロ法（CTQMC）
である。

## 3. 主要手法の整理
| 系統 | 手法 | 典型対象 | 何をサンプルするか | 代表的な近似・難所 |
|---|---|---|---|---|
| 波動関数型 | VMC | 連続電子系、固体・欠陥・表面 | $|\Psi_T(\mathbf{R})|^2$ に従う電子配置 | 試行波動関数の表現力と最適化 |
| 波動関数型 | DMC | 高精度エネルギー、相安定、ギャップ | 虚時間発展のランダムウォーク（ウォーカー集団） | 固定節（fixed-node）/固定位相近似、時間刻み誤差、集団制御バイアス |
| 補助場型 | AFQMC | 連続系（軌道基底）、格子・実材料の相関電子 | 補助場により相互作用を二体項へ分解しサンプル | 符号問題、制約（constrained path / phaseless） |
| 格子・有限温度 | DQMC / SSE / ワールドライン | Hubbard, Heisenberg 等 | 補助場・スピン経路 | 符号問題、有限サイズ、虚時間離散化（DQMC） |
| 不純物ソルバー | CTQMC | DMFT/クラスターDMFT | 相互作用または混成のダイアグラム展開 | 解析接続、低温でのサイン問題や計算量 |

## 4. 変分モンテカルロ法（VMC）：試行波動関数を直接最適化して期待値を測る
VMCは変分原理
$$
E_\mathrm{VMC}=\frac{\langle \Psi_T|\hat{H}|\Psi_T\rangle}{\langle \Psi_T|\Psi_T\rangle}\ge E_0
$$
に基づく。$\Psi_T$ としては Slater–Jastrow 形が代表的である。
$$
\Psi_T(\mathbf{R})=\left[\det(\phi_i^\uparrow)\det(\phi_j^\downarrow)\right]\exp(J(\mathbf{R}))
$$
ここで $J$ は電子間・電子核間の相関（ジャストロー）を担う。VMCでは、エネルギー最小化や分散最小化により $J$ や多行列式係数、バックフロー変換などを最適化する。

VMCは単独でも相関の強い指標（スピン相関、電荷分布、構造依存トレンド）を与え、DMC/AFQMCの試行状態としての役割も持つ。

## 5. 拡散モンテカルロ法：虚時間射影で基底状態へ近づける（固定節近似が鍵）
DMCは虚時間シュレーディンガー方程式
$$
-\frac{\partial \Psi(\mathbf{R},\tau)}{\partial \tau}=(\hat{H}-E_T)\Psi(\mathbf{R},\tau)
$$
により、任意の初期状態から基底状態への射影
$$
\Psi(\tau)=e^{-\tau(\hat{H}-E_T)}\Psi(0)
$$
を確率過程として実現する。フェルミオンでは厳密サンプリングが符号問題に直結するため、一般に固定節（fixed-node）あるいは固定位相（fixed-phase）近似で回避する。結果の系統誤差は試行波動関数の節構造（位相構造）に依存する点が重要である。

実装上の代表的誤差源は以下である。
- 時間刻み（time-step）誤差：$\Delta\tau \to 0$ 外挿が必要である
- ウォーカー集団（population control）由来のバイアス：集団サイズ依存性の確認が必要である
- 有限サイズ誤差：超胞、ねじれ平均（twist averaging）、長距離補正などが効く

## 6. 補助場量子モンテカルロ法：補助場で相互作用を分解し、スレーター行列式空間で歩く
AFQMCは、二体相互作用を補助場 $\mathbf{x}$ で線形化し、
$$
e^{-\Delta\tau \hat{H}} \approx \int d\mathbf{x}\, p(\mathbf{x})\, \hat{B}(\mathbf{x})
$$
の形で一体発展演算子 $\hat{B}(\mathbf{x})$ の積へ落とす。ウォーカーはスレーター行列式（軌道係数）として表され、系のサイズに応じて多項式スケールで基底状態（あるいは有限温度）物性へ到達する。

フェルミオン符号問題のため、実材料では多くの場合、試行状態を用いた制約（constrained path や phaseless 近似）で安定化する。このときも系統誤差は試行状態の品質に依存し、試行状態としてDFT軌道、ハートリー・フォック、多行列式、テンソルネットワーク由来の状態などが使われる。

## 7. 経路積分QMCと格子模型：有限温度と相関の定量化
格子模型（例：Hubbard模型）
$$
\hat{H}=-t\sum_{\langle ij\rangle,\sigma}(c_{i\sigma}^\dagger c_{j\sigma}+h.c.)+U\sum_i n_{i\uparrow}n_{i\downarrow}
$$
では、有限温度の分配関数 $Z=\mathrm{Tr}\,e^{-\beta\hat{H}}$ を虚時間に分割し、相互作用項を補助場により二次形式へ変換してサンプルする（DQMC/AFQMC）か、世界線や級数展開でサンプルする（SSE、連続時間法など）。

DMFTと組み合わせる場合、連続時間QMC（CTQMC）は不純物・クラスターの有力ソルバーであり、虚時間グリーン関数 $G(\tau)$ を高精度に与える。ただし、実周波数スペクトル $A(\omega)$ を得るには解析接続が必要であり、最大エントロピー法やスパースモデリング等の不適切性（不適切な逆問題）に注意が要る。

## 8. 符号問題（sign problem）とその回避が「誤差の性格」を決める
フェルミオン系QMCの中心的困難は符号問題である。重みが正負（あるいは複素位相）を取り、分散が指数的に悪化するためである。

回避策は「どの誤差を許容するか」の選択になる。
- DMC：固定節（固定位相）により符号問題を回避するが、節由来の系統誤差が残る
- AFQMC：制約（phaseless/constrained path）で安定化するが、制約に依存する系統誤差が残る
- 格子QMC：特定の対称性条件（半充填・二部格子等）では符号問題が消えることがあり、その領域では厳密性が高い

ここから、どの手法が有効かは対象（連続系か格子か、有限温度か基底状態か）と対称性に強く依存する。

## 9. 典型的なアウトプットと読み方
QMCが得意とする量は次の通りである。
- エネルギー差：相安定（多形、磁気状態）、欠陥形成、吸着、反応経路の相対比較
- 相関関数：スピン相関、電荷相関、構造因子 $S(\mathbf{q})$
- 励起（間接量）：全エネルギー差からの準粒子ギャップ、有限温度からの応答（解析接続を要する）

注意点として、QMCは統計誤差を必ず持つため、差の議論では誤差伝播を明示する必要がある。加えて、近似（固定節・制約・擬ポテンシャル・有限サイズ）由来の系統誤差を別枠で評価する必要がある。

## 10. 電子構造QMCの標準ワークフロー（連続系）
1) 参照計算（DFT等）で軌道を用意する（超胞、k点、擬ポテンシャル整合を取る）
2) 試行波動関数 $\Psi_T$ を構築する（単一/多行列式 + Jastrow など）
3) VMCでパラメータ最適化と分散評価を行う
4) DMC（またはAFQMC）で基底状態のエネルギー・差分量を評価する
5) 系統誤差チェック（時間刻み外挿、ウォーカー数、有限サイズ補正・ねじれ平均、擬ポテンシャル検証）を行う

この手順では、試行状態の改善がそのまま系統誤差の低減に直結する。

## 11. 代表的ソフトウェアと国内で参照しやすい情報源
電子構造QMC（VMC/DMC/AFQMC）：
- QMCPACK：周期系・分子に対するVMC/DMCに加え、AFQMCも含む統合コードである
- CASINO、TurboRVB など：波動関数型QMCを中心とする系である
- ipie：phaseless AFQMC を中心とする実装である

格子模型・有限温度：
- ALF：格子フェルミオン系の補助場QMC（有限温度・射影）を扱う
- DQMC系実装：研究コードやパッケージが複数存在する（モデルと測定量の定義が重要である）

## まとめ
量子モンテカルロ計算は、多体量子系の期待値を確率過程として評価し、相関効果を高精度に取り込む手法群である。波動関数型（VMC/DMC）と補助場・経路積分型（AFQMC、DQMC、CTQMC）を対象と目的で見分け、符号問題の回避策がもたらす系統誤差と統計誤差を分離して評価することが、信頼できる結論へつながる。

