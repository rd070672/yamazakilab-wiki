# 量子モンテカルロ法（Quantum Monte Carlo; QMC）/ 変分モンテカルロ（VMC）/ 拡散モンテカルロ（DMC）

量子モンテカルロ法（QMC）は、多体シュレーディンガー方程式に基づく期待値を確率過程として評価し、物質の基底状態エネルギーや相対安定性を高精度に与える第一原理計算群である。材料科学では、DFTの交換相関汎関数依存性が支配的になりやすい系（強相関、欠陥、界面、吸着、相境界など）に対して、より信頼できる参照計算（benchmark）として重要である。

## 参考ドキュメント（3つ。日本語を含む）
- W. M. C. Foulkes, L. Mitas, R. J. Needs, G. Rajagopal, Quantum Monte Carlo simulations of solids, Rev. Mod. Phys. 73, 33 (2001)
  https://link.aps.org/doi/10.1103/RevModPhys.73.33
- QMCPACK Manual / Documentation（VMC, DMC, twist averaging等の実務情報）
  https://qmcpack.readthedocs.io/
- 前園 涼 ほか, 動かして理解する 第一原理量子モンテカルロ計算（森北出版、日本語）
  https://www.morikita.co.jp/books/book/4357

## 1. 位置づけ
- 対象
  - 連続空間の電子多体系（ab initio QMC; real-space QMC）
  - 主に基底状態（0 K）の全エネルギーとその差分（相安定性、形成エネルギー、反応エネルギー）
- DFTとの関係
  - DFT：計算コストが低く大規模・探索に強いが、汎関数依存が残る
  - QMC：計算コストが高いが、波動関数ベースで相対的に高精度な参照値を与える
- 典型的な使い分け
  - 探索：DFT（ハイスループット、構造最適化、スクリーニング）
  - 検証：QMC（有望候補の上位数十～数百点を高精度化、DFT誤差の見積り）

## 2. 基本数式：期待値を「サンプリング」で評価する
電子座標をまとめて $R=(\mathbf{r}_1,\dots,\mathbf{r}_N)$ とし、試行波動関数を $\Psi_T(R)$ とする。

- エネルギーの期待値
$$
E[\Psi_T]=\frac{\langle \Psi_T | \hat{H} | \Psi_T \rangle}{\langle \Psi_T | \Psi_T \rangle}
= \int dR\, p(R)\, E_L(R)
$$

- 確率密度（サンプリング分布）
$$
p(R)=\frac{|\Psi_T(R)|^2}{\int dR\,|\Psi_T(R)|^2}
$$

- 局所エネルギー（local energy）
$$
E_L(R)=\frac{\hat{H}\Psi_T(R)}{\Psi_T(R)}
$$

したがって、$R$ を $p(R)$ に従ってサンプリングできれば、モンテカルロ平均で $E[\Psi_T]$ を推定できる。

## 3. 変分モンテカルロ（VMC）
### 3.1 目的
- 変分原理により、任意の試行波動関数 $\Psi_T$ に対して
$$
E[\Psi_T]\ge E_0
$$
が成り立つ（$E_0$ は真の基底状態エネルギー）ため、良い $\Psi_T$ を設計・最適化すれば高精度化できる。

### 3.2 代表的な波動関数形
- Slater–Jastrow 型（最も基本）
$$
\Psi_T(R)= D_\uparrow D_\downarrow \exp\!\big(J(R)\big)
$$
  - $D$：単一または多重のスレーター行列式（DFT/HF軌道から構成）
  - $J$：Jastrow因子（電子–電子、電子–原子の相関を明示的に入れる）
- 追加の改良例
  - 多重決定子（multi-determinant）：強相関・励起状態で有効
  - backflow：節（node）構造を改善しDMC精度に効く場合がある

### 3.3 VMCの位置づけ
- VMCは単独でも参照値になるが、多くの場合はDMCの前処理として重要である
  - Jastrowパラメータ最適化（エネルギー最小化や分散最小化）
  - DMCの固定節近似の誤差を減らすための下地づくり

## 4. 拡散モンテカルロ（DMC）
### 4.1 発想：虚時間で基底状態へ射影する
虚時間 $\tau$ を導入すると、シュレーディンガー方程式は拡散型の方程式に写像される。
$$
-\frac{\partial \Psi(R,\tau)}{\partial \tau} = (\hat{H}-E_T)\Psi(R,\tau)
$$
ここで $E_T$ は規格化を保つための参照エネルギーである。

この方程式は確率過程（拡散＋分岐）として表現でき、$\tau\to\infty$ で基底状態に収束する。

### 4.2 固定節（fixed-node）近似
電子はフェルミ粒子であり符号問題が生じるため、実用的なab initio DMCでは通常、試行波動関数 $\Psi_T$ の節（node）を固定し、その制約下で最良の基底状態を求める（固定節DMC）。
- 重要な帰結
  - DMCエネルギーは固定節制約下での上限値である
  - 精度は「試行波動関数の節構造」に支配される（Jastrowは主に分散低減、節は決定子・backflow等が効く）

## 5. VMC/DMCの比較
|項目|VMC|DMC（固定節）|
|---|---|---|
|狙い|$\Psi_T$ の期待値を推定し改善する|虚時間で基底状態へ射影し高精度化する|
|理論的性質|変分上限|固定節制約下の変分上限（節誤差が残る）|
|主な用途|波動関数最適化、分散低減、粗い参照|相対エネルギー、形成エネルギー、反応エネルギーの高精度評価|
|支配的誤差|試行波動関数の質、統計誤差|固定節誤差、時間刻み誤差、有限サイズ誤差、擬ポテンシャル処理|
|計算コスト|高いがDMCより軽い|非常に高い（並列化しやすいが資源を要する）|

## 6. 設計指針
### 6.1 周期境界条件（PBC）と有限サイズ誤差
固体計算では有限セルでの計算となるため、以下が重要である。
- 1体（運動量空間）有限サイズ：twist averaging（境界位相の平均化）
- 2体（クーロン相互作用）有限サイズ：MPC（model periodic Coulomb）や補正項の導入
- 実務的には「セルサイズ」「twist数」「補正の目的と残差」を系統的に確認する必要がある

### 6.2 擬ポテンシャル（pseudopotential）の扱い
- 実材料では全電子計算が高価なため擬ポテンシャルを用いることが多い
- 非局所擬ポテンシャルの扱い（局在化近似など）に系統誤差が入るため、比較計算・収束試験が要点である

### 6.3 誤差棒の意味（統計誤差と系統誤差）
QMCは統計誤差が明示的に出る一方で、材料設計では系統誤差（固定節、有限サイズ、時間刻み）が支配的になりやすい。
- 推奨される姿勢
  - 統計誤差を小さくするより先に、系統誤差の収束・補正計画を立てる
  - エネルギー差分（相対値）で誤差相殺を最大化する

## 7. 代表的ワークフロー（DFT→QMCで固体を扱う）
1) DFTで構造と軌道を用意する（VASPやQE等）
- 目的：試行波動関数の決定子部（軌道）を作る、初期構造を得る

2) QMC入力へ変換
- 軌道形式（平面波→B-spline等）やセル・twistの設定を行う

3) VMCでJastrow等を最適化
- エネルギー/分散最小化で統計効率とDMC安定性を上げる

4) DMCで全エネルギーと差分量を評価
- 形成エネルギー、欠陥形成、吸着エネルギー、相転移圧力など

5) 収束確認
- 時間刻み（time-step）外挿
- walker数・ブロック長によるバイアス確認
- セルサイズ・twist数・補正の確認

## 8. 応用例（何が担保できるか）
- 相安定性・形成エネルギー
  - DFTで微妙な差（数10 meV/atom）が議論になる系の検証に効く
- 欠陥・ドーパント・界面
  - 局在状態や自己相互作用誤差が問題になるときの参照
- 絶縁体ギャップ（準粒子ギャップ）
  - $E_g \approx E(N+1)+E(N-1)-2E(N)$ のような全エネルギー差分として推定する設計が可能である
- 強相関物質
  - 汎関数依存が大きい場合に「別の理論的アンカー」を与えやすい

## 9. 注意点
- DFTの構造最適化誤差をそのままQMCに持ち込んでいる
  - QMCは高価であるため、構造の妥当性（相、磁性、体積）が前提になる
- time-step・finite-size・twistの収束が不十分
  - 誤差棒だけ小さくしても、系統誤差が残れば材料結論がぶれる
- 比較対象（参照状態）が揃っていない
  - 同一セル、同一擬ポテンシャル、同等の収束条件で差分を取ることが重要である

## まとめ
- 量子モンテカルロ法（QMC）は、波動関数に基づいて物質の多体量子問題を統計的に評価する第一原理手法群であり、材料科学ではDFTの不確かさが支配的な論点に対して高精度な参照値を与える役割を持つ。
- VMCは試行波動関数の設計・最適化と分散低減に強く、DMC（固定節）は基底状態エネルギーを実務レベルで高精度化できる一方、固定節誤差や有限サイズ誤差などの系統誤差設計が結論を左右する。探索（DFT）と検証（QMC）を分業させ、差分量で誤差相殺を最大化する設計が要点である。

