# ボロノイ分割法（Voronoi tessellation）

ボロノイ分割法は、原子座標（点集合）から空間を「最も近い原子に属する領域」に分割し、各原子の局所幾何（近接関係・配位多面体・空隙）を定量化する手法である。結晶のWigner–Seitz胞から、アモルファス・液体・ナノ多結晶・界面まで、構造の特徴量化に広く用いられる。

## 参考ドキュメント
- 非晶質合金の構造に関する最近の話題（ボロノイ多面体解析の流れを含む，PDF）
  https://tohoku.repo.nii.ac.jp/record/49777/files/1348-4052-2010-66%281-2%29-33.pdf
- 金属ガラスと近似結晶の構造評価（Zr-Cu系などのボロノイ多面体頻度分布の例，PDF）
  https://www.imr.tohoku.ac.jp/media/files/research/reports/ado2011/0101sugiyama.pdf
- 卒業論文 アモルファス金属の構造特性の分子動力学的研究（Voronoi多面体の頻度比較など，PDF）
  https://www.fml.t.u-tokyo.ac.jp/img/graduation-thesis/2004b_nikkuni.pdf


## 1. 概要
ボロノイ分割法の主用途は以下である。
- 配位数を距離カットオフに頼らず幾何学的に定義する
- 局所多面体（ボロノイ多面体）の種類・頻度を統計化し、短距離秩序・中距離秩序を議論する
- 空隙体積・自由体積・局所密度を評価し、拡散・粘性・延性・相安定性などと関連付ける

## 2. 基本定義（ユークリッド距離のボロノイ分割）
原子（点） $i$ の位置を $r_i$、空間の点を $x$ とすると、ボロノイ領域 $V_i$ は

$$
V_i=\{x \mid \|x-r_i\|\le \|x-r_j\|,\ \forall j\neq i\}
$$

で定義される。領域境界は、原子 $i$ と $j$ の垂直二等分面（半空間の交わり）として与えられる。

補足（材料科学で重要な対応）
- 各 $V_i$ は（一般に）凸多面体になり、これをボロノイ多面体と呼ぶ
- $V_i$ と $V_j$ が面を共有する ⇔ $i$ と $j$ はボロノイ近接（Delaunay近接）である
- 単一元素の理想結晶では、ボロノイ多面体はWigner–Seitz胞と一致する

## 3. 重み付きボロノイ（多元素系での実行）
多元素系では、原子半径の違いを無視した通常のボロノイ分割が「小さい原子が過剰に近接と判定される」などの偏りを生むことがある。そこで、半径（重み） $R_i$ を導入した重み付き（ラジカル／Laguerre）ボロノイ分割が使われる。

パワー距離（power distance）
$$
\pi_i(x)=\|x-r_i\|^2 - R_i^2
$$

重み付きボロノイ領域
$$
V_i^{(w)}=\{x \mid \pi_i(x)\le \pi_j(x),\ \forall j\neq i\}
$$

実務ポイント
- $R_i$ は金属半径・共有結合半径・イオン半径など目的に合わせて選ぶ
- どの半径を採用したかは再現性のため必ず明記する

## 4. 何を計算するか
ボロノイ多面体から得られる代表的な特徴量をまとめる。

| 指標 | 定義・意味 | 典型用途 |
|---|---|---|
| ボロノイ配位数 $Z_V$ | 多面体の面の数（facet数） | 近接原子数の幾何学的定義、結晶/アモルファス比較 |
| ボロノイ指数 $⟨n3,n4,n5,n6,...⟩$ | k角形の面の枚数 $n_k$ を並べたもの | 局所多面体の同定、短距離秩序（例：正二十面体） |
| 体積 $V$, 表面積 $A$ | 各ボロノイセルの幾何量 | 自由体積、局所密度、拡散・粘性との相関 |
| 形状指標（球形度など） | 例：球形度 $ϕ = (36π V^2)/(A^3)$ | 局所等方性、構造緩和・せん断帯の議論 |
| 隣接ネットワーク | facet共有のグラフ（近接関係） | 伝導経路、拡散ネットワーク、欠陥周りの位相解析 |

代表例（アモルファス金属で頻出）
- ⟨0,0,12,0⟩：五角形面12枚の局所構造（しばしば正二十面体的モチーフとして扱われる）

注意
- 「距離最近接の配位数」と「ボロノイ配位数」は同一にならない場合がある（特に熱揺らぎ・多元素・低密度領域）

## 5. 解析ワークフロー
1) 入力準備
- MD/DFTから原子座標を用意（例：POSCAR, xyz, dump）
- 周期境界条件（PBC）の有無を確認（バルクはPBCが基本）

2) ボロノイ分割の実行
- 単元素なら通常ボロノイでも良いことが多い
- 多元素なら重み付き（radical/Laguerre）を検討

3) 特徴量抽出
- 全原子の $Z_V$、$⟨n3,n4,n5,n6,...⟩$、$V,A$ などを計算してCSV化
- 系全体の分布（ヒストグラム）と、空間マップ（原子に色付け）を作成

4) 解釈・比較
- 組成、温度、焼鈍、歪、照射などの条件で分布の変化を見る
- 物性（拡散係数、弾性、損失、電気抵抗など）と統計的相関をとる

## 6. 応用例
### 6.1 アモルファス／金属ガラス
- 局所多面体頻度（特に五角形面の多さ）から短距離秩序を定量化
- 構造緩和・焼鈍に伴う「特定モチーフの増減」を追跡
- 自由体積（ボロノイ体積の空間不均一）と塑性変形・せん断帯の関連を議論

### 6.2 多結晶・粒界・界面
- 粒界近傍のボロノイ体積増大や配位の乱れを指標化
- 欠陥（空孔、転位芯、界面）周りの局所構造の“地図”を作れる

### 6.3 拡散・輸送
- 近接ネットワーク（Delaunay近接）を用いて拡散経路候補を抽出
- ボロノイ空隙（ボロノイ頂点や稜）をイオン伝導のボトルネック解析に使うことがある

## 7. 実装・ツール（使い分けの目安）
| ツール | 特徴 | 向いている用途 |
|---|---|---|
| OVITO | Voronoi解析と可視化が一体。MDトラジェクトリに強い | アモルファス/欠陥の可視化、統計 |
| Voro++ | 高速なボロノイ計算ライブラリ（C++系） | 大規模系の計算、スクリプト連携 |
| pymatgen | 結晶構造解析に強い。近接判定（VoronoiNN等） | 結晶・無機結晶の配位解析、MI前処理 |
| freud など | 解析寄りライブラリ（一部はMD向け） | 統計解析、特徴量抽出の自動化 |

運用のコツ
- 最初はOVITOで目視確認 → 大規模統計はVoro++やPython連携に移行、が失敗しにくい
- 解析条件（PBC、重み付きの半径、許容誤差）は記録して再現可能にする

## 8. 注意点
- PBCの設定ミス：表面を含む系でPBCを誤ると「無限に開いたセル」や体積異常が出る
- 熱揺らぎでトポロジーが跳ぶ：温度が高い、ノイズが大きいと指数の分布が不安定になり得る
- 重み（半径）依存：多元素ほど結果が半径選択に敏感。感度解析（半径を少し振って頑健性確認）を推奨
- 距離カットオフとの混同：ボロノイ近接は距離最近接と一致しない場合がある。比較するときは定義を揃える
