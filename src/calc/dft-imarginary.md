# 虚数時間発展法（ITE）の基礎

虚数時間発展法（ITE:Imaginary-Time Evolution）は、時間発展方程式の形式を利用して基底状態（最低エネルギー固有状態）を数値的に抽出する反復法である。固有値問題を「拡散・緩和」問題へ置き換えることで、安定にエネルギー最小状態へ収束させる枠組みを与える。

## 参考ドキュメント
- P. Bader, S. Blanes, F. Casas, Solving the Schrödinger eigenvalue problem by the imaginary time propagation technique using splitting methods with complex coefficients, J. Chem. Phys. 139, 124117 (2013). 
  https://personales.upv.es/serblaza/2013JChemPhys.pdf
- （日本語）法政大学 情報メディア教育研究センター研究報告, 虚数時間発展法による電子状態計算の実用化（2023）. 
  https://www.jstage.jst.go.jp/article/rccms/38/0/38_17/_pdf/-char/ja
- （日本語）矢花一浩 講義スライド（密度汎関数アプローチの中での虚時間法の説明を含む）. 
  https://bridge.kek.jp/lecture/08-yabana/slide_130222-1.pdf
- Y. Kuang, G. Hu, On Stabilizing and Accelerating SCF Using ITP in Solving Kohn–Sham Equation, Commun. Comput. Phys. 28, 999–1018 (2020). 
  https://yk2015.github.io/papers/kuang2020on.pdf


## 1. ねらいと立ち位置
多くの量子系では、観測量の出発点が基底状態（あるいは準安定状態）の電子状態である。基底状態探索は、次のような計算を支える中核である。

- Kohn–Sham 方程式の自己無撞着解（DFTの基底状態）
- 実時間の電子ダイナミクス（TDDFT）や外場応答の初期状態生成
- 欠陥・界面・表面の局在状態の抽出
- 励起状態計算のための直交化された低励起状態の生成（制約付き）
- ハミルトニアンの固有値・固有関数の反復的な求解（行列対角化の代替・補助）

虚数時間発展法は「物理的に実在する時間」を進める操作ではなく、基底状態を強調する射影（projection）を数値的に実装するための便法である。

## 2. Wick回転と基底状態への射影

### 2.1 実時間のSchrödinger方程式
$\hbar=1$ として、
$$
i\frac{\partial}{\partial t}\psi(\mathbf{r},t)=\hat{H}\psi(\mathbf{r},t)
$$

### 2.2 虚数時間への置換（Wick回転）
実時間 $t$ を虚数時間 $\tau$ に置換する（符号流儀はいくつかあるが、ここでは $t=-i\tau$ を採用）：
$$
t=-i\tau \quad\Rightarrow\quad \frac{\partial}{\partial t}=i\frac{\partial}{\partial \tau}
$$
すると
$$
\frac{\partial}{\partial \tau}\psi(\mathbf{r},\tau)=-\hat{H}\psi(\mathbf{r},\tau)
$$
となり、形式的解は
$$
\psi(\tau)=e^{-\tau \hat{H}}\psi(0)
$$
である。

### 2.3 固有成分分解による「基底状態フィルタ」
$\hat{H}\phi_n=E_n\phi_n$、$\psi(0)=\sum_n c_n\phi_n$ とすると
$$
\psi(\tau)=\sum_n c_n e^{-\tau E_n}\phi_n
$$
エネルギーが $E_0<E_1<\cdots$ で、$c_0\neq 0$ なら
$$
\frac{\psi(\tau)}{\|\psi(\tau)\|}\xrightarrow[\tau\to\infty]{}\phi_0
$$
が成り立つ。すなわち、虚数時間発展は高エネルギー成分を指数関数的に減衰させ、基底状態を選択的に残す。

### 2.4 規格化とエネルギーシフト
指数減衰は値のアンダーフローを起こすため、各ステップで規格化（正規化）が必要である。また、エネルギーの基準 $E_{\mathrm{ref}}$ を導入して
$$
\psi(\tau+\Delta\tau)=e^{-\Delta\tau(\hat{H}-E_{\mathrm{ref}})}\psi(\tau)
$$
とすると、振幅スケールを制御しやすい。$E_{\mathrm{ref}}$ は例えば期待値
$$
E(\tau)=\frac{\langle\psi(\tau)|\hat{H}|\psi(\tau)\rangle}{\langle\psi(\tau)|\psi(\tau)\rangle}
$$
で更新することが多い。

## 3. 変分原理・勾配流との関係
虚数時間発展は、エネルギー汎関数の勾配方向へ滑らかに降りていく「緩和（relaxation）」として理解できる。

ハミルトニアンが時間に依存しない場合、適切な規格化を伴う虚数時間発展は、エネルギーを下げる方向へ状態を更新する反復法として働く。直感的には

- 実時間：ユニタリ発展でノルム保存、位相回転（振動的）
- 虚数時間：指数因子で高エネルギー成分が消える（散逸的）

という対比であり、後者が「安定に基底へ寄る」理由である。

## 4. 数値アルゴリズム設計

### 4.1 前進Euler（陽解法）
微分方程式
$$
\frac{\partial\psi}{\partial \tau}=-\hat{H}\psi
$$
を
$$
\psi_{n+1}\approx \psi_n-\Delta\tau\,\hat{H}\psi_n
$$
で進めるのが最小構成である。実装は容易だが、安定性制約（$\Delta\tau$ を小さくする必要）が強い。

### 4.2 半陰的・陰的スキーム
拡散型方程式に近いため、Crank–Nicolson 型の更新
$$
\left(1+\frac{\Delta\tau}{2}\hat{H}\right)\psi_{n+1}
=
\left(1-\frac{\Delta\tau}{2}\hat{H}\right)\psi_{n}
$$
は安定化に有効である。一方で各ステップで線形方程式（あるいは反復解法）が必要になる。

### 4.3 スプリット演算子（Trotter–Suzuki分解）
$\hat{H}=\hat{T}+\hat{V}$（例：$\hat{T}=-\nabla^2/2$）のとき、
$$
e^{-\Delta\tau(\hat{T}+\hat{V})}
\approx
e^{-\frac{\Delta\tau}{2}\hat{V}}
e^{-\Delta\tau \hat{T}}
e^{-\frac{\Delta\tau}{2}\hat{V}}
\quad(\text{2次})
$$
が代表例である。平面波基底では $\hat{T}$ が $k$ 空間で対角になるため、FFT を介して効率よく適用できる。高次化には多段分解を用い、係数設計が性能を左右する。

高次分解の重要点は、虚数時間では「係数が負」になると発散しやすいことである。そこで、係数の実部が正となる複素係数分解などが提案されている。

### 4.4 多状態（複数軌道）の扱い：直交化
基底状態のみなら単一ベクトルでよいが、Kohn–Sham では占有軌道の集合 $\{\psi_i\}$ を扱う。虚数時間発展は全軌道を基底状態へ崩壊させる方向に作用するため、毎ステップで

- 直交化（Gram–Schmidt など）
- 正規直交化（$\langle\psi_i|\psi_j\rangle=\delta_{ij}$）
- 占有数（フェルミ分布、スメアリングなど）の更新

が不可欠である。励起状態（低励起）を得たい場合も、低い状態への直交制約が必須である。

### 4.5 収束判定
代表的な判定量は次である。

- 全エネルギー差：$|E_{n+1}-E_n|<\epsilon$
- 密度差：$\|\rho_{n+1}-\rho_n\|<\epsilon$
- 残差：$\|(\hat{H}-\epsilon_i)\psi_i\|<\epsilon$

虚数時間法は「単調に改善する」印象を持たれやすいが、離散化誤差や直交化誤差で小さな揺れが出ることもあるため、複数指標で監視するのがよい。

## 5. Kohn–Sham DFTにおける虚数時間発展

### 5.1 Kohn–Sham 方程式
$$
\hat{H}_{\mathrm{KS}}[\rho]\psi_i(\mathbf{r})=\epsilon_i\psi_i(\mathbf{r}),
\qquad
\rho(\mathbf{r})=\sum_{i\in \mathrm{occ}} f_i|\psi_i(\mathbf{r})|^2
$$
ここで $\hat{H}_{\mathrm{KS}}$ は密度に依存する非線形演算子である。

### 5.2 SCF反復との違い
SCF は「密度を仮定して固有値問題を解く」操作を繰り返す。一方、虚数時間発展は「時間発展の形で軌道を緩和させて」密度を更新する。

両者の関係を粗く言えば次のようになる。

- SCF：各反復で（近似的に）対角化を行うため、うまくいけば速いが不安定化する場合がある
- 虚数時間：1ステップは軽いが、基底に近づくには多ステップが要る。ただし発散しにくい

現代的には、虚数時間発展で良い初期推定を作り SCF の収束を改善する、といったハイブリッド設計も行われる。

### 5.3 アルゴリズム
1. 初期軌道 $\{\psi_i^{(0)}\}$ を用意（原子軌道、乱数、既計算の再利用）
2. 反復 $n=0,1,2,\dots$
   1) $\rho^{(n)}$ から $\hat{H}^{(n)}_{\mathrm{KS}}$ を構築  
   2) 各軌道を虚数時間で更新  
      $\psi_i \leftarrow e^{-\Delta\tau(\hat{H}^{(n)}_{\mathrm{KS}}-E_{\mathrm{ref}})}\psi_i$  
   3) 直交化・規格化（全軌道集合）  
   4) 占有 $f_i$ を更新（必要ならスメアリング）  
   5) 新しい $\rho^{(n+1)}$ を生成し、収束判定
3. 収束した $\{\psi_i\}$ と $\rho$ を基底状態として採用（以後、力・応力・応答計算へ）

### 5.4 実時間TDDFT・光学応答との接続
実時間TDDFTでは、外場印加の前に基底状態密度が必要である。虚数時間発展は「時間発展器」を共有しやすく、同一コードパスで基底と実時間を扱う設計と相性がよい。再始動（restart）を介して基底状態から時間発展へ接続する運用が一般的である。

## 6. AIMD/構造緩和
第一原理分子動力学（Born–Oppenheimer MD）では各原子配置で電子基底状態が必要であり、一般にSCF 収束が計算コストの中心になる。虚数時間発展は

- SCFが発散しやすい初期ステップでの安定化
- 幾何学最適化の初期推定の改善
- 強い外場・非平衡状態の後に基底へ戻す「冷却」

などで補助的に利用できることがある。一方で、金属系や巨大系ではステップ数増大が不利になりやすく、SCF（混合法や前処理）と使い分ける設計が現実的である。

Car–Parrinello 法が導入する「電子の仮想慣性」と、虚数時間の「散逸緩和」は別物であるが、どちらも電子自由度を基底へ保つための数値的工夫として並べて理解できる。

## 7. 関連概念

| 文脈 | 何を虚時間で進めるか | 目的 | 代表例 |
|---|---|---|---|
| 虚数時間発展法（本稿） | 波動関数/軌道 $\psi$ | 基底状態への射影 | $e^{-\tau \hat{H}}\psi$ |
| 熱平衡（統計力学） | 密度行列 $e^{-\beta \hat{H}}$ | 分配関数・自由エネルギー | $\beta=1/k_BT$ |
| パス積分MD（PIMD） | 虚時間スライス（ビーズ） | 量子核の平衡統計 | リングポリマー写像 |
| 量子計算（QITE等） | 非ユニタリ操作の模倣 | 量子回路で基底探索 | QITE/量子Lanczos |

特に PIMD の虚時間は「平衡量子統計」のための離散化であり、本稿の「基底射影」とは狙いも対象も異なる。ただし数学的に $e^{-\beta \hat{H}}$ が共通言語になるため、両者が連想されやすい点に注意が必要である。

## 8. 注意点

### 8.1 $\Delta\tau$ を大きくしすぎる
陽的更新は不安定化しやすい。症状は発散、ノルムの崩壊、エネルギーの異常増加などである。対策は

- $\Delta\tau$ を下げる
- 半陰的・陰的手法へ切り替える
- スプリット演算子（FFT）等の安定な伝播器を使う

である。

### 8.2 直交性の喪失（多軌道）
直交化が不十分だと、全軌道が同じ低状態へ崩れ、密度が壊れる。対策は

- 各ステップで正規直交化
- 長周期での再直交化（数値誤差の蓄積対策）
- 占有・縮退の取り扱い（対称性の制約）

である。

### 8.3 対称性・縮退がある系
縮退系では初期条件に依存して収束状態が変わりやすい。磁性や軌道秩序のように準安定解が多い系では、狙った解（磁化方向、対称性、局在/非局在）を得るために

- 初期軌道の対称性を設計する
- 制約（投影、占有固定、スピン拘束）を導入する
- 複数初期条件で探索する

といった工夫が要る。

### 8.4 金属系・部分占有
バンドギャップがゼロに近いと、占有近傍の状態が多く、収束が遅くなることがある。スメアリング、混合、前処理と併用する設計が有効である。

## 9. 使いどころの判断指針
次の条件のいずれかに当てはまる場合、虚数時間発展法は有力な選択肢である。

- SCF が初期密度に敏感で暴れる、または発散する
- どうしても安定に基底へ落とし込みたい（外場後の緩和など）
- 実時間TDDFTと同じ枠組みで基底状態生成を統一したい
- 実空間格子法などで、対角化を避けて大規模並列に寄せたい

逆に「単発の基底計算を最速で回したい」だけなら、対角化＋SCF 混合の方が有利な場面も多い。

## まとめ
虚数時間発展法は $e^{-\tau \hat{H}}$ による射影で高エネルギー成分を減衰させ、規格化と直交化を伴いながら基底状態を安定に抽出する方法である。Kohn–Sham DFT、実時間TDDFT、AIMDの初期状態生成や収束安定化に接続しやすく、SCFの代替というよりは「発散しにくい緩和器」あるいは「良い初期推定を作る装置」としての価値が高い。数値安定性（$\Delta\tau$ と伝播器）と直交化（多軌道）の設計が、精度・速度・堅牢性を決める要点である。