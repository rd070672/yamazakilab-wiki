# グランドカノニカルモンテカルロ法

グランドカノニカルモンテカルロ（Grand Canonical Monte Carlo; GCMC）法は、温度Tと体積Vを固定しつつ、化学ポテンシャルμによって粒子数N（または組成）を揺らがせるモンテカルロ法である。材料科学では、吸着・欠陥・表面被覆・合金組成など「開放系」の平衡を、実験条件（分圧・活量・電位など）に対応づけて予測するための基盤手法である。

## 参考ドキュメント（3件）
- 日本吸着学会誌 Adsorption News: 分子吸着シミュレーションの基礎（GCMCの概説を含む，PDF，日本語）
  https://www.j-ad.org/adsorption_news/32_2.pdf
- Wexler et al., Automatic Prediction of Surface Phase Diagrams Using Ab Initio Grand Canonical Monte Carlo（PDF）
  https://wexlergroup.github.io/assets/papers/Wexler2019p2321.pdf
- ATAT Manual（第一原理相図計算とMonte Carloの連携のユーザーガイド，PDF）
  https://axelvandewalle.github.io/www-avdw//atat/manual.pdf

## 1. 何を解く手法か
GCMCが得意とする問いは次のとおりである。

- ナノ多孔質材料（MOF、ゼオライト、活性炭など）における吸着等温線・選択性の予測
- 表面の被覆率や吸着相（surface phase）の切り替わりを、分圧（μ）と温度で描く
- 点欠陥（空孔・侵入原子）や軽元素（H, C, Nなど）の固溶量を化学ポテンシャルで制御して求める
- 合金相図で本質的な「化学ポテンシャル差により組成が決まる」状況を、（半）グランドカノニカルMCで扱う

注意として、置換型合金（格子点が固定で原子種だけが入れ替わる系）では、粒子の挿入・削除よりも「原子種の交換」を行う半グランドカノニカル（semi-grand canonical; SGCMC）が使われることが多い。GCMCは連続空間の挿入・削除が自然な系（気体吸着、溶液、表面吸着など）で特に真価を発揮する。

## 2. 統計力学の定義（μVTアンサンブル）
GCMCはμVT（温度T、体積V、化学ポテンシャルμ一定）アンサンブルのサンプリングである。

- 大分配関数
$$
\Xi(\mu,V,T)=\sum_{N=0}^{\infty} e^{\beta \mu N} Z_N(V,T),\quad \beta=\frac{1}{k_{\mathrm B}T}
$$

- グランドポテンシャル（大自由エネルギー）
$$
\Omega(\mu,V,T)=-k_{\mathrm B}T\ln \Xi
$$

バルク流体系では、平衡で
$$
\Omega=-PV
$$
が成り立つため、GCMCは（μ,T）から（P,T）へ写像して相境界を議論する入口にもなる。

## 3. 受理確率（挿入・削除・移動）
GCMCの骨格は、詳細釣り合いを満たすMetropolis受理である。単一成分で、配置エネルギーをU、熱ドブロイ波長をΛとする。

- 粒子の挿入（N → N+1、エネルギー変化 ΔU = U_{N+1}-U_N）
$$
P_{\mathrm{acc}}^{\mathrm{ins}}
=\min\left[1,\;\frac{V}{(N+1)\Lambda^3}\exp\left(\beta\mu-\beta\Delta U\right)\right]
$$

- 粒子の削除（N → N-1、削除でのエネルギー変化を ΔU = U_N - U_{N-1} と定義）
$$
P_{\mathrm{acc}}^{\mathrm{del}}
=\min\left[1,\;\frac{N\Lambda^3}{V}\exp\left(-\beta\mu+\beta\Delta U\right)\right]
$$

- 位置移動（局所緩和；N一定）
$$
P_{\mathrm{acc}}^{\mathrm{move}}=\min\left[1,\exp(-\beta\Delta U)\right]
$$

多成分系では、成分sごとにμ_sとΛ_sを持ち、挿入・削除は各成分に対して同様に定義される。置換型合金のSGCMCでは、格子点iの元素A→B交換に対して
$$
P_{\mathrm{acc}}^{A\to B}=\min\left[1,\exp\{-\beta(\Delta E-\Delta\mu)\}\right],\quad
\Delta\mu=\mu_B-\mu_A
$$
の形が基本である（一般には \Delta E - \sum_s \mu_s \Delta N_s）。

## 4. 化学ポテンシャルμを実験条件へ対応づける
材料応用では「μをどう設定するか」が最重要である。典型例は気相リザーバである。

- 理想気体近似（目安）
$$
\mu(T,P)=\mu^{\circ}(T)+k_{\mathrm B}T\ln\left(\frac{P}{P^{\circ}}\right)
$$

- 実在気体では、圧力Pの代わりにフガシティf（あるいはフガシティ係数φ）を使うのが定石である。
$$
\mu(T,P)=\mu^{\circ}(T)+k_{\mathrm B}T\ln\left(\frac{f}{f^{\circ}}\right),\quad f=\phi P
$$

固体中の侵入原子Hを例に取れば、H2ガスの分圧からμ_Hを決め、固体側のGCMC（あるいは格子モデル＋SGCMC）で固溶量や相転移を得る、という設計になる。

## 5. 相図をどう作るか（GCMCで得られるもの）
GCMCが直接返すのは、μとTに対する統計量である。

- 平均粒子数・組成： ⟨N⟩, ⟨x⟩
- 変動： var(N), var(x)（相転移の鋭さ・臨界性の手がかり）
- 分布： P(N), P(x)（共存では多峰性が現れる）
- 吸着等温線： ⟨N⟩ vs P（μ→P変換を介す）
- （条件が整えば）グランドポテンシャル差： ΔΩ（相安定性の判定）

相図構築の代表的な流れは次である。

1) 温度Tを固定し、μを掃引して ⟨N⟩(μ), P(N|μ) を得る  
2) 一次相転移がある場合、P(N)が二峰性となるμ付近を探索する  
3) 共存条件は「相Aと相Bの安定性が等しい（Ωが等しい）」であり、実務上は二峰の重みが釣り合う点や、自由エネルギー整合条件を満たす点として決める  
4) これをT方向にも繰り返して共存曲線（相境界）を引く  

表面相図（被覆率、表面再構成など）でも本質は同じで、μ（分圧）とTで相（被覆相）が切り替わる境界を求める。

## 6. 材料科学での代表ユースケース
### 6.1 多孔質材料の吸着（等温線と分離）
- 入力：骨格構造（結晶構造）、ゲスト分子モデル（LJ、クーロン、分子内柔軟性など）
- 出力：吸着等温線、混合ガスでの選択性、吸着熱、サイト占有の可視化
- 注意：高圧・高密度での挿入受理率低下に対して、配置バイアス（CBMC）などの工夫が必須になることがある

国内公開事例として、MOFへのCO2吸着量をGCMCで予測し、吸着特性の要因を議論するケーススタディが公開されている。
https://www.mst.or.jp/casestudy/tabid/1318/pdid/719/Default.aspx

### 6.2 表面相図（分圧で切り替わる表面構造）
- 目的：触媒表面や電極表面で、吸着種の被覆率・秩序相・欠陥濃度が（μ,T）でどう変わるかを得る
- 設計：表面モデル＋吸着種の挿入・削除でGCMC、あるいは格子吸着モデル＋（半）グランドカノニカルMC
- 近年：第一原理計算エネルギーと組み合わせ、現実的な表面相図を探索するab initio GCMCも報告されている

### 6.3 合金相図（SGCMC＋有効ハミルトニアン）
置換型合金の相図では、以下の組み合わせが標準的である。

- DFTで形成エネルギーを取り、有効ハミルトニアン（クラスター展開など）を構築する
- SGCMCで（T, Δμ）空間を掃引し、秩序化・相分離・相境界を得る
- 必要に応じて自由エネルギー面を補間し、相境界の自動探索や熱力学データベースへ接続する

この枠組みは、VASPなど第一原理計算と連携する相図計算ツール群（例：ATAT）として整備されている。

## 7. 注意点
- μの定義ずれ：ガスリザーバの実在性（フガシティ）、参照状態（μ°）、温度依存の取り扱いを先に固定する必要がある
- 挿入が通らない問題：高密度・強相互作用では受理率が極端に下がるため、CBMCや段階挿入、バイアス手法の導入が現実解である
- ヒステリシスと準安定：相転移付近は初期条件依存が出やすく、分布P(N)の確認や掃引方向の往復が必須である
- 有限サイズ効果：相境界や臨界点は系サイズでずれるため、サイズ依存の点検が必要である
- 物理拘束の導入：化学的妥当性（結合、電荷中性、サイト占有制約）を、モデル（ハミルトニアン）か試行移動（許容操作）に埋め込む必要がある

## 8. 計算設計の手順
1) 対象現象を決める（吸着、表面被覆、欠陥、合金組成など）  
2) 交換される量を決める（粒子数Nか、原子種か）  
3) エネルギーモデルを決める（古典ポテンシャル、クラスター展開、MLポテンシャル、第一原理オンザフライ等）  
4) μの参照と変換式（P↔μ、活量、フガシティ）を仕様として固定する  
5) 走査軸（T, μ）と、相転移判定に使う観測量（⟨N⟩、P(N)、変動）を定義する  
6) 近傍条件やサイズを振って、相境界の安定性を確認する  

## まとめ
GCMCは、化学ポテンシャルμを入力として開放系の平衡（吸着量、被覆率、欠陥・固溶量、相転移）を直接サンプリングする手法である。相図を得る鍵は、μの実験条件への対応づけと、相転移付近での分布・ヒステリシス・有限サイズを含む評価設計にある。
