# 時間依存密度汎関数理論（TDDFT）

時間依存密度汎関数理論（TDDFT）は、多電子波動関数ではなく電子密度の時間発展を基本変数として、外場下の電子励起・光応答・非平衡ダイナミクスを第一原理で扱う枠組みである。線形応答（スペクトル）と実時間発展（強励起・非線形）を同じ理論から導けることが大きな特徴である。

## 参考ドキュメント
1. E. Runge, E. K. U. Gross, Density-Functional Theory for Time-Dependent Systems, Phys. Rev. Lett. 52, 997 (1984)
   https://link.aps.org/doi/10.1103/PhysRevLett.52.997
2. G. Onida, L. Reining, A. Rubio, Electronic excitations: density-functional versus many-body Green's-function approaches, Rev. Mod. Phys. 74, 601 (2002)
   https://link.aps.org/doi/10.1103/RevModPhys.74.601
3. 矢花 一浩, 光イオン化過程の時間依存密度汎関数理論による第一原理計算, 真空 (J. Vac. Soc. Jpn.) 54, 522 (2011)（J-STAGE）
   https://www.jstage.jst.go.jp/article/jvsj2/54/10/54_10_522/_article/-char/ja/

## 1. 位置づけ

### 1.1 扱える代表的な現象
- 光吸収・反射・誘電関数、EELS（エネルギー損失）、プラズモン
- 励起子（exciton）に伴う吸収端の構造（近似の選び方に依存）
- 非線形光学（高調波発生、サブサイクル応答、ポンプ–プローブ）
- 電荷移動励起、局在励起、Rydberg励起（関数近似の影響が大きい）
- スピン依存応答、磁気光学応答（TD-SDFT/非共線スピンなどの拡張）

### 1.2 TDDFTが「閉じる」ために必要な近似
TDDFTは形式的には厳密であるが、実際の計算は交換相関ポテンシャル（$xc$）を近似することで成立する。特に重要なのは以下である。
- $v_{xc[n](r,t}$ の近似（実時間発展で直接効く）
- $f_{xc(r,r',t−t')} = δv_xc/δn$ の近似（線形応答で中心となる）
- 記憶効果（non-adiabaticity）を無視する「断熱近似」の妥当性

## 2. 基礎定理
### 2.1 Runge–Gross定理（時間依存）
与えられた初期多体状態 $Ψ(t0)$ のもとで、適切な条件（典型的には時間について解析的に展開できる外場など）の範囲で、外部ポテンシャル $v_{ext(r,t)}$ は密度 $n(r,t)$ によって一意に定まる（ゲージを除く）という命題が核である。これにより、時間依存問題を密度汎関数として定める道が開かれる。

### 2.2 Kohn–Sham写像（van Leeuwen型の存在論）
相互作用する多体系の密度 $n(r,t)$ を、非相互作用の単一粒子系（時間依存Kohn–Sham系）でも再現できることを保証する写像が重要である。これが「軌道を時間発展させる」計算法（実時間TDDFT、線形応答TDDFT）の理論的支えとなる。

## 3. 時間依存Kohn–Sham方程式

占有軌道 ${φ_{i(r,t)}}$ に対して

$$
i\hbar \frac{\partial}{\partial t}\phi_i(\mathbf r,t)
=
\left[
-\frac{\hbar^2}{2m}\nabla^2
+ v_s(\mathbf r,t)
\right]\phi_i(\mathbf r,t)
$$

密度は

$$
n(\mathbf r,t)=\sum_{i}^{\mathrm{occ}}|\phi_i(\mathbf r,t)|^2
$$

有効ポテンシャル $v_s$ は

$$
v_s(\mathbf r,t)=v_{\mathrm{ext}}(\mathbf r,t)
+ v_{\mathrm H}[n](\mathbf r,t)
+ v_{\mathrm{xc}}[n;\Psi_0,\Phi_0](\mathbf r,t)
$$

ここで $v_H$ はHartree項である。
- $v_{xc}$ は密度だけでなく初期状態（相互作用系$Ψ_0$とKS系の初期状態$Φ_0$）にも依存しうる
- $v_{xc$ が時間の履歴（memory）に依存しうる点が、静的DFTとの本質的な違いである

### 3.1 断熱近似（adiabatic approximation）
最も広く使われる近似は「その時刻の密度だけで静的$xc$を評価する」形である。

$$
v_{\mathrm{xc}}(\mathbf r,t)\approx v_{\mathrm{xc}}^{\mathrm{gs}}(n(\mathbf r,t))
$$

このとき $f_{xc}$ も時間非局所（記憶）を持たず、スペクトルの一部（特に二重励起や強い非局在励起）に弱点が出やすい。

## 4. 線形応答TDDFT

外場が弱いとき、密度の1次応答は応答関数 $χ$ を用いて

$$
\delta n(\mathbf r,\omega)=\int d\mathbf r'\; \chi(\mathbf r,\mathbf r',\omega)\,\delta v_{\mathrm{ext}}(\mathbf r',\omega)
$$

相互作用系の$χ$は、KS応答 $χ_s$ と $xc$カーネル $f_{xc}$ を介して

$$
\chi(\omega)=\chi_s(\omega) + \chi_s(\omega)\,[v + f_{\mathrm{xc}}(\omega)]\,\chi(\omega)
$$

と書ける（$v$はクーロン相互作用カーネル）。

### 4.1 Casida方程式
有限系（分子・クラスター）では、KSの遷移（占有$i$→非占有$a$）を基底として、励起エネルギー $Ω$ を固有値として求める定式化が広く使われる。概念的には

$$
\sum_{jb}\left[\delta_{ij}\delta_{ab}(\epsilon_a-\epsilon_i)^2 + 4\sqrt{\epsilon_a-\epsilon_i}\,K_{ia,jb}(\Omega)\,\sqrt{\epsilon_b-\epsilon_j}\right]F_{jb}
=
\Omega^2 F_{ia}
$$

ここで $K$ はクーロン項と $f_{xc}$ を含む結合行列である。
- Tamm–Dancoff近似（TDA）は逆遷移成分を捨て、固有値問題を簡略化する
- 固体ではこの「全遷移を並べる」方法は巨大化しやすく、Sternheimer法やLanczos法など別形式が用いられることが多い

### 4.2 固体・周期系での注意点
周期系では巨視的電場（$q→0$）と分極の扱いが微妙である。光学応答では
- 長波長極限での誘電関数 $ε(ω)$ と極性効果
- ローカル場効果（$G≠0$成分の寄与）
- 励起子（電子–正孔相互作用）をどこまで $f_{xc}$ で表現するか
が重要となる。

## 5. 実時間TDDFT

### 5.1 基本手順
短いインパルス的な電場（$δ$キック）を与え、その後の分極 $P(t)$ や電流 $J(t)$ の時間応答を追跡し、フーリエ変換でスペクトルを得る方法がある。

例：分極のフーリエ変換から動的分極率 $α(ω)$ を得て吸収に結びつける。

$$
\alpha(\omega)\propto \int_0^\infty dt\, e^{i\omega t} P(t)
$$

固体では電流応答を用いて導電率・誘電関数に接続することが多い。

### 5.2 伝播アルゴリズム
時間発展には
- 近似的指数演算子（短時間近似）
- クランク–ニコルソン型の単位的伝播
- Magnus展開、ETRS（enforced time-reversal symmetry）など
が用いられる。数値的に重要なのは以下である。
- 時間刻み $Δt$ と最高励起エネルギー（スペクトル帯域）の関係
- 長時間発展での位相誤差・エネルギー漂い
- 境界処理（有限系では吸収境界、CAP、マスク関数など）

### 5.3 周期系でのゲージ（length/velocity）
一様電場を周期境界で扱う際、長さゲージ（$r·E(t)$）はそのままでは不整合が生じるため、ベクトルポテンシャル $A(t)$ を用いる速度ゲージ、あるいは分極の理論（ベリー位相）と整合した形式が用いられる。選ぶ形式により数値条件（$k$点、時間刻み、非局所擬ポテンシャルの扱い）も変わりうる。

## 6. $xc$近似の典型

### 6.1 代表的な近似
- ALDA（断熱LDA）：最も簡便で、局在励起やプラズモンの一部で良い場合がある
- 断熱GGA：基底状態GGAを時間依存へ延長
- ハイブリッド汎関数（断熱）：交換の非局在性が増し、電荷移動励起やRydbergで改善する場合がある
- 長距離補正（range-separated）：遠距離のクーロン相互作用をより適切に扱い、電荷移動励起に有効なことが多い
- 固体向けの長距離カーネル（LRC型など）：励起子効果を取り込むために q→0 の振る舞いを調整する発想がある

### 6.2 限界
- 二重励起（double excitation）は断熱近似の線形応答では原理的に表現が難しい
- 自己相互作用誤差（SIE）とギャップ過小評価は、励起エネルギーや光学端に直結しうる
- 長距離電荷移動励起は、局所的 $f_{xc}$ ではエネルギーが過小評価されやすい
- スピン反転励起、強相関に近い励起は、基準となるKS描像自体が不十分となる場合がある

これらのとき、GW+BSE、CAS系手法、あるいはTDDFT側での高度カーネル（周波数依存・非局在・記憶効果）といった方向が比較検討対象となる。

## 7. 観測量の計算と解釈

### 7.1 吸収スペクトルと誘電関数
線形応答からは $ε(ω)$、$Im ε(ω)$ を通じて吸収が得られる。実時間法でも同等の情報が得られるが、窓関数や減衰係数の導入（有限時間フーリエ変換のアーチファクト抑制）などが必要になる。

### 7.2 プラズモンとEELS
密度応答 $χ$ から損失関数

$$
L(\omega)= -\mathrm{Im}\,\epsilon^{-1}(\omega)
$$

を評価することで、プラズモンの分散や減衰が議論できる。局所場効果やカーネル近似がピーク位置・強度に影響する。

### 7.3 非線形光学（高調波・サブサイクル応答）
強いパルス場下の電流 $J(t)$ のフーリエ成分から高調波スペクトルが得られる。固体高調波ではバンド間・バンド内寄与の分離、dephasing（散逸）のモデル化が重要となることが多い。

### 7.4 電子と原子核の連成
実時間TDDFTを核運動と組み合わせると、電子励起と格子応答の連成（Ehrenfest型、あるいは表面ホッピング等の拡張）へ進む。ただし、核の量子性や非断熱遷移をどう取り込むかは別途近似が必要である。

## 8. 計算設計の要点

| 観点 | 線形応答TDDFT | 実時間TDDFT |
|---|---|---|
| 主対象 | 弱い外場に対するスペクトル | 任意波形・強励起・非線形 |
| 主要量 | $χ, f_{xc}$, 固有値問題 | $v_{xc}$ 時間発展、伝播器 |
| 得意 | 励起エネルギーの分解・遷移解析 | 全帯域の一括取得、場依存現象 |
| 注意点 | カーネル近似、巨大固有値問題 | 時間刻み、境界、ゲージ、長時間誤差 |

どちらも同じ理論に根差すが、数値条件と近似の効き方が異なるため、目的の観測量から逆算して選ぶのが自然である。

## まとめ
TDDFTは、密度の時間発展に基づいて電子励起と応答を第一原理で記述する枠組みであり、線形応答と実時間発展の二本柱で幅広いスペクトル・非平衡現象に接続できる。鍵は交換相関ポテンシャル／カーネル近似の性格を理解し、対象現象（励起子・電荷移動・非線形など）に対してどの近似が支配的な誤差源になるかを見極めることである。

