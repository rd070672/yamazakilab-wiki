# 非平衡グリーン関数（NEGF）と量子輸送

非平衡グリーン関数（NEGF）は、電極に接続された開放量子系を、境界条件（自己エネルギー）として厳密に取り込みつつ、電流・透過・非平衡分布を統一的に計算する枠組みである。Keldysh輪郭上の時間発展により、線形応答を超えるバイアス印加下の量子輸送を扱える点が特徴である。

## 参考ドキュメント
1) L. V. Keldysh, Diagram technique for nonequilibrium processes, Sov. Phys. JETP 20, 1018 (1965).
https://www.jetp.ras.ru/cgi-bin/dn/e_020_04_1018.pdf
2) M. Brandbyge, J. L. Mozos, P. Ordejón, J. Taylor, K. Stokbro, Density-functional method for nonequilibrium electron transport, Phys. Rev. B 65, 165401 (2002).
https://doi.org/10.1103/PhysRevB.65.165401
3) 森 伸也, 次世代MOS型デバイスの量子輸送シミュレーション（NEGFに基づくデバイスモデリングの解説）, 応用物理 78(6), 540 (2009).
https://www.jstage.jst.go.jp/article/oubutsu/78/6/78_540/_pdf


## 1. 量子輸送
考える系は、左電極L・散乱領域C・右電極Rからなる二端子構造である。

- 電極：無限に広がる準平衡の粒子浴であり、化学ポテンシャル $\mu_L,\mu_R$（バイアス）と温度 $T_L,T_R$ を持つ
- 散乱領域：界面、欠陥、分子、ナノ接点、薄膜、2D材料、磁性層など、輸送の本体である
- 目的量：透過確率 $T(E)$、電流 $I$、局所状態密度（LDOS）、局所電流、非平衡電荷密度、熱電・スピン輸送など

この構造では「開放境界条件」が本質であり、NEGFはそれを自己エネルギー $\Sigma_{L/R}$ として厳密に織り込む。

## 2. Keldysh輪郭とGreen関数の種類
非平衡では、通常の時間順序（$T$）だけでは不足し、Keldysh輪郭（順方向・逆方向の2枝、必要なら虚時間枝）上の順序化 $T_C$ を導入する。これにより、以下のGreen関数が同時に扱える。

| 記号 | 定義のイメージ | 物理的意味 |
| --- | --- | --- |
| $G^r$（retarded） | 応答（因果性） | 外乱に対する系の応答、共鳴・準位幅 |
| $G^a$（advanced） | $G^r$ の随伴 | 逆向きの因果構造（数式上の相棒） |
| $G^<$（lesser） | 占有情報 | 非平衡分布・電荷密度を担う中心量 |
| $G^>$（greater） | 非占有情報 | 散乱とバランス式に現れる |
| スペクトル関数 $A$ | $A=i(G^r-G^a)$ | 状態密度、準位の広がり |

特に実計算では、(i) 構造（状態の置き場所）は $G^r$、(ii) 占有（どれだけ入っているか）は $G^<$ が担う、と整理すると見通しが良い。

## 3. 開放系を作る自己エネルギー：電極を「境界条件」に畳み込む
散乱領域Cだけを明示的に扱い、電極の自由度を消去すると、Cに電極の効果が自己エネルギーとして現れる。

- 電極自己エネルギー（例：右電極）
$$
\Sigma_R^{r}(E) = V_{CR}\, g_R^{r}(E)\, V_{RC}
$$
ここで $g_R^{r}$ は半無限電極の表面Green関数であり、$V_{CR}$ は結合である。

- 線幅関数（電極との結合強度）
$$
\Gamma_{R}(E)= i\left[\Sigma_R^{r}(E)-\Sigma_R^{a}(E)\right]
$$
$\Gamma$ が大きいほど準位は広がり、接触抵抗は下がる傾向にある。

半無限電極の表面Green関数 $g^{r}$ は、電極の主層ブロック行列を用いた反復法（decimation/transfer matrix）で求めるのが定石である。

## 4. Dyson方程式：散乱領域の $G^r$ を求める
非相互作用（あるいは平均場）レベルの基本形は次である（非直交基底なら重なり行列 $S$ を含む）。

$$
G^{r}(E) = \left[(E+i\eta)S - H_C - \Sigma_L^{r}(E)-\Sigma_R^{r}(E)-\Sigma_{\mathrm{int}}^{r}(E)\right]^{-1}
$$

- $H_C$：散乱領域のハミルトニアン（DFTやtight-bindingから得る）
- $\Sigma_{L/R}$：電極境界条件
- $\Sigma_{\mathrm{int}}$：電子・フォノン、電子・電子（相関）、不純物散乱などを自己エネルギーとして入れる場合

この式が「開放系の有効ハミルトニアンの逆行列」である点が重要で、開放境界条件が $\Sigma$ に集約されている。

## 5. Keldysh方程式：非平衡占有 $G^<$ を求める
定常状態で、相互作用を自己エネルギーに押し込む一般形は

$$
G^{<}(E)=G^{r}(E)\,\Sigma^{<}(E)\,G^{a}(E)
$$

非相互作用電極のみ（コヒーレント輸送）なら
$$
\Sigma^{<}(E)=i\left[f_L(E)\Gamma_L(E)+f_R(E)\Gamma_R(E)\right]
$$
となり、非平衡分布は「左右電極からの注入の和」として解釈できる。

電荷密度（非直交基底の一例）は
$$
\rho(\mathbf{r}) \propto \int \frac{dE}{2\pi}\,(-i)\,G^{<}(E)
$$
のように $G^<$ から得られ、後述のPoisson-NEGF自己無撞着計算へつながる。

## 6. 電流公式：Landauer–BüttikerとMeir–Wingreen
### 6.1 コヒーレント輸送（相互作用なし：Landauer型）
透過関数はCaroli型に
$$
T(E)=\mathrm{Tr}\left[\Gamma_L(E)\,G^{r}(E)\,\Gamma_R(E)\,G^{a}(E)\right]
$$
で与えられ、電流は
$$
I=\frac{2e}{h}\int dE\,T(E)\left[f_L(E)-f_R(E)\right]
$$
となる（係数2はスピン縮退がある場合）。

### 6.2 相互作用を含む（Meir–Wingreen型）
相互作用（電子・電子、電子・フォノンなど）が散乱領域内にある場合、電流は $G^<$ を含む一般式で表される。NEGFの強みは、この一般式から近似（例：自己無撞着Born近似）を組み、非線形I–Vや非弾性効果まで取り込める点にある。

## 7. Poisson–NEGF自己無撞着：ゲート・空乏層・界面電荷を扱う
デバイス的状況では、電荷再分布がポテンシャルを変え、ポテンシャルが再び電荷を変えるため、NEGFとPoisson方程式を自己無撞着に解く。

$$
\nabla\cdot\left[\epsilon(\mathbf{r})\nabla \phi(\mathbf{r})\right]=-\rho(\mathbf{r})
$$

- ゲート電圧、誘電体、界面固定電荷、ドーピングを境界条件として導入する
- 収束が難しい場合は、ミキシング、ダンピング、初期電位の工夫が効く
- 電極と散乱領域のポテンシャル整合（参照エネルギーの揃え）を誤ると、非物理な散乱や電流が出る

## 8. 非弾性輸送と散乱：電子–フォノン、欠陥、温度効果
輸送が完全にコヒーレントでない場合、散乱を自己エネルギーとして導入する。

- 電子–フォノン散乱：$\Sigma_{\mathrm{ep}}^{r,<}$ を導入し、自己無撞着に $G$ と同時決定（SCBAなど）
- 欠陥・乱れ：平均化（CPA的）や有効自己エネルギーで扱う場合がある
- フォノン輸送（熱伝導）：フォノンNEGFで同様に $T(\omega)$ を計算し、熱流を評価する流儀がある

散乱を入れると数値負荷が急増するため、「何を最小モデルとして残すか」が計算設計の核心となる。

## 9. DFT-NEGF：第一原理電子状態と量子輸送の接続
DFT-NEGFは、散乱領域と電極のハミルトニアン（および重なり行列）をDFTから得て、NEGFで透過・電流・電荷を求める枠組みである。典型的には局在基底（原子軌道、PAOなど）が相性が良い。平面波基底は電極の半無限境界との接続が難しく、ワニエ化によるtight-binding化を経由する構成がよく採られる。

代表的な実装・系統の例
- SIESTA/TranSIESTA系（DFT-NEGFの古典的流れ）
- OpenMXのNEGF実装（PAO基底、国内での利用・資料が豊富）
- tight-binding/ワニエHamiltonian＋NEGF（大規模化、トポロジカル材料の表面Green関数計算とも親和）

## 10. 計算手順
1. 電極の作成
- 電極の周期構造、格子定数、磁気状態を確定する
- 電極のバンドとフェルミ準位を安定に再現する

2. 散乱領域の作成
- 左右の電極主層を数層ずつ含め、界面でのミスマッチを緩和する
- 欠陥、分子、界面粗さ、磁性層などの本体を配置する

3. 電極自己エネルギーと表面Green関数
- 表面Green関数の収束（反復回数、数値安定化）を確認する

4. $G^r$ と $G^<$ の計算
- エネルギー積分メッシュ、スミアリング、$k_\perp$ メッシュ（横方向周期がある場合）を収束させる

5. 透過 $T(E)$、I–V、LDOS、局所電流の解析
- 共鳴透過、ギャップ内トンネル、界面状態、スピンフィルタ、磁気抵抗などに分解して解釈する

6. 必要ならPoisson自己無撞着
- ゲート、誘電体、ドーピングを含めて安定収束させる

## 11. 注意点
- 透過のエネルギー軸がずれる：電極と散乱領域で参照エネルギーが不整合である可能性が高い
- ゼロバイアスで非ゼロ電流：境界条件や数値積分の不整合（$f_L=f_R$ なのに電流が出るのは警戒）
- 透過がノイジー：$k_\perp$ メッシュ不足、電極主層の定義不良、表面Green関数の収束不足
- 電極を変えると結果が激変：接触モデルが支配している。散乱領域に電極主層を増やして接続を安定化させる
- DFTのギャップや準位配置が怪しい：DFTの近似（自己相互作用誤差、ギャップ過小）による。必要なら補正（ハイブリッド、$+U$、GW的補正、あるいはモデル化）を検討する

## 12. Kubo、Boltzmann、MDとの関係
- Kubo線形応答：微小外場の範囲で導電率を評価する枠組みであり、NEGFの線形化と連続的に接続する
- Boltzmann輸送：散乱を緩和時間近似などで実効的に入れる。平均自由行程が長い・準古典が成立する領域では強い
- NEGF：開放境界・量子干渉・トンネル・界面・非線形I–Vを自然に扱う
- 第一原理MD：構造揺らぎ・熱ゆらぎ・欠陥形成を扱い、得たスナップショットをNEGFに流し込んで温度平均輸送を評価する設計も可能である

## まとめ
NEGF（Keldysh形式）は、電極に接続された開放量子系の境界条件を自己エネルギーとして取り込み、$G^r$ が構造を、$G^<$ が占有を担うことで、透過・電流・非平衡電荷を一貫して与える理論である。コヒーレント輸送ではLandauer/Caroli形式へ簡約され、相互作用や非弾性効果も自己エネルギーとして拡張できるため、DFT-NEGFやPoisson-NEGFと結びついたナノスケール量子輸送の標準的基盤となる。

