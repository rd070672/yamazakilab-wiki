# 不連続ガラーキン法（DG）入門

不連続ガラーキン法（Discontinuous Galerkin; DG）は、要素内では高次多項式で近似しつつ、要素境界では数値流束で弱く結合する離散化枠組みである。保存則・波動・拡散・電磁場・弾性など、多様な方程式系を同じ設計原理で扱える点が特徴である。

## 参考ドキュメント
- D. N. Arnold et al., Unified Analysis of Discontinuous Galerkin Methods for Elliptic Problems, SIAM J. Numer. Anal. 39 (2002). 
  https://epubs.siam.org/doi/10.1137/S0036142901384162
- J. S. Hesthaven, T. Warburton, Nodal Discontinuous Galerkin Methods: Algorithms, Analysis, and Applications, Springer (2007/2008). 
  https://link.springer.com/book/10.1007/978-0-387-72067-8
- 千葉悠喜, 数値解析と不連続 Galerkin 法（講義ノート）(2017). https://ychiba.sakura.ne.jp/files/chiba_2017freshman.pdf
- COMSOL Blog（日本語）, 不連続ガラーキン（dG/dG-FEM）に関する解説（例：波動・圧電連成）. 
  https://www.comsol.jp/blogs/modeling-speaker-drivers-which-coupling-feature-to-use


## 1. 何が「不連続」なのか

### 1.1 位置づけ
DGは有限要素法（Galerkin法）の一種であるが、要素間で解の連続性を要求しない点が決定的に異なる。すなわち、近似空間を
$$
V_h = \{ v \in L^2(\Omega) \mid v|_K \in \mathbb{P}^p(K)\ \ \forall K\}
$$
のように、要素$K$ごとに独立な多項式空間の直和として選ぶ。

この「不連続性」により、以下が自然に実現される。
- 要素ごとの局所性：行列が要素ブロックに分解しやすく、並列化・GPU化に向く
- 境界条件の弱形式実装：境界でも内部境界でも同じ「数値流束」を使える
- 保存則との整合：有限体積法と同様に、要素境界流束で保存性を設計できる

一方で、要素間自由度が増えるため、連続FEMに比べて未知数は増えがちである。この増加分を、安定化・高次化・局所時間発展などの利点で回収する設計が鍵である。

### 1.2 起源
DGはもともと輸送方程式（特に中性子輸送）を念頭に、要素内局所近似と境界流束を組み合わせる発想として提案された。その後、非線形保存則、電磁波、流体、弾性波などの“波”を含む系で、高次精度と複雑形状適合を両立する手法として発展した。

## 2. 基本原理：弱形式と数値流束

### 2.1 保存則（双曲型）
スカラー保存則
$$
\partial_t u + \nabla \cdot \mathbf{f}(u) = s \quad (\mathbf{x}\in\Omega)
$$
を要素$K$上で試験関数$\varphi$と掛けて積分し、発散項を部分積分する：
$$
\int_K \partial_t u\,\varphi\,d\mathbf{x}
-\int_K \mathbf{f}(u)\cdot\nabla\varphi\,d\mathbf{x}
+\int_{\partial K} \mathbf{f}(u)\cdot\mathbf{n}\,\varphi\,ds
= \int_K s\,\varphi\,d\mathbf{x}.
$$

DGでは、要素境界$\partial K$での物理流束$\mathbf{f}(u)\cdot\mathbf{n}$を、両側のトレース値に依存する数値流束$\hat{\mathbf{f}}(u^-,u^+;\mathbf{n})$に置き換える：
$$
\int_K \partial_t u_h\,\varphi_h\,d\mathbf{x}
-\int_K \mathbf{f}(u_h)\cdot\nabla\varphi_h\,d\mathbf{x}
+\int_{\partial K} \hat{\mathbf{f}}(u_h^-,u_h^+;\mathbf{n})\,\varphi_h^-\,ds
= \int_K s\,\varphi_h\,d\mathbf{x}.
$$

ここで$u_h^-$は要素内側、$u_h^+$は隣接要素（または境界条件）から与えられる外側トレースである。境界条件も「外側状態$u^+$の与え方」と見なすと統一できる。

### 2.2 数値流束の設計指針
数値流束はDGの安定性・物理解釈・収束性を支配する。典型例を挙げる。

- 風上流束（upwind）：波が進む方向の情報を優先し、エネルギー安定性を得やすい
- 中心流束（central）：散逸が小さいが、安定化（ペナルティやフィルタ等）が必要になる場合がある
- Rusanov（LLF）流束：実装が簡単で頑健、最大波速$\alpha$を用いて
  $$
  \hat f = \frac{1}{2}(f(u^-)+f(u^+)) - \frac{\alpha}{2}(u^+-u^-)
  $$
  のように数値粘性を付与する

数値流束は「要素間での情報の伝達規則」であり、波動・輸送・電磁場・弾性波では、流束がそのまま境界での散逸と反射特性に結びつく。

## 3. 拡散・楕円型への拡張

DGは保存則向けという印象が強いが、拡散（2階微分）にも強力である。ただし、連続性を課さないため、2階微分をそのまま弱形式化すると不安定になりやすく、境界項の設計（ペナルティ、補助変数導入）が本質となる。

### 3.1 内部ペナルティDG
例として楕円型問題
$$
-\nabla\cdot(\kappa\nabla u)=f
$$
を考える。SIPG（Symmetric Interior Penalty Galerkin）では、要素内の勾配項に加えて、要素境界でのジャンプ（不連続量）にペナルティを課すことで一意性・安定性を確保する。

ジャンプ$[u]$と平均$\{ \cdot \}$を用いると、概念的には
- 直感：不連続な$u_h$に対して「境界で連続に近づくよう罰則を与える」
- 実際：ペナルティ係数$\sigma$の選び方が安定性と条件数を左右する

SIPGは、異方性熱伝導、静電場、弾性の弱形式など、材料中の楕円型支配方程式に広く適用できる。

### 3.2 Local Discontinuous Galerkin（LDG）
拡散を1階系に分解して扱うのがLDGである。例えば$q=\nabla u$を導入して
$$
q-\nabla u = 0,\qquad -\nabla\cdot(\kappa q)=f
$$
とし、各式にDG流束を与える。こうすると、双曲型DGと同じ流束設計思想で拡散項を構成できる。高次精度を保ちつつ、複雑境界形状や空間的に不連続な係数（多層膜、複合材料）に対応しやすい。

### 3.3 Hybridizable DG（HDG）
DGの自由度増加を抑える工夫として「面上の未知数だけを大域未知数にする」HDGがある。要素内部は局所問題として消去（静的縮約）し、要素境界（面）上の未知数のみを連立で解く。結果として
- 大域連立が小さく、前処理が組みやすい
- 応力・流束などの派生量が高精度に得られる設計が可能
となる。弾性、電磁、流体などの連成で有力である。

## 4. 時間積分と安定性

### 4.1 要素局所性と陽解法
DGでは質量行列が要素ごとに独立となる（ブロック対角）。特に適切な基底（例：節点基底＋GLL積分）では質量行列が対角近似（mass lumping）でき、陽的時間積分が高速化される。

典型的な半離散形は
$$
M_K \frac{dU_K}{dt} = R_K(U_K, U_{\text{neighbor}})
$$
であり、$M_K^{-1}$は要素内で完結する。

### 4.2 クーラン（Courant-Friedrichs-Lewy; CFL）条件
陽解法を用いる場合、時間刻みは概ね
$$
\Delta t \lesssim C \frac{h}{(2p+1)\,c_{\max}}
$$
のように、要素サイズ$h$、多項式次数$p$、最大波速$c_{\max}$に支配される。高次化で空間精度を稼ぐ一方、時間刻みが厳しくなるため、局所時間刻み（local time stepping）やIMEX、指数積分などの組み合わせが検討対象となる。

### 4.3 急峻勾配
保存則や相変態を含む系では急峻勾配が出現しやすい。DGは高次ゆえにギブズ的振動が出やすく、以下が重要となる。
- slope limiter（TVB limiterなど）：要素内多項式の高周波成分を制御
- WENO型再構成：局所的により滑らかな多項式へ置換
- positivity preserving：密度・濃度などの非負性を保つ補正
- shock capturing（人工粘性、filtering）

材料組織の鋭い界面（相場、濃度境界層）を扱う相分離モデルでも、同様の振動制御が計算品質を左右する。

## 5. 応用例

DGの強みは「要素境界での物理の出入り（流束）を、数値的に設計できる」ことである。したがって、界面・異方性・複雑境界が本質の系で効果が出やすい。

### 5.1 電磁場（時間領域Maxwell）
Maxwell方程式は1階の双曲型系としてDGと非常に相性が良い。誘電率テンソルや損失（導電率）を含む媒質でも、数値流束の選択でエネルギー安定性や吸収境界（PML等）との整合を設計できる。フォトニック結晶、メタマテリアル、異方性媒質での波動伝搬解析に活用される。

### 5.2 弾性・音響・超音波
弾性波動（音響も含む）は双曲型でありDGの主戦場である。多結晶・多層・空孔などの内部境界が多い系で、界面条件を弱形式で自然に扱える。圧電連成や音響放射などの連成問題でも、時間領域での高次解法として採用されることがある。

### 5.3 拡散・熱・輸送
熱伝導、拡散、イオン輸送などの楕円・放物型系では、係数の空間不連続（界面熱抵抗、複合材料、層状構造）が本質となる。IPDG/LDG/HDGは、界面条件と保存性（熱流束/物質流束）を両立する設計が可能である。

### 5.4 相場・界面（フェーズフィールド）
Cahn–HilliardやAllen–Cahn型の界面モデルは高階微分や強い勾配を含み、安定な空間離散化が重要である。DGは高次化と局所性を保ちながら、エネルギー安定な時間離散（SAV、IEQ等）と組み合わせて発展している。

### 5.5 放射線・輸送
中性子輸送・放射線輸送はDGが生まれた背景であり、多群輸送や複雑形状での角度離散（SN法等）とも相性が良い。材料照射環境の輸送解析や、遮蔽・検出器応答などの周辺分野にも接続する。

## 6. 大規模計算に向けた指針

### 6.1 行列構造と計算カーネル
DGの計算は「要素内積分（体積項）」と「面積分（数値流束）」に分かれる。どちらも局所演算の集合であり、以下の最適化が効きやすい。
- matrix-free（行列を組まず作用のみ評価）
- 要素テンソル積（hex要素DGSEMなど）による演算削減
- GPU向けカーネル分解（体積・面の分離、共有メモリ活用）

### 6.2 hp適応と誤差推定
DGは$p$（次数）と$h$（メッシュ）を局所的に変えやすい。界面近傍だけ高次化、欠陥近傍だけ細分化といった戦略がとりやすく、材料不均一場で計算資源を集中できる。誤差推定には残差ベースや双対問題ベースが使われる。

### 6.3 連成問題への拡張
Maxwell–熱–弾性、流体–構造、拡散–反応など、連成では時間スケール・空間スケールが混在する。DG/HDGは、場ごとに異なる基底・次数を選びやすく、界面条件は流束として統一的に書き下せるため、連成設計に向く。

## 7. どれを選ぶか：DGファミリーの早見表

| 方程式タイプ | 目的 | 代表DG | 典型キーワード |
|---|---|---|---|
| 双曲型（保存則・波動） | 高次精度＋安定 | RKDG, DGTD, DGSEM | upwind flux, Riemann solver, limiter |
| 楕円型（静電・熱伝導・弾性静力学） | 安定＋条件数制御 | SIPG/IPDG, HDG | penalty, coercivity, preconditioner |
| 放物型（拡散） | 高次＋局所性 | LDG, SIPG | auxiliary variable, numerical flux |
| 高階（Cahn–Hilliard等） | 界面精度＋安定 | DG + エネルギー安定時間離散 | SAV/IEQ, energy stability |

## 8. 確認ポイント

- DGは「要素境界で不連続」だが、物理的に不連続な解を作るわけではない。連続解を持つ問題でも、数値的には不連続近似で表現し、整合的に収束させる枠組みである。
- 安定性は、流束設計（双曲型）とペナルティ設計（楕円型）の2本柱で決まる。
- 高次化は万能でなく、急峻勾配や不連続近傍ではリミッタやshock capturingの併用が必要である。
- 大規模化では、HDG（縮約）とmatrix-free（作用評価）をどう使い分けるかが効く。

## まとめ
不連続ガラーキン法は、要素内の高次近似と要素境界の数値流束を核として、保存性・安定性・局所性を同時に設計できる離散化枠組みである。波動・輸送・拡散・電磁場・弾性・界面モデルへと一貫した考え方で拡張でき、さらにHDGやhp適応、matrix-free実装と結びつくことで大規模計算にも展開しやすい手法体系である。

