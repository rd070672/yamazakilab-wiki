# ワニエ関数と局在軌道

ワニエ関数（Wannier Function）は、第一原理計算で得られるブロッホ状態を、実空間で局在した基底へと変換する枠組みである。バンド構造の再現性を保ったまま、低エネルギー有効模型やベリー位相由来の物性を扱える点が中核である。

## 参考ドキュメント
- N. Marzari et al., Maximally localized Wannier functions: Theory and applications, Reviews of Modern Physics 84, 1419 (2012)
  https://link.aps.org/doi/10.1103/RevModPhys.84.1419
- Wannier90 Documentation
  https://wannier90.readthedocs.io/
- （日本語）是常グループ Practical QE tutorial: 最局在ワニエ関数
  https://www.cmpt.phys.tohoku.ac.jp/~koretsune/SATL_qe_tutorial/wannier.html


## 1. 位置づけ
周期系の電子状態はブロッホ関数で表される一方、化学結合・局所軌道・低エネルギー模型の議論では局在基底が便利である。ワニエ関数はこのギャップを埋め、以下を同一の枠組みで可能にする。

- 実空間で局在した軌道（結合様式、局所的な電荷中心）の可視化
- 第一原理バンドを再現するタイトバインディング（TB）模型の構築
- ベリー曲率・分極・軌道磁化など、位相的量の高効率計算（ワニエ補間）

## 2. ブロッホ状態のゲージ自由度とワニエ変換
結晶のブロッホ関数を
$$
\psi_{n\mathbf{k}}(\mathbf{r})=e^{i\mathbf{k}\cdot\mathbf{r}}u_{n\mathbf{k}}(\mathbf{r})
$$
とする。ワニエ関数は、ブロッホ状態の線形結合を逆フーリエ変換したものである。

離散k点（点数 $N_k$）では
$$
|w_{n\mathbf{R}}\rangle=\frac{1}{N_k}\sum_{\mathbf{k}}e^{-i\mathbf{k}\cdot\mathbf{R}}
\sum_{m=1}^{J}U_{mn}(\mathbf{k})|\psi_{m\mathbf{k}}\rangle
$$
で定義される。ここで $U(\mathbf{k})$ は、対象とするバンド部分空間内のユニタリ変換であり、位相（単一バンド）やバンド混合（複数バンド）の自由度を含む。ワニエ関数はこのゲージ選択に依存するため、目的に沿ったゲージ固定が実務上の要点である。

## 3. 最大局在ワニエ関数（MLWF）
Marzari–Vanderbiltの流儀では、ワニエ関数の空間的広がり（スプレッド）を最小化して、物理的に解釈しやすい局在軌道を得る。代表的な汎関数は
$$
\Omega=\sum_n\left(\langle r^2\rangle_n-|\langle\mathbf{r}\rangle_n|^2\right)
$$
である。最小化により、同一のバンド部分空間から「よく局在した」代表元が選ばれる。

補足：実装では隣接k点の重なり行列
$$
M_{mn}^{(\mathbf{k},\mathbf{b})}=\langle u_{m\mathbf{k}}|u_{n,\mathbf{k}+\mathbf{b}}\rangle
$$
から $\Omega$ の勾配を評価し、$U(\mathbf{k})$ を反復更新するのが典型である。

## 4. バンドが絡む場合
金属やバンド交差がある系では、目的の低エネルギー部分空間が他のバンドと混成する。Souza–Marzari–Vanderbiltの手法では、まず「外側窓（outer window）」内で最適な部分空間を選び、次に「内側窓（inner/frozen window）」では再現を確実に固定する、という二段階で扱う。

実務的には以下が設計変数である。
- 何本のワニエ軌道（num_wann）で表現したいか
- 再現を厳密に保証したいエネルギー領域（内側窓）
- その外側で許容する混成領域（外側窓）
- 初期射影（どの原子軌道・対称性を種にするか）

窓と初期射影の選択が、局在性・物理解釈・補間精度を同時に左右する。

## 5. ワニエ基底でのハミルトニアンと行列要素
ワニエ基底が得られると、第一原理の低エネルギー有効模型として
$$
H_{nm}(\mathbf{R})=\langle w_{n\mathbf{0}}|\hat{H}|w_{m\mathbf{R}}\rangle
$$
が得られる。これをフーリエ変換して
$$
H_{nm}(\mathbf{k})=\sum_{\mathbf{R}}e^{i\mathbf{k}\cdot\mathbf{R}}H_{nm}(\mathbf{R})
$$
とすれば、密なk点上でバンドを高速に補間できる（ワニエ補間）。さらに、位置演算子や速度演算子に相当する行列要素を整備すると、ベリー曲率や輸送係数などの評価が可能になる。

## 6. 目的別

| 目的 | ワニエ化の役割 | 典型アウトプット |
|---|---|---|
| 低エネルギーTB模型 | 有効軌道・ホッピングの抽出 | $H_{nm}(\mathbf{R})$, 近接ホッピングの可視化 |
| 物性のワニエ補間 | 密k点が必要な量を高速評価 | フェルミ面、ベリー曲率、AHE/スピンホール等 |
| 分極・電荷中心 | ワニエ中心で幾何学的量を表現 | $\langle\mathbf{r}\rangle_n$（ワニエ中心） |
| 結合の理解 | 局在軌道の形状・中心・広がり | ワニエ関数の実空間可視化、スプレッド $\Omega$ |
| 相関模型への橋渡し | DFT → 有効模型（DMFT等） | 低エネルギー部分空間の定義、射影の品質管理 |

## 7. 分極とワニエ中心
絶縁体では、電子分極の変化がベリー位相として定義でき、物理的には「ワニエ中心（電荷中心）の移動」と解釈できる。概念図としては
$$
\Delta\mathbf{P}\ \leftrightarrow\ \text{占有ワニエ中心の総和の変化}
$$
という対応が成立する（分極は定義の剰余を持つ点に注意が必要である）。

強誘電体・圧電体・界面電荷など、周期境界下での電気的量を扱う際に、ワニエ中心は実務上の強い直観を与える。

## 8. 注意点
- スピン軌道相互作用（SOC）がある場合、スピノル波動関数に基づくワニエ化が必要であり、射影もスピンを含む形に整合させる必要がある。
- 局在化を優先すると、対称性が自発的に破れる見かけが出る場合がある。必要に応じて対称性を意識した射影や、出力の対称性チェックが必要である。
- ワニエ関数は観測量ではなく表現である。軌道の形やヘッドごとの分担のような解釈と同様、過剰な因果解釈は避け、再現性（バンド一致、物性値の一致）で担保するのが実務的である。

## 9. チェックリスト
1. 参照したいバンド範囲で、ワニエ補間バンドが第一原理バンドと一致しているか
2. スプレッド $\Omega$ が異常に大きくないか（局在性の不良）
3. Disentanglementの窓設定が目的（低エネルギー物理）と整合しているか
4. 射影（初期guess）が対象の軌道対称性と整合しているか
5. SOC・磁性・PBCなど、計算条件とワニエ化の前提が一致しているか

## まとめ
ワニエ関数は、第一原理計算のブロッホ状態を局在基底へ写像し、低エネルギー模型化と幾何学的物性評価を同時に駆動する基盤である。窓設定・射影・対称性の扱いを設計変数として管理し、再現性チェックを通してモデルの妥当性を担保するのが要点である。


