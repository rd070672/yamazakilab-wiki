# AkaiKKR（KKR-CPA）による不規則系電子状態計算

AkaiKKRは、KKRグリーン関数法とCPAを組み合わせ、置換合金・混晶・不純物系などの電子状態と磁性を小さな基本セルのまま効率よく評価する第一原理コードである。組成や不規則性を連続パラメータとして掃引できる点が強みである。

## 参考ドキュメント
- AkaiKKR(Machikaneyama) 公式サイト（日本語）
  https://kkr.issp.u-tokyo.ac.jp/jp/
- KKR-Green関数法によるバンド計算（日本語マニュアルPDF）
  https://kkr.issp.u-tokyo.ac.jp/jp/document/akaikkr_j.pdf
- T. Fukushima et al., Phys. Rev. Materials 6, 023802 (2022)（AkaiKKRを用いた大規模自動計算の例）
  https://link.aps.org/doi/10.1103/PhysRevMaterials.6.023802

## 1. AkaiKKRは何を解くのか
対象は一電子近似のKohn–Sham方程式であり、電子密度から有効ポテンシャルを自己無撞着に決める問題である。
本質は「波動関数を直接並べる」よりも「グリーン関数 $G(E)$ を直接求める」定式化にあり、特に不規則系の平均化と相性が良い。

Kohn–Sham方程式
$$
\left[-\frac{1}{2}\nabla^2 + V_{\mathrm{eff}}(\mathbf{r})\right]\psi_{n\mathbf{k}}(\mathbf{r})
= \varepsilon_{n\mathbf{k}}\psi_{n\mathbf{k}}(\mathbf{r})
$$

グリーン関数の定義
$$
\left[E - \hat{H}_{\mathrm{KS}}\right]G(\mathbf{r},\mathbf{r}';E)=\delta(\mathbf{r}-\mathbf{r}')
$$

状態密度（DOS）はグリーン関数から直接得られる。
$$
D(E) = -\frac{1}{\pi}\,\mathrm{Im}\,\mathrm{Tr}\,G(E)
$$

## 2. KKR法の骨格：多重散乱としての電子状態
KKR法は、結晶を「格子点ごとの散乱中心（原子サイト）」の集まりとして捉え、各サイトの散乱（t行列）と、サイト間伝播（構造定数）を組み合わせて全系の応答を構成する方法である。

代表的な行列形式
- 各サイトの散乱：$t(E)$
- 幾何学（格子）に由来する結合：$G_0(E)$（structure constants）
- 多重散乱の集約：散乱パス演算子（scattering path operator）$\tau(E)$

典型的な関係式（概念）
$$
\tau(E) = \left[t^{-1}(E) - G_0(E)\right]^{-1}
$$

この枠組みにより、周期系だけでなく「不純物を埋め込む」「表面・界面を扱う」「不規則性を平均化する」といった拡張が自然に入る。

## 3. CPA：置換不規則の平均化
置換不規則合金 $A_{x}B_{1-x}$ のように、同一サイトに複数元素が確率的に入る系では、スーパーセルを巨大化して乱数配置を平均する手もあるが、計算は重い。

CPA（Coherent Potential Approximation）は、実在の不規則系を「有効媒質（coherent medium）」で置き換え、媒質中に各成分原子を埋め込んだときの平均散乱がゼロになるように媒質を自己無撞着に決める近似である（単一サイトCPAが基本である）。

CPA条件の典型的表現
$$
\langle T(E)\rangle = 0
$$
ここで $T(E)$ は媒質からの散乱子であり、平均がゼロになるように媒質（有効ポテンシャル）を定める。

AkaiKKRでは、各サイトに対して「元素種と濃度（確率）」を指定でき、合金・混晶・空孔（空サイト）・希薄不純物などを小セルのまま扱える。

## 4. 磁性・相対論の取り扱い
AkaiKKRの実務上の出番はスピン分極計算とCPAの併用に多い。
- 強磁性状態（スピン分極SCF）
- 元素置換に伴う局所モーメント・全磁化の変化
- パラ磁性の近似としてのLMD/DLM（局所モーメント不規則）概念の利用（実装や入力の流儀は配布版・設定に依存）

相対論効果としては、スカラー相対論やスピン軌道相互作用（SOC）を取り込み、磁気異方性などのSOC起源量に接続する構成が取られることがある。

## 5. 何が出力として得られるか
| 出力 | 典型的な用途 | 不規則系での特徴 |
|---|---|---|
| 全エネルギー・体積依存 | 格子定数の推定、組成依存の安定性比較 | 組成を連続に掃引しやすい |
| 磁気モーメント（全体・サイト別） | スレータ・ポーリング曲線、局所モーメントの追跡 | CPAで平均化した局所量が得やすい |
| DOS / partial DOS | 合金化でのバンド充填、スピン分極、擬ギャップの検出 | 成分・サイト分解が有用 |
| 分散 / スペクトル関数 $A(\mathbf{k},E)$ | バンドの広がり、乱れによる寿命（幅） | 乱れに起因するバンドの“にじみ”を表現できる |

ブロッホスペクトル関数の一例（概念）
$$
A(\mathbf{k},E) = -\frac{1}{\pi}\,\mathrm{Im}\,\mathrm{Tr}\,G(\mathbf{k},E)
$$
（不規則系では $A(\mathbf{k},E)$ がデルタ関数的でなく幅を持つことが多い。）

## 6. ワークフロー
1. 結晶構造（格子・サイト）を決める  
2. 各サイトに元素成分と濃度を割り当てる（CPA入力の核）  
3. SCF条件（交換相関、エネルギー積分、収束条件など）を決める  
4. SCFを回す：電荷密度・有効ポテンシャルの自己無撞着化  
5. 物性計算：DOS、分散、磁化、組成掃引などを実行  
6. 収束性・系統誤差を点検する（k点、エネルギーメッシュ、角運動量 $l_{\max}$、SOC設定など）

## 7. 注意点
- 単一サイトCPAは短距離秩序（SRO）や局所歪みを直接には表現しにくい  
  - SROが重要な場合は、クラスターCPA系（NLCPAなど）やスーパーセル平均も検討対象である  
- 置換不規則に強い一方、原子位置緩和や無秩序な原子配置そのものの表現には別系統（大規模スーパーセルDFT、機械学習ポテンシャル等）が要る場合がある  
- 入力で扱う“サイト”の設計（空孔を空サイトとして置く、等価サイトの分割など）が結果の解釈を左右する  
- SOCや磁気異方性など微小量は数値設定依存性が強く、再現性のために計算条件の明示が必須である  

## 8. 適用事例
- Fe–Co、Fe–Ni、Heusler合金などで、組成に対する磁化・DOS・スピン分極の系統解析  
- 希薄ドープ（半導体への遷移金属添加など）で、局在準位や磁性発現の条件探索  
- 不純物・空孔が支配する電子散乱の評価（輸送理論と接続する場合は別途Kubo系の実装が関与する）

## まとめ
- AkaiKKRは、KKRグリーン関数法とCPAにより、置換不規則を含む系の電子状態と磁性を小セルで高速に扱う枠組みである。  
- 実務では「サイト設計」「CPA入力（濃度）」「数値条件（エネルギー積分・$l_{\max}$・SOC 等）」が結果の妥当性を支配する。  
- 単一サイトCPAの限界（短距離秩序、局所歪みなど）を意識し、必要に応じて手法を組み合わせるのが現実的である。

