# 仮想結晶近似（VCA） 

VCA（Virtual Crystal Approximation）は、置換不規則合金やドープ系を「平均化された仮想原子」で近似し、単位胞サイズのまま組成依存を連続的に掃引するための手法である。VASPではINCARのVCAタグにより、POTCAR内の各元素データセットへ重み付けを施す形で実装されている。

## 参考ドキュメント
- VASP Wiki: VCAタグ（公式）
  https://vasp.at/wiki/VCA
- L. Bellaiche and D. Vanderbilt, Phys. Rev. B 61, 7877 (2000)（VCAに関する基礎論文）
  https://doi.org/10.1103/PhysRevB.61.7877
- MateriApps アプリコンシェルジュ: 混晶の第一原理計算（VCA/CPA/SQSの位置付け、日本語）
  https://ma.issp.u-tokyo.ac.jp/concierge/2517

## 1. VCAとは何か
置換合金 $A_{1-x}B_x$ の「不規則配置」を直接扱う代わりに、同一サイトを占有する原子ポテンシャルを組成で平均化し、周期性を保ったまま計算する近似である。

概念的には、外場・ポテンシャルを線形混合した仮想原子を考える：
$$
V_{\mathrm{VCA}}(\mathbf{r};x) \approx (1-x)\,V_A(\mathbf{r}) + x\,V_B(\mathbf{r})
$$

この近似により、(i) ランダム配置の統計平均、(ii) 配置に由来する散乱（寿命・バンド幅の増大）、(iii) 局所歪みや短距離秩序（SRO）などは本質的に捨象される。従って、VCAは「組成トレンドを軽量に掴む」ための近似として位置付けるのが実務的である。

## 2. VASPでのVCA実装の考え方
### 2.1 VCAタグがしていること
VASPのVCAは、POTCARに含まれる各元素データセットを、INCARで与えた重みでスケールする実装である。具体的には、形式価（valency）、局所ポテンシャル、PAWの補償電荷（augmentation charges）、非局所項の強度パラメータなどが重みに応じてスケールされる。

- species（POTCARの並び）ごとに重みが必要である
- 既定値は 1（またはPOTCAR側に記録された値）である

### 2.2 入力ファイル設計の基本
VASPのVCAでは「混ぜたい元素のPOTCARを並べる」だけでは足りず、POSCAR側でも対応するspeciesを用意する必要がある。代表的な考え方は次の通りである。

- POTCARには、混合に用いるAとBのデータセットを両方入れる
- POSCARでは、同一の格子点（同一座標）にAとBを重ねて置く
- INCARで VCA = (1-x)  x のように重みを与える
- 重みの和が 1 になるように設計する（仮想原子1個としての整合性のため）

例（概念、Ge格子にSnをxだけ混ぜる場合の最小イメージ）
- POTCAR: Ge と Sn のデータセットをこの順で連結する
- POSCAR: Ge と Sn の原子座標を同一位置に重ねて記述する（同じ座標が2回出る）
- INCAR: VCA = 1-x  x

重要なのは、これは「2種類の原子が同位置に存在する」ことを物理的に意味しているのではなく、仮想原子を作るための入力上の書法である点である。

### 2.3 サイト選択性（どの副格子だけ混ぜたいか）
VCAの重みはspecies単位で作用するため、特定の副格子だけ混ぜたい場合は、POSCAR／POTCARで副格子ごとにspeciesを分けて用意する設計が必要になる。例えば同じ元素データセットを複数回POTCARに入れ、POSCAR側で別speciesとして認識させ、VCAの値を別々に与える、という発想である（ファイル整合性の管理が要点である）。

## 3. どんな用途に向くか
### 3.1 向く用途
- 組成に対する磁化・局所モーメントの粗いトレンド把握
- バンド充填（フェルミ準位移動）やDOS形状の連続的変化の俯瞰
- 多数組成のスクリーニング（探索の一次フィルタ）

### 3.2 向かない用途
- 不規則散乱が本質となる輸送（抵抗率、寿命、合金散乱）を定量したい場合
- 局所歪み・短距離秩序・クラスター化が物性を支配する場合
- 大きく異なる原子半径や価電子構成の混合で、平均化が破綻しやすい場合

## 4. PAWポテンシャル選択と信頼性の要点
VASPのVCAは便利である一方、計算が不安定・不自然になる主原因がある。

- 混合するPAWデータセットの擬原子波動関数が十分に似ていないと、結果が不安定・非現実的になりやすい
- 2つの局所ポテンシャルが十分に似ている必要がある
- 半芯（semicore）を価電子に入れる／入れないの扱いが両者で異なると破綻しやすい
- Vegard則（格子定数の線形則）が近似的にすら満たされないケースがある

従って、混合候補元素は「電子状態の骨格が似ている」「同等のポテンシャル設計（半芯の扱い等）」を優先するのが定石である。

## 5. 構造最適化・フォノン・有限差分に関する制約
- VCAは、二次微分（Hessian、フォノン）を直接計算する一部手法と両立しない場合がある
- 重ね書きした仮想原子の内部自由度は物理的実体がないため、原子位置緩和の解釈は慎重である

実務的には、(i) 格子定数を数点掃引して最小を取る、(ii) 内部座標の自由度が少ない系で使う、(iii) 重要点はスーパーセル法で検証する、といった運用が安全である。

## 6. VCA結果の検証
1. 端点整合性
   - x=0 がAの通常計算、x=1 がBの通常計算と整合するか確認する
2. 格子・体積の妥当性
   - 体積が中間組成で過大・過小になっていないか（Vegard則からの逸脱が極端でないか）を見る
3. 代表組成でのクロスチェック
   - x=0.25, 0.5, 0.75 などでSQS／ランダム配置スーパーセル平均と比較する
4. 物理量ごとの感度評価
   - 磁性（初期磁化、スピン分極）や収束パラメータ（k点、スメアリング）に対して頑健か確認する

## 7. VCA以外の代替手法
| 目的 | 代替アプローチ | 代表的な利点 |
|---|---|---|
| 局所歪みと不規則配置を入れたい | スーパーセル + ランダム配置平均 | 物理を素直に入れられる |
| 少数スーパーセルで統計を近づけたい | SQS（special quasirandom structure） | 低コストで相関関数を再現しやすい |
| 不規則散乱や平均化をより厳密に | CPA（例: KKR-CPA） | VCAより高精度が期待できる領域がある |
| 相安定性と秩序化を統計的に | クラスター展開 + MC | SROや相分離を扱える |

VCAは「速いが粗い」一次スクリーニングに置き、結論が重要な点を上記手法で詰める設計が現実的である。

## まとめ
- VASPのVCAは、POTCAR内の各speciesをINCARのVCA重みでスケールし、仮想原子として平均ポテンシャル計算を行う仕組みである。  
- 強みは、単位胞のまま組成を連続的に掃引できる点にある一方、PAWデータセットの相性や半芯の扱いに強く依存し、結果が不安定・不自然になることがある。  
- 端点一致、体積の妥当性、代表組成でのスーパーセル比較などをセットにして、VCAを探索と検証のワークフローに組み込むのが要点である。
