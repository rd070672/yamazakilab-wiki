# パーシステントホモロジー（Persistent Homology）入門

## 参考にしたドキュメント
- 位相的データ解析入門 ― パーシステント ホモロジーの基礎と応用 ―  
  https://www.chino-js.com/ja/tech/tda/
- I. Obayashi, “Persistent Homology Analysis for Materials Research”, J. Phys. Soc. Jpn. 91, 091013 (2022).  
  https://arxiv.org/pdf/2112.03610

## 1. パーシステントホモロジーとは何か

- パーシステントホモロジーは、  
  データの「形（トポロジー）」をマルチスケールに解析するための手法であり、  
  トポロジカルデータ解析（Topological Data Analysis, TDA）の中核的な道具である。
- ざっくり言うと：
  - 「データから作った図形」を、スケール（しきい値）を連続的に変えながら眺め、
  - その間に現れたり消えたりするトポロジカルな特徴（連結成分・穴・空洞など）を追跡し、
  - それを「バーコード」や「パーシステンス図」として定量化する手法。


## 2. 基本的なアイデア

### 2.1 データから図形（単体複体）へ

- 多くの場合、入力は点群データやネットワークなど：
  - 例）$\mathbb{R}^d$ 上の点群、距離行列、グラフ。
- そこから「単体複体（simplicial complex）」を構成する：
  - Čech 複体、Vietoris–Rips 複体、α-複体など。
  - 直感的には、「点同士が一定距離以内なら辺を結ぶ」「3 点が互いに近ければ三角形を張る」…というルールで、
    点群から高次元のポリゴン（単体）を貼っていく操作。

### 2.2 フィルトレーション（filtration）

- しきい値（スケール）パラメータ $ \epsilon $ を変えながら複体を作ると、
  $$
  K_{\epsilon_1} \subseteq K_{\epsilon_2} \subseteq \dots
  $$
  のような「入れ子構造（フィルトレーション）」が得られる。
- 小さいスケールではバラバラなクラスタが多く、
  スケールが大きくなるにつれてクラスタがつながり、穴が生まれ、やがて潰れていく――  
  この「生まれてから消えるまで」の履歴を追跡するのがパーシステントホモロジー。

### 2.3 ホモロジーと「穴」の次元

- 次元 0：連結成分（クラスタ）  
- 次元 1：1 次元の穴（ループ、トンネル）  
- 次元 2：2 次元の空洞（球殻の内側の空間）  
… といった「穴」の情報を、ホモロジー群を通じて定式化し、そのスケール依存性を見る。  


## 3. バーコードとパーシステンス図

### 3.1 バーコード（barcode）

- 各ホモロジー類（それぞれの穴）について、
  - 生まれたスケール：birth
  - 消えたスケール：death
  を計算し、その区間 $[ \text{birth}, \text{death} )$ を横棒（バー）として描いた図が「バーコード」。
- 長いバー：
  - 広いスケールで生き残る特徴 → より「本質的」な構造と解釈されやすい。
- 短いバー：
  - ノイズ的な構造／局所的なゆらぎであることが多い。  

### 3.2 パーシステンス図（persistence diagram）

- バーコードを 2 次元平面上の点集合として描いたもの：
  - 横軸：birth、縦軸：death
  - 1 本のバー $[b, d)$ に対して点 $(b, d)$ を配置。
- パーシステンス図は、バーコードと同じ情報を持ちながら、
  - ワッサースタイン距離、ボトルネック距離など、
    図同士の距離を定義しやすい点が利点。  


## 4. 典型的なワークフロー（TDA の文脈）

1. データの準備
   - 点群（原子座標、時系列の埋め込み、画像の特徴ベクトルなど）
   - 距離行列あるいは類似度行列

2. 単体複体の構成
   - Vietoris–Rips 複体：距離が $\epsilon$ 以下の点集合に単体を貼る
   - α-複体：Voronoi 図＋球の交差を使う（幾何的に忠実だが実装はやや重い）  

3. フィルトレーションの設定
   - $\epsilon$ を離散的な値 $\epsilon_0 < \epsilon_1 < \dots < \epsilon_n$ で走査し、
     複体列 $K_{\epsilon_0} \subseteq \dots \subseteq K_{\epsilon_n}$ を作る。

4. パーシステントホモロジーの計算
   - 単体複体の境界行列をガウス消去的に簡約し、
     「いつ生まれ、いつ消えるか」を求めるアルゴリズム。  

5. バーコード／パーシステンス図の可視化と特徴量化
   - 長いバーの数、分布、距離などを統計量や機械学習の特徴量として利用。
   - Persistence landscape, persistence image などにベクトル化する手法も利用される。  

6. 解釈
   - 何次元の穴が、どのスケールで出現しているかを物理・材料・ネットワークなどの文脈に結びつけて解釈する。


## 5. 応用例のスケッチ

- 材料科学：
  - 原子配置やボロノイ構造、ボロノイ体積の分布などから、  
    配列の「局所秩序・中距離秩序」をパーシステントホモロジーで特徴づける研究が多数。  
- 画像・形状解析：
  - 画像の濃度関数から超レベル集合を作り、  
    そのトポロジカルな変化を解析することで特徴量を抽出。  
- 時系列解析：
  - 時系列を埋め込み（Takens 埋め込みなど）して得た軌道点群に PH を適用し、  
    周期性や準周期性、カオスのトポロジカル特徴を解析。  
- グラフ・ネットワーク：
  - グラフを clique 複体に変換し、  
    次元 1 の穴（ループ）や高次の空洞を解析することで、  
    ネットワークの局所構造とグローバル構造を同時に見る試み。  


## 6. ベクトル化・統計解析との橋渡し

- パーシステンス図／バーコードは「点の集合」なので、そのままでは機械学習モデルに入れにくい。
- 代表的なベクトル化手法：
  - Persistence landscape（P. Bubenik）  
  - Persistence image
  - パーシステンス曲線、パーシステンスエントロピー など。
- これらは、
  - パーシステンス図を関数空間や有限次元ベクトル空間に埋め込むことで、
  - 線形モデル、カーネル法、ディープラーニングなどと自然に組み合わせるための道具。


## 7. 実装とソフトウェア

- 代表的なライブラリ・ソフトウェア：
  - Gudhi（C++/Python ライブラリ）  
  - Ripser（高速 Vietoris–Rips PH）
  - Dionysus, PHAT など
  - Python の高レベルラッパー：giotto-tda など  
- 一般的な流れ：
  - Python で点群や距離行列を用意 → Gudhi/Ripser で PH 計算 →  
    得られたバーコードを可視化・ベクトル化 → scikit-learn / PyTorch 等で学習。


## 8. まとめ

- パーシステントホモロジーは、
  - 「スケールを変えながらデータの形を追跡し、その変化をバーコードにする」もの。
- ノイズに対して比較的ロバストで、
  - 「本当に重要な構造だけが長く生き残る」という考え方が、  
    様々な分野の特徴抽出と相性が良い。
- 一方で、
  - フィルトレーションの設計（どの複体・どの距離を使うか）
  - バーコードの解釈（物理的意味づけ）
  が応用上の肝となるため、
  - トポロジーの数学＋対象分野の物理・材料・データの知識を組み合わせることが重要になる。
