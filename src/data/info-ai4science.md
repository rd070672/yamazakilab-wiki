# AI for Science（AI4S）

AI4Scienceは、AIを単なる予測器として使うのではなく、実験・計算・理論を往復しながら仮説と設計空間を更新し続け、研究サイクルそのものの速度と到達点を変える枠組みである。材料分野では、多様な観測（構造・スペクトル・顕微像・プロセス履歴）と多階層の物理（電子—格子—欠陥—組織）を接続する設計が要点である。

## 参考ドキュメント
- 文部科学省: AI for Science / 概念と方向性（PDF, 日本語）
  https://www.mext.go.jp/content/20251006-mxt_jyohoka01-000045188_01.pdf
- NIMS/JST: 組成傾斜薄膜に対応したAIベース自律材料探索システムを開発（日本語）
  https://www.nims.go.jp/press/2025/11/202511200.html
- Nature: A generative model for inorganic materials design（MatterGen, English）
  https://www.nature.com/articles/s41586-025-08628-5

## 1. AI4Scienceとは何か
AI4Science（AI for Science）は、データから相関式を作ることに留まらず、観測・計算・学習・提案・検証を一体として回し、科学的理解と設計探索を同時に前進させる考え方である。材料研究でこれが重要になる理由は、  
- (i) 設計変数が高次元であること、
- (ii) 計算・実験コストが高くデータが希薄になりやすいこと、
- (iii) 物理制約（対称性、保存則、熱力学整合、化学結合の妥当性）が強いこと、
- (iv) 測定が多モードであること、  
にある。

ここでの目標は、単発の予測精度ではなく、次の計算・次の測定・次の仮説更新へ自然につながる「循環」を作ることにある。その循環は、次の抽象形で書ける。

- 仮説（モデル集合 $\mathcal{M}$ と設計空間 $\mathcal{X}$ の定義）
- 提案（次に調べる点 $x\in\mathcal{X}$ の選択）
- 検証（実験・計算で観測 $y$ を得る）
- 更新（$\mathcal{M}$ と不確かさ、探索方針を更新）

このときAIは、推定器・生成器・最適化器・情報統合器の複数の役割を担う。

## 2. 材料研究に固有の難しさを式で捉える
材料の探索はしばしば制約付き最適化として書ける。

$$
\max_{x\in\mathcal{X}} \; f(x)
\quad \text{s.t.}\quad
g_k(x)\le 0,\; h_\ell(x)=0
$$

ここで $x$ は組成・結晶構造・欠陥・組織・プロセス条件などの集合であり、$f(x)$ は性能（強度、導電率、磁性、触媒活性、安定性など）である。制約 $g_k,h_\ell$ は、熱力学・電荷中性・結晶学的整合・合成可能性・安全性・資源制約などに対応する。

現実には $f(x)$ は高価な評価（第一原理計算やビームタイム測定）でしか得られないことが多い。したがって、代理関数 $\hat{f}_\theta(x)$（学習モデル）と不確かさ $\hat{\sigma}(x)$ を用いて、少数試行で効率よく情報を増やす設計になる。

## 3. 表現（representation）: 何を入力として定義するか
材料を表す方法は目的により異なる。ここでは、入力の設計がモデル選択以上に支配的になることが多い点を強調する。

### 3.1 組成・結晶構造の表現
最も基本的な表現の一つは、原子をノード、近接関係をエッジとするグラフ $G=(V,E)$ である。ノード特徴 $x_i$（元素種、価電子数、電気陰性度埋め込みなど）と、エッジ特徴 $e_{ij}$（距離、方向、近接殻、周期境界の結合など）を導入する。

メッセージパッシング型の基本形は

$$
m_i^{(t+1)}=\sum_{j\in\mathcal{N}(i)} \phi_m\!\left(h_i^{(t)}, h_j^{(t)}, e_{ij}\right),
\qquad
h_i^{(t+1)}=\phi_h\!\left(h_i^{(t)}, m_i^{(t+1)}\right)
$$

であり、最終的に結晶全体の表現 $z=\rho(\{h_i^{(T)}\})$ から物性を回帰・分類する。

回転・並進・原子の入れ替えに対して矛盾しないためには対称性の扱いが重要である。特に回転に関しては、等変（equivariant）の条件

$$
f(R\mathbf{r})=R f(\mathbf{r})
$$

（$R$ は回転）を満たす設計が力やテンソル量の学習で効く。磁性や格子歪みに関わるテンソル量（応力、磁気異方性、磁気弾性定数など）は、スカラー回帰の延長ではなく、変換則を持つ量として取り扱う方が自然である。

### 3.2 スペクトル・回折・顕微像の表現
XRD、XAFS、XMCD、RIXS、ARPESなどのスペクトルは、一般にエネルギー（または散乱ベクトル）軸の関数として

$$
s(\omega)\in\mathbb{R}^{N}
$$

のベクトルとして扱える。前処理（規格化、ベースライン補正、エネルギー較正）は見かけの精度を左右するが、物理的には「何を不変量として残すか」の選択である。例えば、形状のみに反応させたいのか、絶対強度も含めたいのかで、入力設計は変わる。

顕微像（SEM/TEM/STEM、磁区像など）は画像として $I\in\mathbb{R}^{H\times W\times C}$ であり、局所欠陥やメソ構造に強い。一方で、同一物性でも像は複数の生成要因（厚み、コントラスト、焦点、ドリフト）を含むため、計測条件メタデータを同時入力する設計が有効である。

### 3.3 プロセス・履歴・メタデータ
材料は「作り方」に強く依存する。したがって、温度履歴、雰囲気、成膜速度、アニール条件、前処理、測定幾何などのメタデータ $p$ を入力に含め、

$$
y = f(x,p)
$$

として物性を扱うことが、外挿の失敗を減らす方向になる。データ同化の観点では、同じ $x$ でも $p$ が異なれば別物として扱うほうが自然である。

## 4. モデル（model）: 目的別に何を学習するか
材料分野で使われるAIモデルは、(i) 順問題（予測）、(ii) 計算の高速化、(iii) 逆問題（生成・設計）、(iv) 実験条件提案、(v) 物理パラメータ同定、に大別される。

### 4.1 物性予測（順問題）
順問題の目標は $\hat{f}_\theta(x)\approx f(x)$ である。回帰損失は基本的に

$$
L(\theta)=\frac{1}{N}\sum_{n=1}^{N}\left\|y_n-\hat{f}_\theta(x_n)\right\|^2
$$

であるが、材料では「分割の設計」が支配的である。すなわち、同系列の組成や同一プロトタイプ構造が学習と評価に混入すると、見かけの汎化が発生する。これを避けるために、材料ベンチマークでは分割規則が明示されることが多い。

### 4.2 第一原理計算・MDの高速化（機械学習ポテンシャル）
機械学習ポテンシャルは、原子配置 $R$ に対する全エネルギー $E(R)$ を学習し、力を

$$
\mathbf{F}_i(R) = -\nabla_{\mathbf{r}_i}E(R)
$$

として一貫して与えることを狙う。学習は

$$
L(\theta)=w_E \left\|E-\hat{E}_\theta\right\|^2
+w_F \sum_i \left\|\mathbf{F}_i-\hat{\mathbf{F}}_{i,\theta}\right\|^2
+w_\sigma \left\|\sigma-\hat{\sigma}_\theta\right\|^2
$$

の形が基本である。力項が大規模データとして強い拘束になること、応力を含めると弾性や格子の再現が安定しやすいことが重要である。

ここで等変モデルが効く理由は、力がベクトル量であり、回転変換下で整合する必要があるためである。等変を強制することで、データ効率と安定性が上がる方向に働く。

### 4.3 逆設計）: 生成モデルの物理
逆設計は「制約付き生成」である。候補構造 $x$ を生成し、評価関数や制約を満たすものを探索する。

代表例として変分オートエンコーダ（VAE）は潜在変数 $z$ を導入し、

- エンコーダ $q_\phi(z|x)$
- デコーダ $p_\theta(x|z)$

を学習する。ELBO（下界）は

$$
\log p_\theta(x)\ge
\mathbb{E}_{q_\phi(z|x)}[\log p_\theta(x|z)]
-\mathrm{KL}\!\left(q_\phi(z|x)\,\|\,p(z)\right)
$$

であり、再構成精度と潜在空間の正則化を両立させる。

拡散モデルは、前向き過程でデータをノイズ化し、逆過程で復元する。連続表現 $x_t$ を

$$
q(x_t|x_0)=\mathcal{N}\!\left(\sqrt{\bar{\alpha}_t}\,x_0,\,(1-\bar{\alpha}_t)I\right)
$$

で定義し、ノイズ推定器 $\varepsilon_\theta(x_t,t)$ を学習する設計が基本である。結晶生成では周期境界や格子自由度を含むため、座標だけでなく格子・サイト・元素種の同時生成、あるいは段階生成が論点となる。

近年は無機結晶の生成に拡散系を適用し、条件付き設計（目標物性を条件として与える）へ拡張する方向が示されている。

### 4.4 科学の文脈理解を取り込む：基盤モデル
材料研究では、観測データだけでなく論文・データシート・実験ノート相当の文章情報が、設計空間の事前分布を与える。文章情報は、候補の絞り込み（先行知見に沿う）、実験条件の制約化（合成条件の現実性）、説明生成（推論可能な根拠の提示）に寄与する。一方で、文章情報の推論は検証を必要とし、数値データと同列に扱うのではなく、仮説生成や探索の優先順位付けに用いる設計が整合的である。

## 5. ベイズ最適化と能動学習
観測回数が限られるとき、次に測る点を情報的に選ぶ戦略が重要である。

### 5.1 ベイズ最適化（BO）
未知関数 $f(x)$ をガウス過程（GP）で近似し、事後平均 $\mu(x)$ と分散 $\sigma^2(x)$ を得る。次点は獲得関数 $a(x)$ で決める。

$$
x_{\text{next}}=\arg\max_{x\in\mathcal{X}} a(x;\mu,\sigma)
$$

期待改善（EI）の例は

$$
z=\frac{\mu(x)-f_{\text{best}}-\xi}{\sigma(x)},
\quad
\mathrm{EI}(x)=\left(\mu(x)-f_{\text{best}}-\xi\right)\Phi(z)+\sigma(x)\phi(z)
$$

である。$\xi$ は探索・活用のバランスを調整する項である。

材料では目的が複数である（例: 高磁化と低損失、安定性と機能、性能と低コスト）ことが多い。このときパレート最適の集合を

$$
\mathcal{P}=\left\{x:\nexists x' \;\text{s.t.}\; f_k(x')\ge f_k(x)\;\forall k,\; \exists k: f_k(x')>f_k(x)\right\}
$$

として扱い、獲得関数も多目的版に拡張する。

### 5.2 不確かさ推定と能動学習
外挿に強くなる鍵は、「どこで間違えそうか」を推定し、その領域にデータを追加することである。予測と不確かさを同時に出す設計は

$$
y=\hat{f}_\theta(x)\pm \hat{\sigma}(x)
$$

として書ける。$\hat{\sigma}$ はアンサンブル、ドロップアウト近似、ベイズ近似、分布外検知などで評価される。能動学習では一般に

- 不確かさ最大化（最も曖昧な点を測る）
- 期待改善最大化（改善が見込める点を測る）
- 情報利得最大化（モデル更新が大きい点を測る）

のいずれか、または混合になる。

## 6. 物理情報付き学習（PIML / PINNs）の位置づけ
物理制約は、データが少ない領域で特に効く。基本形は

$$
L(\theta)=L_{\text{data}}(\theta)+\lambda L_{\text{physics}}(\theta)
$$

である。

$L_{\text{physics}}$ の例
- 対称性違反の罰則
- 保存則（連続の式、エネルギー収支）の残差
- 力とエネルギーの整合（$ \mathbf{F}=-\nabla E$）の破れ
- 熱力学整合（凸包・相安定性の条件）の破れ
- 電荷中性、スピン多重度、占有数などの拘束

PDEが明示的にある場合、解 $u_\theta$ に対して

$$
L_{\text{physics}}=\int_\Omega \left\|\mathcal{N}[u_\theta](x)\right\|^2 dx
+\int_{\partial\Omega} \left\|\mathcal{B}[u_\theta](x)\right\|^2 ds
$$

（$\mathcal{N}$ は支配方程式、$\mathcal{B}$ は境界条件）とする設計が可能である。材料でこの枠組みが効きやすいのは、拡散、熱伝導、弾性、電磁場など、連続体の記述が強い現象である。

## 7. 自律探索
薄膜の組成傾斜試料のように、1枚の試料が連続的な設計空間を含む場合、探索の効率は大きく上がる。ここでは、合成→計測→解析→次条件の提案を短い周期で回す設計が成立しやすい。国内では、組成傾斜薄膜に対応したAIベース自律材料探索の枠組みが報告されている。

閉ループを数式で見ると、時間 $t$ におけるデータ集合 $\mathcal{D}_t$ を

$$
\mathcal{D}_{t+1}=\mathcal{D}_t \cup \left\{(x_{t+1},y_{t+1})\right\},
\quad
x_{t+1}=\pi(\mathcal{D}_t)
$$

と書ける。$\pi$ は探索方策であり、BO、能動学習、制約付き最適化などで与えられる。ここで重要なのは、測定ノイズとドリフトを観測モデルに入れることである。すなわち

$$
y = f(x) + \epsilon,\quad \epsilon\sim\mathcal{N}(0,\sigma_{\text{noise}}^2(x,p))
$$

とし、ノイズが条件依存であることを前提にするほうが整合的である。

## 8. 多モード統合
材料研究では「構造が変わったのか」「価数が変わったのか」「相が混ざったのか」が同時に起きる。多モード統合は、観測 $y^{(1)},y^{(2)},\dots$ を

$$
y^{(m)} = g^{(m)}(x) + \epsilon^{(m)}
$$

として同一の潜在状態 $x$（あるいは潜在表現 $z$）に結び付ける問題である。実装としては、(i) それぞれのモードにエンコーダを持ち同一潜在へ写像する、(ii) 物理モデル（回折・吸収・散乱の理論）を観測モデルとして組み込む、(iii) 計算スペクトルと実験スペクトルを同一指標で比較できるよう整形する、などがある。

材料の文脈では、スペクトルの形状一致だけでなく、温度や磁場やひずみなど外場依存の再現も重要になる。外場 $u$ を入力とすると

$$
y = f(x, u)
$$

となり、未知の相転移やモード混成が現れる領域ほど、能動学習で情報を集める意義が増す。

## 9. 評価の設計
AI4Scienceでは、単一の誤差指標だけでは不十分である。目的に応じて以下を分けるほうが自然である。

- 予測（順問題）: MAE/RMSEに加えて不確かさの較正（予測区間の妥当性）
- 探索（最適化）: 最良値到達までの試行回数、到達したパレート面の厚み
- 生成（逆設計）: 物理フィルタ通過率、重複率、緩和後の安定性、検証率
- 統合（ループ）: 同じ予算で得られた知見の量（同定された機構、支配パラメータの絞り込み）

特に外挿への頑健性は、分割の仕方で変わる。材料系統別（化学系、構造プロトタイプ別、時間順）の分割を使い分け、想定する運用に近い評価を行うほうが整合的である。

## 10. 基本の設計案
AI4Scienceを「一度に完成させる」よりも、最小構成を定めて拡張する方が再現性を保ちやすい。基本の構成は次である。

1. 対象系を限定する（例: ある結晶系、あるプロセス、ある測定モード）
2. 目的関数 $f(x)$ と制約を明示する（写像先の物性と測定条件）
3. 代理モデル $\hat{f}_\theta$ と不確かさ $\hat{\sigma}$ を持つ
4. 提案則 $\pi(\mathcal{D})$ を一つ決める（EI、UCBなど）
5. 検証（実験・計算）とデータ追加の規則を固定する
6. 追加する複雑さ（多目的化、多モード化、生成、物理制約）を一つずつ増やす

このとき記録すべき情報は、(i) 入力の定義、(ii) 単位と較正、(iii) 測定条件、(iv) 乱数や初期条件、(v) スキーマ（何が欠損し得るか）である。段階的拡張でも整合が崩れないよう、「何が同一で、何が異なるか」を明確にしておく必要がある。

## 11. 比較表
### 11.1 MIとAI4Scienceの射程
| 観点 | MI | AI4Science |
|---|---|---|
| 主眼 | 相関発見・予測 | 仮説→提案→検証→更新の循環 |
| データ | 既存データ中心になりやすい | 実験・計算で能動的に増やす |
| 物理 | 後段で整合性確認になりやすい | 学習・提案に物理制約を入れる |
| 成果の形 | 予測モデル、重要特徴、物性マップ | 反復により機構理解と設計指針へ |

### 11.2 目的別のモデル選択
| 目的 | 入力 | 出力 | 基本の手法 |
|---|---|---|---|
| 物性予測（順問題） | 組成・構造・条件 | 物性値 | GNN/Transformer、回帰 |
| 計算高速化 | 原子配置 | $E,\mathbf{F},\sigma$ | 等変ポテンシャル、教師あり |
| 逆設計（生成） | 条件（物性、制約） | 構造候補 | 拡散、VAE、Flow |
| 条件提案 | 既データ | 次の測定点 | BO、能動学習 |
| パラメータ同定 | 時系列・場分布 | 物理パラメータ | 物理情報付き推定 |

### 11.3 不確かさの扱い
| 方法 | 形 | 長所 | 注意点 |
|---|---|---|---|
| アンサンブル | 複数モデルの分散 | 実装が比較的容易 | 計算量増 |
| 変分近似 | 近似ベイズ | 不確かさを一体化 | 近似誤差 |
| 分布外検知 | OODスコア | 外挿を検出しやすい | 閾値設計が必要 |
| GP/核法 | 事後分散 | 理論が明確 | 高次元で計算が重い |

## まとめ
AI4Scienceは、材料の設計変数が高次元で、観測が多モードで、物理制約が強いという性質を前提に、学習・提案・検証・更新を一体として回す研究様式である。表現の設計、不確かさの扱い、物理制約の導入、生成と最適化の結合を揃えることで、予測精度の改善に留まらず、機構理解と設計指針の獲得を同時に進められる枠組みになり得るのである。

## 関連研究
- The Open Catalyst 2020 (OC20) Dataset and Community Challenges（arXiv）
  https://arxiv.org/abs/2010.09990
- MatBench: Benchmarking Materials Property Prediction Methods（arXiv）
  https://arxiv.org/abs/2005.00707
- E(3)-equivariant graph neural networks for data-efficient and accurate interatomic potentials（NequIP, Nature Communications）
  https://www.nature.com/articles/s41467-022-29939-5
- NIMS Materials Data Repository（材料データ基盤, 日本語/英語）
  https://dice.nims.go.jp/services/MDR/
- CDVAE（Crystal Diffusion Variational AutoEncoder, 実装と論文リンク）
  https://github.com/txie-93/cdvae
