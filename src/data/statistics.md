# 統計学入門

## 参考ドキュメント

- 日本統計協会「データ分析のための統計学入門 “OpenIntro Statistics”」  
  https://www.jstat.or.jp/home/reference_book_y24/openstatistics/
- SPring-8 ワークショップ資料
  「新しい情報・統計理論に基づくスペクトル分解－化学イメージング法の開発」  
  https://support.spring8.or.jp/Doc_workshop/iuss/2016/computational_science-3/muto.pdf

## 概要

統計学は、データから規則性や構造を見つけ出し、予測や意思決定に役立てるための学問である。  
材料データ解析では、ばらつきの理解、測定誤差の扱い、相関の評価、モデル化・機械学習の基盤として欠かせない。

材料研究の具体例：
- 磁気特性・機械特性のばらつき解析
- 相図・プロセスウィンドウの推定
- 機械学習モデルの性能評価・不確かさ評価


## 1. 統計学の役割

統計学は主に次のような役割を持つ：

- データの特徴を要約する（記述統計）
- 不確実性を定量化する（信頼区間・誤差評価）
- 偶然か必然かを判断する（仮説検定）
- 将来の値や未知条件を推測する（予測・ベイズ推定など）
- モデルを評価・比較する（モデル選択・交差検証など）

材料研究では、たとえば以下のような場面で使う：

- 磁気特性・硬さ・導電率などのばらつき解析
- 熱処理条件と特性値からの相図推定
- 機械学習による物性予測モデルの妥当性評価


## 2. データの種類

### 定性データ（カテゴリデータ）

数値そのものには大小の意味がない「ラベル」のようなデータ。

- 例：結晶相（bcc / fcc / amorphous）、材料分類、処理条件の区分（焼なまし / 急冷など）
- 多くの場合、度数表・クロス集計・カイ二乗検定などで扱う。

カテゴリにはさらに
- 名義尺度（順序なし：材料A/B/C）
- 順序尺度（順序あり：低 / 中 / 高）
といった違いがあることも意識しておくと良い。

### 定量データ（数値データ）

数として足し算・平均などが意味をもつデータ。

- 離散値：粒子数、欠陥数、ボイド数（数え上げ）
- 連続値：磁化、格子定数、抵抗率、損失、粒径 など

データ型（カテゴリ／数値、離散／連続）に応じて、使えるグラフや統計手法（ヒストグラム・箱ひげ図・回帰・ポアソン回帰など）が変わるため、最初に把握しておくことが重要である。


## 3. 基本的な記述統計量

代表的な記述統計量と意味：

| 指標 | 意味（直感的なイメージ） |
|---|---|
| 平均（平均値） | データ全体の「中心的な値」。外れ値に影響を受けやすい。 |
| 中央値 | データを小さい順に並べたときの真ん中の値。外れ値の影響を受けにくい。 |
| 分散・標準偏差 | データが平均の周りにどれくらい散らばっているか（ばらつきの大きさ）。標準偏差は分散の平方根で、元の単位を保つ。 |
| 四分位範囲（IQR） | データの「真ん中 50%」の幅（第1四分位～第3四分位）。中心付近のばらつきを見る。 |
| 相関係数（Pearson など） | 2変数の直線的な関係の強さ（-1～1）。0に近いほど線形相関が弱い。 |

材料の例：
- 熱処理温度と磁束密度の散布図と相関係数
- 組成と硬さの分布（平均・標準偏差・箱ひげ図によるばらつき評価）


## 4. 分布の考え方

実データは様々な確率分布に従うと考えられる。代表的なもの：

- **正規分布（ガウス分布）**  
  測定誤差や、たくさんの小さな要因が足し合わさった結果として現れる量の近似に用いられる。  
  例：磁化測定値の試行ごとのばらつき、寸法誤差のばらつき など。

- **二項分布**  
  「成功／失敗」のような2値の事象を一定回数繰り返したときの成功回数の分布。  
  例：一定個数の試料中で規格を満たした個数、不良品の個数 など。

- **ポアソン分布**  
  一定時間・一定面積あたりのまれな事象の回数を表す分布。  
  例：単位体積あたりの欠陥数、単位時間あたりに発生する故障回数 など。  
  （成功確率が小さい二項分布の近似としても現れる）

- **対数正規分布**  
  データの対数をとると正規分布に従う場合の元の分布。  
  0 より大きい値だけを取り、右側に長い裾を引く形になる。  
  例：粒径分布、強度・導電率などの分布が対数正規に近いことが多い。

分布を仮定することで、信頼区間の計算や仮説検定などの推測統計が可能になる。  
一方で、分布を厳密に仮定しない「ノンパラメトリック手法」も存在し、データ数が少ない場合や分布形が不明な場合に有効なことが多い。


## 5. 推測統計の基本

### 標本と母集団

- **母集団**：対象としたい「全体」。  
  例：ある条件で作製可能な全ての Fe–Co 磁性薄膜。
- **標本**：実際に観測できる有限個のデータ。  
  例：実験で作製して測定した 10 枚の薄膜。

標本から母集団の性質（母平均・母分散など）を推定するのが推測統計。

### 推定

- **点推定**：母平均を標本平均で推定する、など 1 つの値で推定する方法。
- **区間推定**：母平均が「この範囲に入っているはず」という区間（信頼区間）を計算する方法。

信頼区間は「この区間に必ず真の値が入っている」という意味ではなく、「同じ方法で何度も標本抽出を繰り返したとき、一定割合の区間が真の値を含む」という頻度的な意味に注意する。

### 検定（仮説検定）

- **t 検定**：2 条件間の平均値の差が偶然か、有意な差かを判断。  
  例：熱処理前後で飽和磁化が変化したか。
- **カイ二乗検定**：カテゴリ同士の独立性や適合度を検証。  
  例：処理条件の違いと「OK/NG」判定の関係。
- **F 検定**：分散の比較や回帰モデルの有意性の検証。  
  例：2 条件間でばらつきが変化しているか、回帰モデルが「説明力ゼロ」とは言えないか。

※現実のデータでは、正規性や等分散性が成り立たない場合も多い。その場合は、データ変換やノンパラメトリック検定（Mann–Whitney 検定など）の利用も検討する。


## 6. 回帰とモデル評価

### 回帰分析

回帰分析は「説明変数（特徴量）」と「目的変数（予測したい量）」の関係を数式（モデル）で表現する手法。

代表的なもの：
- 単回帰：1 つの説明変数で目的変数を説明（例：結晶粒径 → 鉄損）
- 重回帰：複数の説明変数を同時に扱う（例：組成・熱処理温度・冷却速度 → 保磁力）
- 非線形回帰：物理モデルや指数関数・シグモイドなどを用いた回帰

材料応用例：
- 組成 vs 保磁力（Cr, Co, B 含有量から Hc を推定）
- 結晶粒径 vs 鉄損（粒径やシート厚さから鉄損をモデル化）

### モデル評価指標

- **RMSE（Root Mean Squared Error）**  
  二乗誤差の平均の平方根。誤差の「大きさ」（単位は目的変数と同じ）。
- **MAE（Mean Absolute Error）**  
  絶対誤差の平均。外れ値の影響を受けにくい。
- **R²（決定係数）**  
  0～1 の指標で、1 に近いほど「データの変動をよく説明している」。  
  ただし、説明変数を増やすと機械的に大きくなりやすいので注意。
- **交差検証（k-fold CV など）**  
  データを訓練用と検証用に分割して評価することで、「未知データに対する汎化性能」を確認する手法。

実務では、1つの指標だけで良し悪しを判断するのではなく、複数指標と物理的妥当性の両方を確認することが重要である。


## 7. 実験設計との関係

統計は「計測した後に解析する」だけでなく、「どのように実験するか」を決める段階でも重要な役割を持つ。

- **要因計画法（Design of Experiments; DOE）**  
  温度、時間、組成、応力など複数の要因を体系的に変化させて、最小限の実験回数で主要な効果と交互作用を推定する。
- **応答曲面法（Response Surface Methodology; RSM）**  
  プロセス条件と応答（損失、磁化など）の関係を近似し、最適条件を探す。
- **サンプリング戦略**  
  単純ランダム抽出、系統抽出、層化抽出など。代表性のある標本を得るための工夫。

材料の例：
- 磁化測定で「温度・周波数・応力」の組合せをすべて試すのではなく、DOE を用いて効率よく条件を選び、最小回数で主効果・交互作用を評価する。


## 8. 材料データ解析での注意点

材料・物性データを扱うとき、以下の点に注意する：

- **外れ値はすぐに除外しない**  
  排除する前に、測定ミス・装置トラブル・試料不良・実際の新規現象など原因を確認する。
- **データ数が少ないときの過学習に注意**  
  説明変数の数に比べてデータ数が少ないと、非常にきれいにフィットしても再現性がないモデルになりやすい。  
  → 交差検証やシンプルなモデルから始める。
- **相関は因果を意味しない**  
  2つの変数に強い相関があっても、「どちらが原因か」「第三の要因の影響がないか」は別途検討が必要。
- **単位・スケールの違いに注意**  
  応力（MPa）と温度（K）など、スケールが大きく異なる量をまとめて扱う場合、標準化・正規化が必要なことが多い。
- **多重比較・探索的解析の落とし穴**  
  多数の条件・特徴量を試すと、偶然の「有意差」が見つかりやすい。  
  → 物理的仮説に基づく解析と、検証用データの確保が重要。
- **測定条件のメタデータを必ず記録する**  
  測定日時、装置、試料 ID、前処理条件、環境条件などのメタデータは、後からデータの品質評価や再解析を行う際の生命線になる。

