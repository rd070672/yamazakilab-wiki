# 自由エネルギー原理（FEP）と情報理論：

自由エネルギー原理（Free Energy Principle; FEP）は、生物やエージェントが観測のサプライザル（驚きの情報量）を直接は扱わず、変分自由エネルギー（Variatinal Free Energy; VFE）という上界を最小化することで、知覚・学習・行動を説明しようとする枠組みである。情報理論（エントロピー、KLダイバージェンス、相互情報量）と変分ベイズ推論の等式変形が中核にあり、数式としては「確率モデルの証拠（evidence）下限＝ELBO」と同型である。

## 参考ドキュメント
1. Friston, K. (2010). The free-energy principle: a unified brain theory? Nature Reviews Neuroscience.  
   https://www.nature.com/articles/nrn2787

2. Friston, K. et al. (2016). Active inference and learning. (PubMed Central)  
   https://pmc.ncbi.nlm.nih.gov/articles/PMC5167251/

3. 磯村拓哉 (2018). 自由エネルギー原理の解説：知覚・行動・他者の思考の推論. 日本神経回路学会誌 25(3), 71–85.  
   https://www.jstage.jst.go.jp/article/jnns/25/3/25_71/_pdf

## 1. なぜ「自由エネルギー」と「情報理論」が結び付くのか

FEPの「自由エネルギー」は、熱力学のヘルムホルツ自由エネルギー $F_{Helm}=U-TS$ を直接使うのではなく、確率モデルにおける変分目的関数として定義される量である。名称が同じで混線しやすいが、FEPの議論では主として次が焦点である。

- 観測 $o$ の生起確率 $p(o)$（モデル証拠）を高めたいが、厳密な周辺化 $\int p(o,s)\,ds$ が困難である
- そこで事後分布 $p(s|o)$ を近似する分布 $q(s)$ を導入し、扱いやすい上界（変分自由エネルギー）を最小化する
- このとき、上界の構成にKLダイバージェンスとサプライザルが現れ、情報理論と密接に接続される

ここで $s$ は潜在状態（隠れ状態）であり、生体やエージェント内部が「外界の原因」を表現するために仮定される変数である。


## 2. 情報理論の基礎

### 2.1 サプライザル（Shannon surprisal）とエントロピー

ある事象 $o$ のサプライザル（自己情報量）は

$$
I(o) = -\ln p(o)
$$

で定義される。対数底を2にすればビット、自然対数ならナット（nat）である。

確率変数 $O$ のシャノンエントロピーはサプライザルの期待値である。

$$
H(O) = \mathbb{E}_{p(o)}[I(o)] = -\sum_o p(o)\ln p(o)
$$

FEPの直観的説明では「生物は驚きを小さく保つ」などと述べられることがあるが、厳密には「長期平均のサプライザル（あるいはエントロピー）に関わる量を、扱える上界で抑える」と理解すると数学的に誤解が少ない。

### 2.2 KLダイバージェンス

分布 $q(x)$ と $p(x)$ のKLダイバージェンス（Kullback–Leibler divergence）は

$$
D_{KL}(q\|p)=\mathbb{E}_{q(x)}\left[\ln\frac{q(x)}{p(x)}\right]
$$

であり、常に $D_{KL}(q\|p)\ge 0$ を満たす。FEPの導出は、この非負性を何度も使う。

### 2.3 相互情報量と情報獲得

相互情報量（mutual information）は

$$
I(S;O)=D_{KL}\bigl(p(s,o)\|p(s)p(o)\bigr) = H(S)-H(S|O)
$$

とも書ける。また、観測による事後更新の観点では「情報獲得＝事後と事前のKLの期待値」として

$$
I(S;O)=\mathbb{E}_{p(o)}\left[D_{KL}\bigl(p(s|o)\|p(s)\bigr)\right]
$$

が重要である。能動推論（Active Inference）の「探索（情報を取りに行く）」は、この量と深く結び付く。


## 3. 変分自由エネルギー：定義、上界性、ELBOとの一致

### 3.1 生成モデルと近似事後分布

観測 $o$ と潜在状態 $s$ について、生成モデル（generative model）を

$$
p(o,s) = p(o|s)p(s)
$$

とする。真の事後分布は $p(s|o)$ であるが、計算困難な場合が多い。そこで近似分布 $q(s)$ を導入し、以降は $q$ を調整することで推論を行う。

### 3.2 変分自由エネルギーの定義

変分自由エネルギー（variational free energy; VFE）を

$$
F[q] = \mathbb{E}_{q(s)}[\ln q(s) - \ln p(o,s)]
$$

と定義する。

この定義は、統計機械学習でいう負のELBO（Evidence Lower Bound）の形そのものである。すなわち

$$
\mathrm{ELBO}(q) = \mathbb{E}_{q(s)}[\ln p(o,s) - \ln q(s)] = -F[q]
$$

である。したがって $F$ を最小化することは、ELBOを最大化することと同値である。

### 3.3 上界性：サプライザル（負の対数証拠）の上界

ベイズの定理を用いて $F$ を変形すると、次が得られる。

$$
F[q] = D_{KL}\bigl(q(s)\|p(s|o)\bigr) - \ln p(o)
$$

ここで $D_{KL}\ge 0$ であるから、

$$
F[q] \ge -\ln p(o)
$$

が成り立つ。右辺 $-\ln p(o)$ は観測のサプライザルであり、計算が難しい（周辺化が必要）一方、左辺 $F[q]$ は $q$ を通じて計算可能な形にできる。ゆえに、サプライザルの最小化（あるいは上界の最小化）としてFEPを読むことができる。

### 3.4 「複雑さ」と「データ適合」

$p(o,s)=p(o|s)p(s)$ を使うと、

$$
F[q] = \underbrace{\mathbb{E}_{q(s)}[-\ln p(o|s)]}_{\text{データ適合（負の対数尤度）}}
+ \underbrace{D_{KL}\bigl(q(s)\|p(s)\bigr)}_{\text{複雑さ（事前からの乖離）}}
$$

と分解できる。前者は観測再現の良さ、後者は信念が事前からどれだけ逸脱したかを測る。変分推論・VAE・FEPの共通骨格がここにある。


## 4. 自由エネルギー原理（FEP）の主張

FEPのコアは次のように要約できる。

- エージェント（生物）は観測 $o$ を受け取る
- 内部状態（信念）を近似分布 $q(s)$ により表し、$F[q]$ を下げる方向に更新する
- $F[q]$ を下げることは、事後 $p(s|o)$ に近づく（$D_{KL}(q\|p(s|o))$ を減らす）ことを含む
- 同時に $F$ が $-\ln p(o)$ の上界であるため、観測のサプライザルを抑えることに結び付く

この段階では「行動」が未登場であり、主として知覚・推論（perceptual inference）の説明である。行動が入るのが能動推論である。


## 5. 能動推論と期待自由エネルギー

### 5.1 なぜ「期待」自由エネルギーが必要か

知覚は「すでに得られた観測 $o$」に条件づけるが、行動選択は「未来の観測」を左右する。したがって、将来の観測と状態についての予測分布の下で、目的関数を期待値として評価する必要がある。このとき導入されるのが期待自由エネルギー（expected free energy; EFE）である。

### 5.2 将来観測に対する変分量

政策（行動系列）を $\pi$ とし、将来時刻での状態と観測を $s_\tau,o_\tau$ とすると、基本形の一つは

$$
G(\pi)=\mathbb{E}_{q(o_\tau,s_\tau|\pi)}\bigl[\ln q(s_\tau|\pi)-\ln p(o_\tau,s_\tau)\bigr]
$$

である。文献により表記や条件づけが異なるが、本質は「将来に関する予測分布の下で、自由エネルギー型の量を評価し、それを小さくする $\pi$ を選ぶ」という点にある。

### 5.3 好み（リスク）と情報獲得（相互情報量）

能動推論（Active Inference）では、生成モデルの中に「望ましい観測」の事前分布 $p(o)$（好み）を組み込むことが多い。すると期待自由エネルギーは、概念的に次の二つの圧力を同時に含む。

- 好みと一致する観測を得る（リスクを下げる）
- 不確実性を減らす観測を得る（情報を得る）

情報理論の観点で重要なのは、後者が「情報獲得＝相互情報量」に一致する形で現れることである。代表的には

$$
\mathbb{E}_{q(o_\tau|\pi)}\left[D_{KL}\bigl(q(s_\tau|o_\tau,\pi)\|q(s_\tau|\pi)\bigr)\right]
$$

という項が出現し、これは $\pi$ のもとでの $S_\tau$ と $O_\tau$ の相互情報量（information gain）として解釈される。つまり、ある政策 $\pi$ は「将来観測を通して状態推定がどれだけ更新されるか（どれだけ学べるか）」によっても評価される。

### 5.4 曖昧さとリスク

能動推論の説明では、しばしば

- 曖昧さ（ambiguity）：状態が分かっても観測が不確か（$p(o|s)$ のエントロピーが大きい）
- リスク（risk）：得られる観測が好みから外れる（$p(o)$ に対して低確率）

として語られる。曖昧さは条件付きエントロピー $H(O|S)$ に対応しやすく、リスクは $-\ln p(o)$（好みの下でのサプライザル）の期待値に対応しやすい。いずれも情報理論量として定式化されるため、FEPの中で情報理論が最も明示的に働くのがこの部分である。


## 6. マルコフ・ブランケット：境界を情報理論で表現する装置

FEPの全体像では、システムを

- 外部状態 $x$（environment）
- 内部状態 $\mu$（agent）
- ブランケット状態 $b$（感覚状態 $s$ と能動状態 $a$ を含む）

に分け、条件付き独立性を仮定する。基本的な形は

$$
x \perp\!\!\!\perp \mu \mid b
$$

であり、外部と内部はブランケットを介してのみ統計的に結び付く。感覚状態は外部から内部へ情報を運び、能動状態は内部から外部へ作用を及ぼす。これにより「どこまでが自己で、どこからが環境か」という境界が確率的独立性として宣言され、情報の流れを数式で扱える。

---

## 7. 熱力学の自由エネルギーとの関係

名称が同じため、混同を避けるために差分を表で整理する。

| 観点 | 熱力学（ヘルムホルツ等） | FEP（変分自由エネルギー） |
|---|---|---|
| 定義の舞台 | 物理量（エネルギー、温度、エントロピー） | 確率モデル（生成モデルと近似分布） |
| 代表式 | $F_{Helm}=U-TS$ | $F[q]=\mathbb{E}_{q}[\ln q-\ln p(o,s)]$ |
| エントロピーの意味 | 物理的エントロピー | 情報論的エントロピー（分布の不確実性） |
| 最小化の意味 | 平衡・自発過程の方向 | 近似事後の改善、証拠下限の最大化（=サプライザル上界の最小化） |
| 接続の仕方 | 統計力学を介した類推が中心 | 変分推論・情報理論の等式変形が中心 |

FEPの議論で「物理学的自由エネルギーに似た形が出る」と言われるのは、$F[q]$ が「エネルギー項＋エントロピー項」の差として書けるためである。ただし、そこでの“エネルギー”は $-\ln p(o,s)$（負の対数確率）であり、物理エネルギーそのものではない点が重要である。


## 8. 機械学習・統計との対応

### 8.1 ELBOと変分推論

既に述べた通り、$F[q]$ は負のELBOである。したがって、FEPの推論部分は変分推論の一般形と一致する。ここから次が自然に導かれる。

- $q(s)$ の更新：事後 $p(s|o)$ に近づける最適化
- パラメータ学習：$p(o,s)$ のパラメータを更新して $p(o)$ を高める（ELBO最大化）

### 8.2 VAEとの関係（同型性）

VAEでは潜在変数 $z$、観測 $x$ に対し

$$
\mathrm{ELBO} = \mathbb{E}_{q(z|x)}[\ln p(x|z)] - D_{KL}(q(z|x)\|p(z))
$$

を最大化する。これは前述の「データ適合＋複雑さ」の分解と同型であり、FEPの知覚（推論）部分と数学的骨格を共有する。

### 8.3 予測符号化との関係

Fristonの系譜では、変分自由エネルギー最小化を神経回路の計算仮説として読み替え、予測誤差（prediction error）の最小化として表現する流れがある。重要なのは、単なる「誤差最小化のスローガン」ではなく、背後に

- 生成モデル $p(o|s)$
- 近似事後 $q(s)$
- 上界 $F[q]$

があり、誤差項が対数尤度に由来するという点である。


## 9. 基本用語の対応表

| 概念 | 情報理論での定義 | FEP・変分推論での現れ方 |
|---|---|---|
| サプライザル | $I(o)=-\ln p(o)$ | $F[q]\ge -\ln p(o)$（上界） |
| エントロピー | $H(O)=\mathbb{E}[-\ln p(o)]$ | 長期平均の驚きの議論で登場 |
| KL | $D_{KL}(q\|p)$ | 近似事後と真の事後のずれ、複雑さ項 |
| 相互情報量 | $I(S;O)=\mathbb{E}[D_{KL}(p(s|o)\|p(s))]$ | 期待自由エネルギーの情報獲得項として出現 |
| 交差エントロピー | $H(p,q)=\mathbb{E}_{p}[-\ln q]$ | 好み $p(o)$ と予測 $q(o)$ の不一致（リスクの直観） |


## 10. 実証研究・議論の状況

FEPは一般性が高く、どの現象も「何らかの生成モデル」を選べば説明できるのではないか、という議論がある。したがって、理論全体の可否を一撃で決めるよりも、特定のシステムに対して

- 生成モデルの仮定を具体化する
- その帰結（学習則、ダイナミクス、行動選択）を予測する
- 実データで検証する

という進め方が重視される。

国内では、自由エネルギー原理の体系的な日本語解説として、神経回路学会誌の解説論文や脳科学辞典の項目が参照しやすい。また理化学研究所（RIKEN）からは、培養神経回路などの実験系で自由エネルギー原理に沿う予測を検討する研究成果がプレスリリースとして公表されている。


## 11. まとめと展望

自由エネルギー原理は、観測のサプライザル $-\ln p(o)$ を直接は最小化できない代わりに、変分自由エネルギー $F[q]$ という計算可能な上界を最小化する枠組みであり、情報理論（KL、エントロピー）と変分推論（ELBO）の等式変形が中核である。能動推論では期待自由エネルギーを通じて、好みに沿う行動と相互情報量に基づく情報獲得が同じ数式の中に現れ、探索と目的志向を統一的に表現できる。

今後の展望としては、(i) マルコフ・ブランケットや生成モデルを具体系に即してどこまで同定できるか、(ii) 期待自由エネルギーの分解（リスク、曖昧さ、情報獲得）を、行動データや神経データでどの粒度まで検証できるか、(iii) 機械学習（変分モデル、表現学習、制御）との対応を保ちながら、どの仮定が実験的に区別可能な予測を生むか、が焦点になるであろう。


## 参考文献

- 脳科学辞典：自由エネルギー原理（磯村拓哉、2022）  
  https://bsd.neuroinf.jp/wiki/自由エネルギー原理

- Karl, F. (2012). A Free Energy Principle for Biological Systems.  
  https://www.fil.ion.ucl.ac.uk/~karl/A%20Free%20Energy%20Principle%20for%20Biological%20Systems.pdf

- Friston, K. (2021). Some Interesting Observations on the Free Energy Principle. Entropy (MDPI).  
  https://www.mdpi.com/1099-4300/23/8/1076

- Parr, T. et al. (2019). Generalised free energy and active inference. Biological Cybernetics.  
  https://link.springer.com/article/10.1007/s00422-019-00805-w

- Kirchhoff, M. et al. (2018). The Markov blankets of life: autonomy, active inference and ... Journal of the Royal Society Interface.  
  https://royalsocietypublishing.org/rsif/article/15/138/20170792

- RIKENプレスリリース（2022）神経回路は潜在的な統計学者  
  https://www.riken.jp/press/2022/20220114_3/

- RIKENプレスリリース（2023）培養神経回路において自由エネルギー原理を実証  
  https://www.riken.jp/press/2023/20230807_1/index.html

- MIT Press（2022）Parr, T. et al. Active Inference: The Free Energy Principle in Mind, Brain, and Behavior（オープンアクセス版）  
  https://direct.mit.edu/books/oa-monograph/5299/Active-InferenceThe-Free-Energy-Principle-in-Mind

- 乾敏郎（京都大学 名誉教授）講義案内：今度こそ分かる自由エネルギー原理の急所（日本語）  
  https://www.can-neuro.org/2025/advance_1_inui/6799/
