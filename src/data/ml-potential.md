# 機械学習ポテンシャルの基礎

## 参考ドキュメント

- T. W. Ko & S. P. Ong, “Recent advances and outstanding challenges for machine learning interatomic potentials”, *Nat. Comput. Sci.* (2023). 
- J. Behler, “Four Generations of High-Dimensional Neural Network Potentials”, *Chem. Rev.* (2021). 
- R. Jacobs et al., “A practical guide to machine learning interatomic potentials” (2025, review).  

---

## 1. 機械学習ポテンシャルとは何か

機械学習ポテンシャル（Machine Learning Interatomic Potentials, MLIP / MLP）は、

- DFT などの第一原理計算から得たエネルギー・力のデータを教師データとして
- 構造（原子配置） → エネルギー・力 の関数関係を
- ニューラルネットワークやガウス過程などの機械学習モデルで近似した「力場」

の総称です。

目的は、

- DFT に近い精度
- 古典力場に近い計算速度

を両立し、大規模・長時間スケールの MD やサンプリングを可能にすることです。

---

## 2. 従来ポテンシャル・DFTとの位置づけ

おおまかな位置づけは以下のイメージです。

- **DFT / ab initio**
  - 精度：高い
  - 計算コスト：非常に高い
  - 系サイズ：〜数百原子程度
- **古典力場（EAM, Lennard-Jones, ReaxFF など）**
  - 精度：限られる（設計された範囲では良いが汎用性に制約）
  - 計算コスト：非常に安い
  - 系サイズ：大規模・長時間に向く
- **機械学習ポテンシャル**
  - 精度：訓練データ内では DFT に近い／匹敵
  - 計算コスト：古典力場よりは重いが、DFT より桁違いに軽い
  - 系サイズ・時間：古典 MD 並みのスケールへ拡張可能

> キーワードは「DFT クオリティのポテンシャルエネルギー面を高速に評価したい」というニーズ。

---

## 3. 機械学習ポテンシャルの基本アイデア

ほとんどの MLIP は、次のような構造を取ります。

1. **ローカル環境の分解**
   - 系全体の全エネルギー $E_{\text{tot}}$ を、各原子の「局所エネルギー」の和として分解：
     $$
     E_{\text{tot}} = \sum_i E_i(\text{周囲の環境})
     $$
   - 各原子 i の周囲（あるカットオフ距離以内の原子配置）だけを見れば、その寄与エネルギーを予測できると仮定。

2. **構造記述子（descriptor）**
   - 生の座標をそのまま学習させるのではなく、
   - 並進・回転・原子ラベルの入れ替えなどに対して物理的に妥当な不変量になるように変換したベクトル（descriptor）を作る。
   - 例：
     - 原子中心対称関数（Behler–Parrinello type） 
     - SOAP（Smooth Overlap of Atomic Positions）
     - ACE（Atomic Cluster Expansion）
     - グラフニューラルネットで内部的にエンコード（M3GNet, CHGNet など）

3. **回帰モデル（エネルギー・力の予測器）**
   - descriptor → 局所エネルギー $E_i$ を予測する ML モデル。
   - 主な系統：
     - **ニューラルネット型**（Behler–Parrinello NNP, HDNNP） 
     - **ガウス過程型**（GAP: Gaussian Approximation Potential）
     - **カーネル／線形展開型**（SNAP, MTP, ACE）
     - **グラフニューラルネット型**（NequIP, MACE, M3GNet など）

4. **力（および応力）の一貫性**
   - エネルギーを座標で微分したものが力：
     $$
     \mathbf{F}_i = - \frac{\partial E_{\text{tot}}}{\partial \mathbf{R}_i}
     $$
   - 多くの MLIP は、エネルギーと力を同時にフィットして、エネルギー面との整合性を保つ。

---

## 4. 代表的な機械学習ポテンシャルの系統

実装名ではなく「考え方」で分類

### 4.1 高次元ニューラルネットポテンシャル（HDNNP）

- Behler–Parrinello 型に代表される手法。
- 各原子に専用の NN を割り当てる／あるいはタイプごとに共有する。
- 長所：表現力が高く、多彩な系に適用実績あり。
- 短所：descriptor 設計・ハイパーパラメータ調整の自由度が高く、やや玄人向け。

### 4.2 ガウス過程・カーネルベース（GAP, SNAP など）

- GAP（Gaussian Approximation Potentials）は代表例。 
- descriptor とカーネル関数を用いて、ガウス過程回帰で局所エネルギーを推定。
- 不確かさ（uncertainty）の推定がしやすく、アクティブラーニングと相性が良い。

### 4.3 グラフニューラルネット型（GNN, message passing）

- 原子をノード、相互作用をエッジとしたグラフとして扱う。
- メッセージパッシングにより、ローカル環境情報を逐次アップデート。
- M3GNet, NequIP, MACE, CHGNet などのモデルがこの系統。 
- 長所：descriptor を「自動学習」でき、化学系全域をカバーする汎用 MLIP への期待が大きい。

---

## 5. 機械学習ポテンシャルの構築ワークフロー（概念）

実際に MLIP を作るときの典型的な流れは次の通りです。

1. **目的・適用範囲の定義**
   - 何をしたいか？（融解・拡散・転位運動・相変態・磁気構造 など）
   - 温度・圧力・組成・構造の範囲をざっくり決める。

2. **訓練データの準備（第一原理計算）**
   - 代表的な構造サンプルを選ぶ（格子振動・ひずみ・欠陥・界面など）。
   - DFT などでエネルギー、力、応力テンソルを計算。

3. **モデルと descriptor の選択**
   - NNP, GAP, GNN 等どの系統を使うか決める。
   - 既存のフレームワーク（GAP/QUIP, DeePMD-kit, NequIP, MACE など）から選ぶのが現実的。

4. **学習と検証**
   - 訓練セット・検証セットに分けてフィッティング。
   - エネルギー・力の誤差（MAE, RMSE）だけでなく、
     - 平衡構造
     - 弾性定数
     - 拡散係数
     - 相対安定性（相のエネルギー差）
     など、実際に使う物性で検証。

5. **アクティブラーニング**
   - MLIP を使って爆走 MD → 「怪しい領域」（外挿）を検出。
   - その構造を新たに DFT で計算し、訓練データに追加。
   - これを繰り返して、必要な範囲での堅牢性を高める。

6. **本番シミュレーション**
   - 目的のスケール（大規模・長時間）の MD、構造探索、MC などに MLIP を投入。

---

## 6. 利点と注意点

### 6.1 利点

- **スケール拡張**
  - DFT では扱えないサイズ・時間スケールのシミュレーションが可能。
- **汎用性**
  - 適切に学習すれば、多元系・高温状態・欠陥・界面など複雑な状況も一貫したポテンシャルで扱える。
- **柔軟な物性解析**
  - エネルギー・力が安定して得られるため、
    - MD
    - 構造探索（global optimization, basin hopping）
    - 自由エネルギー計算
    など多用途。

### 6.2 主な注意点・落とし穴

- **外挿（extrapolation）の危険**
  - 訓練データの外側に出ると、物理的に破綻した力・エネルギーを出すことがある。
  - 不確かさ推定やディスクリプタの「距離」で異常検知する仕組みが重要。

- **訓練データの偏り**
  - 特定の構造・温度・組成に偏ったデータで学習すると、その周辺以外では使えない。
  - 実際の用途を意識したサンプリング戦略が必要。

- **長距離相互作用**
  - 局所カットオフ型 MLP では、真に長距離なクーロン力や分極を素朴に扱えない。
  - 電荷平衡スキームや明示的な長距離項とのハイブリッド化などが研究されている。

- **磁性・スピン自由度**
  - 多くの MLIP は原子位置だけを入力とし、スピン自由度を明示的には扱わない。
  - スピン依存のポテンシャル（磁性 HDNNP など）も登場しているが、まだ発展途上の分野。

---

## 7. どんな問題に向いているか

機械学習ポテンシャルが威力を発揮する典型的な場面：

- 大規模な融解・急冷・アモルファス形成のシミュレーション
- 拡散係数・輸送現象の精密評価
- 相変態・析出・欠陥ダイナミクスの長時間追跡
- 表面・界面・ナノ構造の安定性・反応性評価
- 高温・高圧など DFT だけでは統計サンプルが取り切れない条件

一方で、「ほとんど DFT で完結する小系」の場合は、MLIP を作るコストがペイしないこともあるため、  
システムサイズ・時間スケール・必要精度を考えた上で導入を検討するのが現実的です。 

---

## 8. このページの位置づけ

この「機械学習ポテンシャルの基礎」ページでは、

- 機械学習ポテンシャルの目的と位置づけ
- ローカルエネルギー分解・descriptor・回帰モデルという基本構造
- 代表的な系統（NNP, GAP, GNN 型）
- 構築ワークフローと利点・注意点
- 適用に向く問題のイメージ

を、理論詳細に立ち入る前の「全体像」として整理しました。